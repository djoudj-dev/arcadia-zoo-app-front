import{a as D,b as z}from"./chunk-O66G5F3S.js";import{a as $}from"./chunk-MWR6PVUV.js";import{a as R}from"./chunk-VV7GXU3B.js";import{c as A,e as I}from"./chunk-OTF63C3I.js";import{a as L}from"./chunk-M6XTAS6A.js";import{Dc as T,Ec as V,Hb as u,Jb as v,Qb as j,Sa as p,Ta as g,Vb as M,Yb as k,_a as _,db as y,hb as x,ia as E,jc as C,lb as F,mb as O,nb as U,pb as w,qb as S,rb as a,sa as d,sb as r,ta as c,tb as b,xb as h,yb as f,zb as s}from"./chunk-RMHEMJYH.js";var P=(n,e)=>e.type;function G(n,e){if(n&1){let t=h();a(0,"div",7)(1,"app-button",12),f("click",function(){let i=d(t).$implicit,l=s();return c(l.changeFilter(i.type))})("keydown.enter",function(){let i=d(t).$implicit,l=s();return c(l.changeFilter(i.type))}),r(),a(2,"span"),u(3),r()()}if(n&2){let t=e.$implicit,o=s();p(),x("text",t.label)("type","button")("color",o.currentFilter()===t.type?"tertiary":"secondary")("rounded",!0)("customClass","font-semibold transition-all duration-300 min-w-[120px]"),p(),F("absolute -top-2 -right-2 ",t.badgeColor," text-white text-xs font-bold px-2 py-1 rounded-full min-w-[20px] text-center shadow-md"),p(),v(" ",o.getCount(t.type)," ")}}function N(n,e){n&1&&(a(0,"div",9),b(1,"div",13),r())}function q(n,e){n&1&&(a(0,"div",10)(1,"p",14),u(2," Aucun avis trouv\xE9 pour ce filtre "),r()())}function H(n,e){if(n&1){let t=h();a(0,"app-button",12),f("click",function(){d(t);let i=s().$implicit,l=s(2);return c(l.validateOpinion(i))})("keydown.enter",function(){d(t);let i=s().$implicit,l=s(2);return c(l.validateOpinion(i))}),r(),a(1,"app-button",12),f("click",function(){let i;d(t);let l=s().$implicit,m=s(2);return c(m.rejectOpinion((i=l._id)!==null&&i!==void 0?i:""))})("keydown.enter",function(){let i;d(t);let l=s().$implicit,m=s(2);return c(m.rejectOpinion((i=l._id)!==null&&i!==void 0?i:""))}),r()}n&2&&(x("text","Valider")("type","button")("color","success")("rounded",!0)("customClass","text-sm px-4 py-2"),p(),x("text","Rejeter")("type","button")("color","danger")("rounded",!0)("customClass","text-sm px-4 py-2"))}function J(n,e){if(n&1){let t=h();a(0,"app-button",12),f("click",function(){let i;d(t);let l=s().$implicit,m=s(2);return c(m.deleteOpinion((i=l._id)!==null&&i!==void 0?i:""))})("keydown.enter",function(){let i;d(t);let l=s().$implicit,m=s(2);return c(m.deleteOpinion((i=l._id)!==null&&i!==void 0?i:""))}),r()}n&2&&x("text","Supprimer")("type","button")("color","danger")("rounded",!0)("customClass","text-sm px-4 py-2")}function K(n,e){if(n&1&&(a(0,"article",15)(1,"div",16)(2,"div",17)(3,"div",18)(4,"span",19),u(5),r()(),a(6,"div")(7,"h3",20),u(8),r(),a(9,"p",21),u(10),M(11,"date"),r()()(),b(12,"app-rate",22),r(),a(13,"p",23),u(14),r(),a(15,"div",24),y(16,H,2,10)(17,J,1,5,"app-button",25),r()()),n&2){let t=e.$implicit,o=s(2);p(5),v(" ",t.name.charAt(0)," "),p(3),v(" ",t.name," "),p(2),v(" ",k(11,7,t.date,"dd MMMM yyyy","fr-FR")," "),p(2),x("rating",o.createRatingSignal(t.rating))("isReadOnly",o.readOnlySignal),p(2),v('"',t.message,'"'),p(2),O(!t.validated&&!t.rejected?16:17)}}function Q(n,e){if(n&1&&(a(0,"div",11),w(1,K,18,11,"article",15,U),r()),n&2){let t=s();p(),S(t.opinions())}}var B=class n{constructor(e,t,o,i){this.userOpinionsService=e;this.toastService=t;this.router=o;this.route=i}allOpinions=_([]);readOnlySignal=_(!0);currentFilter=_("pending");isLoading=_(!1);filters=[{type:"pending",label:"En attente",badgeColor:"bg-yellow-500"},{type:"validated",label:"Valid\xE9s",badgeColor:"bg-green-500"},{type:"rejected",label:"Rejet\xE9s",badgeColor:"bg-red-500"}];opinions=C(()=>{switch(this.currentFilter()){case"pending":return this.allOpinions().filter(e=>e.status==="pending");case"validated":return this.allOpinions().filter(e=>e.status==="approved");case"rejected":return this.allOpinions().filter(e=>e.status==="rejected");default:return this.allOpinions()}});pendingCount=C(()=>this.allOpinions().filter(e=>e.status==="pending").length);validatedCount=C(()=>this.allOpinions().filter(e=>e.status==="approved").length);rejectedCount=C(()=>this.allOpinions().filter(e=>e.status==="rejected").length);ngOnInit(){this.loadAllOpinions(),this.initializeFilter()}initializeFilter(){let e=this.router.url.split("/").pop();e&&["pending","validated","rejected"].includes(e)&&this.currentFilter.set(e)}loadAllOpinions(){this.isLoading.set(!0),this.userOpinionsService.getAllUserOpinions().subscribe({next:e=>{this.allOpinions.set(e),this.isLoading.set(!1)},error:e=>{console.error("Erreur lors du chargement des avis:",e),this.toastService.showError("Erreur lors du chargement des avis"),this.isLoading.set(!1)}})}changeFilter(e){this.currentFilter.set(e),this.router.navigate([e],{relativeTo:this.route,replaceUrl:!0})}getCount(e){switch(e){case"pending":return this.pendingCount();case"validated":return this.validatedCount();case"rejected":return this.rejectedCount();default:return 0}}validateOpinion(e){e?._id&&this.userOpinionsService.validateUserOpinions(e._id).subscribe({next:()=>{this.loadAllOpinions(),this.toastService.showSuccess("Avis valid\xE9 avec succ\xE8s")},error:t=>{console.error("Erreur lors de la validation:",t),this.toastService.showError("Erreur lors de la validation")}})}rejectOpinion(e){this.userOpinionsService.rejectUserOpinions(e).subscribe({next:()=>{this.loadAllOpinions(),this.toastService.showSuccess("Avis rejet\xE9 avec succ\xE8s")},error:t=>{console.error("Erreur lors du rejet:",t),this.toastService.showError("Erreur lors du rejet")}})}deleteOpinion(e){confirm("\xCAtes-vous s\xFBr de vouloir supprimer cet avis ?")&&this.userOpinionsService.deleteUserOpinions(e).subscribe({next:()=>{this.loadAllOpinions(),this.toastService.showSuccess("Avis supprim\xE9 avec succ\xE8s")},error:t=>{console.error("Erreur lors de la suppression:",t),this.toastService.showError("Erreur lors de la suppression")}})}createRatingSignal(e){return _(e)}static \u0275fac=function(t){return new(t||n)(g(z),g(R),g(I),g(A))};static \u0275cmp=E({type:n,selectors:[["app-user-opinion-management"]],standalone:!0,features:[j],decls:16,vars:1,consts:[[1,"w-full","bg-gradient-to-b","from-secondary","to-primary","shadow-lg","py-8"],[1,"container","mx-auto","px-4"],[1,"text-center","space-y-4","mb-12"],[1,"text-3xl","md:text-5xl","lg:text-6xl","font-serif","font-bold","text-quinary"],[1,"text-lg","md:text-xl","text-tertiary","font-serif","italic","max-w-4xl","mx-auto"],[1,"flex","justify-center","mb-8"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-4","flex","gap-4"],[1,"relative"],[1,"space-y-4"],[1,"flex","justify-center","items-center","h-48"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-8","text-center"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[3,"click","keydown.enter","text","type","color","rounded","customClass"],[1,"animate-spin","rounded-full","h-12","w-12","border-4","border-tertiary","border-t-transparent"],[1,"text-gray-600","font-medium","text-lg"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-6","transition-all","duration-300","hover:shadow-xl","hover:-translate-y-1"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","gap-4"],[1,"w-12","h-12","bg-gradient-to-br","from-secondary","to-tertiary","rounded-full","flex","items-center","justify-center","shadow-md"],[1,"text-white","text-xl","font-semibold"],[1,"font-semibold","text-lg","text-tertiary"],[1,"text-sm","text-gray-500"],[3,"rating","isReadOnly"],[1,"text-gray-700","mb-6","italic"],[1,"flex","justify-end","gap-3","pt-4","border-t","border-gray-200"],[3,"text","type","color","rounded","customClass"]],template:function(t,o){t&1&&(a(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),u(4," Gestion des Avis Visiteurs "),r(),a(5,"p",4),u(6," G\xE9rez les avis et commentaires des visiteurs "),r(),b(7,"app-toast"),r(),a(8,"div",5)(9,"div",6),w(10,G,4,9,"div",7,P),r()(),a(12,"div",8),y(13,N,2,0,"div",9)(14,q,3,0,"div",10)(15,Q,3,0,"div",11),r()()()),t&2&&(p(10),S(o.filters),p(3),O(o.isLoading()?13:o.opinions().length===0?14:15))},dependencies:[V,T,L,D,$],encapsulation:2})};export{B as a};
