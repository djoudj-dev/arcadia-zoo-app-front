import{a as X}from"./chunk-GWO2KCD4.js";import{a as V,c as j,d as B,e as P,f as L,g as D,j as H,k as $,l as z,m as G,o as J,p as K}from"./chunk-2QYQOEU4.js";import{d as q}from"./chunk-ZZFP4HC6.js";import{p as W,s as N,t as Q}from"./chunk-H7WWMUX6.js";import{$ as R,$a as p,C as c,Da as a,Ea as w,Ia as v,Pa as m,T as A,Ta as E,Ua as S,Va as i,Wa as n,Y as k,Ya as I,a as h,ab as C,b as U,bb as T,cb as l,db as F,eb as u,gb as g,hb as f,ia as y,ib as b,ja as x,kb as O,o as M}from"./chunk-FRW6CNJS.js";var _=class d{constructor(e){this.http=e}apiUrl=`${N.apiUrl}/admin/account-management`;getAllUsers(){return this.http.get(this.apiUrl).pipe(c(e=>this.handleError("chargement des utilisateurs",e)))}createUser(e){return this.http.post(this.apiUrl,e).pipe(c(t=>this.handleError("cr\xE9ation d\u2019utilisateur",t)))}updateUser(e){return this.http.put(`${this.apiUrl}/${e.id}`,e).pipe(c(t=>this.handleError("mise \xE0 jour d\u2019utilisateur",t)))}deleteUser(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(c(t=>this.handleError("suppression d\u2019utilisateur",t)))}getRoles(){return this.http.get(`${this.apiUrl}/roles`).pipe(c(e=>this.handleError("chargement des r\xF4les",e)))}handleError(e,t){return console.error(`Erreur lors de ${e} :`,t.message),M(()=>new Error(`Erreur de ${e}.`))}static \u0275fac=function(t){return new(t||d)(k(W))};static \u0275prov=A({token:d,factory:d.\u0275fac,providedIn:"root"})};var Y=(d,e)=>e.id;function re(d,e){if(d&1&&(i(0,"option",15),l(1),n()),d&2){let t=e.$implicit;m("ngValue",t),a(),F(t.name)}}function ne(d,e){if(d&1){let t=I();i(0,"div",19)(1,"h4",23),l(2),n(),i(3,"p",24)(4,"span",25),l(5,"Email :"),n(),l(6),n(),i(7,"p",24)(8,"span",25),l(9,"R\xF4le :"),n(),l(10),n(),i(11,"div",26)(12,"app-button",27),p("click",function(){let s=y(t).$implicit,o=C();return x(o.editUser(s))}),n(),i(13,"app-button",27),p("click",function(){let s=y(t).$implicit,o=C();return x(o.deleteAccount(s.id))}),n()()()}if(d&2){let t=e.$implicit;a(2),u(" ",t.name," "),a(4),u(" ",t.email," "),a(4),u(" ",t.role?t.role.name:"R\xF4le non d\xE9fini"," "),a(2),m("text","Modifier")("type","button")("color","secondary")("rounded",!0)("customClass","text-xs px-2 py-1 w-auto font-bold"),a(),m("text","Supprimer")("type","button")("color","red")("rounded",!0)("customClass","text-xs px-2 py-1 w-auto font-bold")}}var Z=class d{constructor(e,t,r){this.router=e;this.accountService=t;this.statsService=r}users=v([]);roles=v([]);newUser=v({});ngOnInit(){this.loadUsers(),this.loadRoles()}loadUsers(){this.accountService.getAllUsers().subscribe({next:e=>this.users.set(e||[]),error:e=>console.error("Erreur de chargement des utilisateurs :",e)})}loadRoles(){this.accountService.getRoles().subscribe({next:e=>this.roles.set(e||[]),error:e=>console.error("Erreur de chargement des r\xF4les :",e)})}createAccount(){let{name:e,password:t,role:r}=this.newUser();e&&t&&r&&r.id?this.accountService.createUser(U(h({},this.newUser()),{role_id:r.id})).subscribe({next:s=>{this.users.update(o=>[...o,s]),this.newUser.set({}),this.statsService.incrementTotalEmploye()},error:s=>console.error("Erreur de cr\xE9ation d'utilisateur :",s)}):console.log("Champs requis manquants")}updateAccount(){let{name:e,role:t}=this.newUser();if(e||t&&t.id){let r=h({},this.newUser());t&&(r.role_id=t.id),this.accountService.updateUser(r).subscribe({next:()=>{this.loadUsers(),this.newUser.set({})},error:s=>console.error("Erreur de mise \xE0 jour d'utilisateur :",s)})}else console.log("Champs requis manquants pour la mise \xE0 jour")}editUser(e){this.newUser.set(U(h({},e),{password:""}))}deleteAccount(e){this.accountService.deleteUser(e).subscribe({next:()=>{this.users.update(t=>t.filter(r=>r.id!==e)),this.statsService.decrementTotalEmploye()},error:t=>console.error("Erreur de suppression d'utilisateur :",t)})}cancel(){this.newUser.set({})}goBack(){this.router.navigate(["/admin"])}static \u0275fac=function(t){return new(t||d)(w(q),w(_),w(X))};static \u0275cmp=R({type:d,selectors:[["app-account-management"]],standalone:!0,features:[O],decls:40,vars:19,consts:[[1,"account-management","mb-12","p-6","bg-secondary","rounded-lg","shadow-xl","shadow-tertiary"],[1,"text-2xl","font-semibold","mb-8","text-center"],[1,"flex","flex-col","lg:flex-row","gap-8"],[1,"w-full","lg:w-1/2","bg-gray-100","p-6","rounded-lg","shadow-sm"],[1,"text-xl","font-semibold","mb-4"],[1,"space-y-4"],["for","name",1,"block","text-lg","font-medium","mb-2"],["type","text","id","name","name","name","required","",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"ngModelChange","ngModel"],["for","email",1,"block","text-lg","font-medium","mb-2"],["type","email","id","email","name","email","required","",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"ngModelChange","ngModel"],["for","password",1,"block","text-lg","font-medium","mb-2"],["type","password","id","password","name","password",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"ngModelChange","ngModel","required","placeholder"],["for","role",1,"block","text-lg","font-medium","mb-2"],["id","role","name","role","required","",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"ngModelChange","ngModel"],["value",""],[3,"ngValue"],[1,"flex","space-x-2"],[1,"w-1/2","sm:w-1/3","lg:w-1/4","font-bold","px-4",3,"click","text","type","color","rounded"],[1,"grid","grid-cols-1","gap-4","md:grid-cols-2","lg:grid-cols-2","xl:grid-cols-3"],[1,"bg-white","p-4","rounded-lg","shadow-lg","transition-transform","duration-300","hover:scale-105","border","border-gray-300"],[1,"flex","justify-center","pt-4"],[1,"w-full","sm:w-1/4","lg:w-1/5"],[1,"w-full","font-bold","py-1","sm:px-4","sm:py-2","text-sm","sm:text-base",3,"click","text","type","color","rounded"],[1,"text-lg","font-bold","text-gray-800","mb-2"],[1,"text-sm","text-gray-600","mb-1"],[1,"font-semibold"],[1,"flex","space-x-2","mt-4"],[3,"click","text","type","color","rounded","customClass"]],template:function(t,r){t&1&&(i(0,"section",0)(1,"h2",1),l(2," Cr\xE9ation et gestion des comptes "),n(),i(3,"div",2)(4,"div",3)(5,"h3",4),l(6),n(),i(7,"form",5)(8,"div")(9,"label",6),l(10,"Nom d'utilisateur:"),n(),i(11,"input",7),b("ngModelChange",function(o){return f(r.newUser().name,o)||(r.newUser().name=o),o}),n()(),i(12,"div")(13,"label",8),l(14,"Email:"),n(),i(15,"input",9),b("ngModelChange",function(o){return f(r.newUser().email,o)||(r.newUser().email=o),o}),n()(),i(16,"div")(17,"label",10),l(18,"Mot de passe:"),n(),i(19,"input",11),b("ngModelChange",function(o){return f(r.newUser().password,o)||(r.newUser().password=o),o}),n()(),i(20,"div")(21,"label",12),l(22,"R\xF4le:"),n(),i(23,"select",13),b("ngModelChange",function(o){return f(r.newUser().role,o)||(r.newUser().role=o),o}),i(24,"option",14),l(25,"- Choisir un r\xF4le -"),n(),E(26,re,2,2,"option",15,Y),n()(),i(28,"div",16)(29,"app-button",17),p("click",function(){return r.newUser().id?r.updateAccount():r.createAccount()}),n(),i(30,"app-button",17),p("click",function(){return r.cancel()}),n()()()(),i(31,"div",3)(32,"h3",4),l(33,"Liste des comptes"),n(),i(34,"div",18),E(35,ne,14,13,"div",19,Y),n()()(),i(37,"div",20)(38,"div",21)(39,"app-button",22),p("click",function(){return r.goBack()}),n()()()()),t&2&&(a(6),u(" ",r.newUser().id?"Modifier le compte":"Cr\xE9er un compte"," "),a(5),g("ngModel",r.newUser().name),a(4),g("ngModel",r.newUser().email),a(4),T("placeholder",r.newUser().id?"Laissez vide si non modifi\xE9":"Mot de passe requis"),g("ngModel",r.newUser().password),m("required",!r.newUser().id),a(4),g("ngModel",r.newUser().role),a(3),S(r.roles()),a(3),m("text",r.newUser().id?"Modifier":"Cr\xE9er")("type","button")("color","tertiary")("rounded",!0),a(),m("text","Annuler")("type","button")("color","secondary")("rounded",!0),a(5),S(r.users()),a(4),m("text","Retour")("type","button")("color","tertiary")("rounded",!0))},dependencies:[Q,K,D,$,z,V,H,j,B,G,J,L,P],encapsulation:2})};export{Z as AccountManagementComponent};
