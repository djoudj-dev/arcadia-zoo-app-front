import{a as oe}from"./chunk-3EHHO275.js";import{a as le}from"./chunk-TVVECW45.js";import{a as me}from"./chunk-GWO2KCD4.js";import{a as z,c as J,d as K,e as Q,f as X,g as Y,j as Z,k as ee,l as te,m as ie,o as ne,p as ae}from"./chunk-2QYQOEU4.js";import{k as L,p as G,s as T,t as re}from"./chunk-H7WWMUX6.js";import{$ as q,$a as u,C as w,Cb as U,Da as m,Ea as M,Ia as c,Na as S,Pa as p,Q as y,Ra as f,T as $,Ta as E,Ua as F,Va as n,Wa as r,Xa as V,Y as H,Ya as W,a as b,ab as d,b as A,cb as s,db as I,eb as x,gb as g,hb as _,ia as v,ib as h,ja as C,kb as N,lb as D,o as O,ob as B,rb as P,za as R}from"./chunk-FRW6CNJS.js";var k=class a{constructor(t,e){this.http=t;this.animalService=e}apiUrl=`${T.apiUrl}/admin/animal-management`;getAllAnimals(){return this.http.get(this.apiUrl).pipe(w(t=>this.handleError("chargement des animaux",t)))}createAnimal(t){return this.http.post(this.apiUrl,t).pipe(y(()=>this.animalService.clearCache()),w(e=>this.handleError("cr\xE9ation de l\u2019animal",e)))}updateAnimal(t,e){return this.http.put(`${this.apiUrl}/${t}`,e).pipe(y(()=>this.animalService.clearCache()),w(i=>this.handleError("mise \xE0 jour de l\u2019animal",i)))}deleteAnimal(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(y(()=>this.animalService.clearCache()),w(e=>this.handleError("suppression de l\u2019animal",e)))}handleError(t,e){return console.error(`Erreur lors de ${t} :`,e),O(()=>new Error(`Erreur lors de ${t}.`))}static \u0275fac=function(e){return new(e||a)(H(G),H(oe))};static \u0275prov=$({token:a,factory:a.\u0275fac,providedIn:"root"})};var se=(a,t)=>t.id_habitat,ue=(a,t)=>t.id_animal,j=()=>[];function ge(a,t){if(a&1&&(n(0,"option",14),s(1),r()),a&2){let e=t.$implicit;p("value",e.id_habitat),m(),x(" ",e.name," ")}}function _e(a,t){if(a&1&&(s(0),B(1,"slice")),a&2){let e=d(2).$implicit;x(" ",P(1,1,e.characteristics,0,30),"... ")}}function he(a,t){if(a&1&&s(0),a&2){let e=d(2).$implicit;x(" ",e.characteristics," ")}}function be(a,t){a&1&&s(0," Lire la suite ")}function fe(a,t){a&1&&s(0," Voir moins ")}function xe(a,t){if(a&1){let e=W();n(0,"div",33),V(1,"img",34),n(2,"div",35)(3,"h4",36),s(4),r(),n(5,"p",37),s(6),r(),n(7,"p",37)(8,"span",38),s(9,"Description:"),r(),n(10,"span"),S(11,_e,2,5)(12,he,1,1),r(),n(13,"button",39),u("click",function(){v(e);let o=d().$implicit,l=d(2);return C(l.toggleAnimal(o.id_animal))}),S(14,be,1,0)(15,fe,1,0),r()()(),n(16,"div",40)(17,"app-button",41),u("click",function(){v(e);let o=d().$implicit,l=d(2);return C(l.editAnimal(o.id_animal))}),r(),n(18,"app-button",41),u("click",function(){v(e);let o=d().$implicit,l=d(2);return C(l.deleteAnimal(o.id_animal))}),r()()()}if(a&2){let e=d().$implicit;m(),p("src",e.images,R),m(3),I(e.name),m(2),I(e.species),m(5),f(e.showTime?12:11),m(3),f(e.showTime?15:14),m(3),p("text","Modifier")("type","button")("color","tertiary")("rounded",!0)("customClass","text-xs px-2 py-1 font-bold"),m(),p("text","Supprimer")("type","button")("color","red")("rounded",!0)("customClass","text-xs px-2 py-1 font-bold")}}function Ae(a,t){if(a&1&&S(0,xe,19,15,"div",33),a&2){let e=t.$implicit,i=d().$implicit,o=d();f(o.visibleAnimals()[i.id_habitat]||o.groupedAnimals()[i.id_habitat].indexOf(e)===0?0:-1)}}function we(a,t){if(a&1){let e=W();n(0,"div",31)(1,"app-button",41),u("click",function(){v(e);let o=d().$implicit,l=d();return C(l.toggleVisibility(o.id_habitat))}),r()()}if(a&2){let e=d().$implicit,i=d();m(),p("text",i.visibleAnimals()[e.id_habitat]?"Voir moins":"Voir plus")("type","button")("color","tertiary")("rounded",!0)("customClass","px-4 py-2 font-bold")}}function ve(a,t){a&1&&(n(0,"p",32),s(1,"Aucun animal dans cet habitat"),r())}function Ce(a,t){if(a&1&&(n(0,"div",28)(1,"h3",29),s(2),r(),n(3,"div",30),E(4,Ae,1,1,null,null,ue),S(6,we,2,5,"div",31)(7,ve,2,0,"p",32),r()()),a&2){let e=t.$implicit,i=d();m(2),x(" ",e.name," "),m(2),F(i.groupedAnimals()[e.id_habitat]||D(3,j)),m(2),f((i.groupedAnimals()[e.id_habitat]||D(4,j)).length>1?6:-1),m(),f((i.groupedAnimals()[e.id_habitat]||D(5,j)).length?-1:7)}}var de=class a{constructor(t,e,i){this.animalManagement=t;this.habitatService=e;this.statsService=i}animals=c([]);habitats=c([]);selectedHabitat=c(null);selectedFile=c(null);groupedAnimals=c({});visibleAnimals=c({});newAnimalData=c({});imageBaseUrl=`${T.apiUrl}`;filteredAnimals=U(()=>this.animals().filter(t=>t.habitat_id===this.selectedHabitat()));ngOnInit(){this.loadHabitats(),this.loadAnimals()}loadHabitats(){this.habitatService.getHabitats().subscribe({next:t=>this.habitats.set(t),error:t=>console.error("Erreur de chargement des habitats :",t)})}loadAnimals(){this.animalManagement.getAllAnimals().subscribe({next:t=>{this.animals.set(t.map(e=>A(b({},e),{showTime:!1,images:`${this.imageBaseUrl}/${e.images}`}))),this.groupAnimals()},error:t=>console.error("Erreur de chargement des animaux :",t)})}onFileChange(t){let e=t.target;e.files&&e.files.length>0&&(this.selectedFile.set(e.files[0]),console.log("Fichier s\xE9lectionn\xE9 :",e.files[0]))}createAnimal(){if(this.validateAnimalData()){let t=this.buildFormData();this.animalManagement.createAnimal(t).subscribe({next:e=>{console.log("Animal cr\xE9\xE9 avec succ\xE8s:",e),this.resetForm(),this.loadAnimals(),this.statsService.incrementTotalAnimals()},error:e=>console.error("Erreur de cr\xE9ation de l'animal :",e)})}else console.error("Champs requis manquants")}updateAnimal(){if(this.validateAnimalData(!0)){let t=this.buildFormData();this.animalManagement.updateAnimal(this.newAnimalData().id_animal.toString(),t).subscribe({next:e=>{console.log("Animal mis \xE0 jour avec succ\xE8s :",e),this.animals.update(i=>i.map(o=>o.id_animal===e.id_animal?A(b({},e),{showTime:o.showTime,images:`${this.imageBaseUrl}/${e.images}`}):o)),this.resetForm()},error:e=>console.error("Erreur de mise \xE0 jour de l'animal :",e)})}else console.error("Champs requis manquants pour la mise \xE0 jour")}editAnimal(t){let e=this.animals().find(i=>i.id_animal===t);e&&(this.newAnimalData.set(b({},e)),console.log("Formulaire pr\xE9-rempli pour l'animal :",e))}deleteAnimal(t){this.animalManagement.deleteAnimal(t.toString()).subscribe({next:()=>{this.animals.update(e=>e.filter(i=>i.id_animal!==t)),this.statsService.decrementTotalAnimals(),this.resetForm()},error:e=>console.error("Erreur de suppression de l'animal :",e)})}resetForm(){this.newAnimalData.set({}),this.selectedFile.set(null)}cancel(){this.resetForm()}toggleAnimal(t){this.animals.update(e=>e.map(i=>i.id_animal===t?A(b({},i),{showTime:!i.showTime}):i))}toggleVisibility(t){this.visibleAnimals.update(e=>A(b({},e),{[t]:!e[t]}))}validateAnimalData(t=!1){let e=[this.newAnimalData().name,this.newAnimalData().species,this.newAnimalData().habitat_id,this.newAnimalData().characteristics,this.newAnimalData().weightRange,this.newAnimalData().diet];return t&&e.push(this.newAnimalData().id_animal),e.every(i=>i!=null)}buildFormData(){let t=new FormData;Object.entries(this.newAnimalData()).forEach(([i,o])=>{t.append(i,o?.toString()||"")});let e=this.selectedFile();return e&&t.append("images",e),t}groupAnimals(){let t=this.animals().reduce((e,i)=>((e[i.habitat_id]=e[i.habitat_id]||[]).push(i),e),{});this.groupedAnimals.set(t)}static \u0275fac=function(e){return new(e||a)(M(k),M(le),M(me))};static \u0275cmp=q({type:a,selectors:[["app-animal-management"]],standalone:!0,features:[N],decls:52,vars:15,consts:[[1,"animals-management","mb-12","p-6","bg-secondary","rounded-lg","shadow-xl","shadow-tertiary"],[1,"text-2xl","sm:text-3xl","font-semibold","mb-8","text-center"],[1,"flex","flex-col","lg:flex-row","gap-8"],[1,"w-full","lg:w-1/2","bg-gray-100","p-6","rounded-lg","shadow-sm"],[1,"text-xl","font-semibold","mb-4"],["enctype","multipart/form-data",1,"space-y-3","sm:space-y-4",3,"ngSubmit"],["for","name",1,"block","text-base","sm:text-lg","font-medium","mb-1","sm:mb-2"],["type","text","id","name","name","name","required","","placeholder","Nom de l'animal",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"ngModelChange","ngModel"],["for","species",1,"block","text-base","sm:text-lg","font-medium","mb-1","sm:mb-2"],["type","text","id","species","name","species","required","","placeholder","Esp\xE8ce de l'animal",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"ngModelChange","ngModel"],["for","animal-image",1,"block","text-base","sm:text-lg","font-medium","mb-1","sm:mb-2"],["type","file","id","animal-image",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"change"],["for","animal-habitat",1,"block","text-base","sm:text-lg","font-medium","mb-1","sm:mb-2"],["id","animal-habitat","name","habitat_id","required","",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"ngModelChange","ngModel"],[3,"value"],["for","characteristics",1,"block","text-base","sm:text-lg","font-medium","mb-1","sm:mb-2"],["id","characteristics","name","characteristics","required","","placeholder","Ex: sociable, actif, joueur",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"ngModelChange","ngModel"],["for","weight-range",1,"block","text-base","sm:text-lg","font-medium","mb-1","sm:mb-2"],["type","text","id","weight-range","name","weightRange","required","","placeholder","Ex: 150 \xE0 300 kg",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"ngModelChange","ngModel"],["for","diet",1,"block","text-base","sm:text-lg","font-medium","mb-1","sm:mb-2"],["id","diet","name","diet","required","",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"ngModelChange","ngModel"],["value","Herbivore"],["value","Carnivore"],["value","Omnivore"],[1,"flex","space-x-2"],[1,"w-full","sm:w-1/2","lg:w-1/4","font-bold","px-4",3,"text","type","color","rounded"],[1,"w-full","sm:w-1/2","lg:w-1/4","font-bold","px-4",3,"click","text","type","color","rounded"],[1,"animals-management","mb-12","p-6","bg-primary","rounded-lg","shadow-xl","shadow-tertiary"],[1,"bg-secondary","p-6","rounded-lg","shadow-lg","mb-8"],[1,"text-xl","font-semibold","mb-4","text-center"],[1,"space-y-4"],[1,"text-center","mt-4"],[1,"text-gray-500","text-center"],[1,"p-4","bg-white","rounded-lg","shadow-md","flex","flex-col","sm:flex-row","items-center"],["alt","Photo de l'animal",1,"w-24","h-24","sm:w-32","sm:h-32","object-cover","rounded-lg","shadow-md","mb-4","sm:mb-0","sm:mr-4",3,"src"],[1,"flex-1"],[1,"text-lg","font-semibold"],[1,"text-sm","sm:text-base"],[1,"font-semibold"],[1,"text-blue-500","hover:underline","mt-2",3,"click"],[1,"flex","space-x-2","mt-4","sm:mt-0","sm:ml-4"],[3,"click","text","type","color","rounded","customClass"]],template:function(e,i){e&1&&(n(0,"section",0)(1,"h2",1),s(2," Gestion des animaux "),r(),n(3,"div",2)(4,"div",3)(5,"h3",4),s(6),r(),n(7,"form",5),u("ngSubmit",function(){return i.newAnimalData().id_animal?i.updateAnimal():i.createAnimal()}),n(8,"div")(9,"label",6),s(10," Nom de l'animal: "),r(),n(11,"input",7),h("ngModelChange",function(l){return _(i.newAnimalData().name,l)||(i.newAnimalData().name=l),l}),r()(),n(12,"div")(13,"label",8),s(14," Esp\xE8ce: "),r(),n(15,"input",9),h("ngModelChange",function(l){return _(i.newAnimalData().species,l)||(i.newAnimalData().species=l),l}),r()(),n(16,"div")(17,"label",10),s(18," Photo de l'animal: "),r(),n(19,"input",11),u("change",function(l){return i.onFileChange(l)}),r()(),n(20,"div")(21,"label",12),s(22," Habitat: "),r(),n(23,"select",13),h("ngModelChange",function(l){return _(i.newAnimalData().habitat_id,l)||(i.newAnimalData().habitat_id=l),l}),E(24,ge,2,2,"option",14,se),r()(),n(26,"div")(27,"label",15),s(28," Caract\xE9ristiques: "),r(),n(29,"textarea",16),h("ngModelChange",function(l){return _(i.newAnimalData().characteristics,l)||(i.newAnimalData().characteristics=l),l}),r()(),n(30,"div")(31,"label",17),s(32," Fourchette de poids: "),r(),n(33,"input",18),h("ngModelChange",function(l){return _(i.newAnimalData().weightRange,l)||(i.newAnimalData().weightRange=l),l}),r()(),n(34,"div")(35,"label",19),s(36," R\xE9gime alimentaire: "),r(),n(37,"select",20),h("ngModelChange",function(l){return _(i.newAnimalData().diet,l)||(i.newAnimalData().diet=l),l}),n(38,"option",21),s(39,"Herbivore"),r(),n(40,"option",22),s(41,"Carnivore"),r(),n(42,"option",23),s(43,"Omnivore"),r()()(),n(44,"div",24),V(45,"app-button",25),n(46,"app-button",26),u("click",function(){return i.cancel()}),r()()()(),n(47,"section",27)(48,"h2",1),s(49," Gestion des animaux par habitat "),r(),E(50,Ce,8,6,"div",28,se),r()()()),e&2&&(m(6),x(" ",i.newAnimalData().id_animal?"Modifier l'animal":"Ajouter un animal"," "),m(5),g("ngModel",i.newAnimalData().name),m(4),g("ngModel",i.newAnimalData().species),m(8),g("ngModel",i.newAnimalData().habitat_id),m(),F(i.habitats()),m(5),g("ngModel",i.newAnimalData().characteristics),m(4),g("ngModel",i.newAnimalData().weightRange),m(4),g("ngModel",i.newAnimalData().diet),m(8),p("text",i.newAnimalData().id_animal?"Modifier":"Cr\xE9er")("type","submit")("color","tertiary")("rounded",!0),m(),p("text","Annuler")("type","button")("color","secondary")("rounded",!0),m(4),F(i.habitats()))},dependencies:[re,L,ae,Y,ee,te,z,Z,J,K,ie,ne,X,Q],encapsulation:2})};export{de as AnimalManagementComponent};
