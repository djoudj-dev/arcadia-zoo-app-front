<section class="min-h-screen bg-primary py-12 px-4 md:px-8">
  <div class="max-w-5xl mx-auto">
    <!-- En-tête -->
    <header class="text-center mb-12">
      <h1 class="text-3xl font-serif text-quinary mb-4">
        Gestion des avis visiteurs
      </h1>
    </header>

    <!-- Filtres -->
    <div class="flex justify-center mb-10">
      <div
        class="inline-flex items-center bg-white/80 backdrop-blur-sm rounded-2xl p-3 shadow-lg gap-3"
      >
        <div class="relative">
          <app-button
            [text]="'En attente'"
            [type]="'button'"
            [color]="currentFilter() === 'pending' ? 'tertiary' : 'secondary'"
            [rounded]="true"
            [customClass]="
              'font-semibold transition-all duration-300 min-w-[120px]'
            "
            (click)="changeFilter('pending')"
          ></app-button>
          <span
            class="absolute -top-2 -right-2 bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded-full min-w-[20px] text-center"
          >
            {{ getPendingCount() }}
          </span>
        </div>
        <div class="relative">
          <app-button
            [text]="'Validés'"
            [type]="'button'"
            [color]="currentFilter() === 'validated' ? 'tertiary' : 'secondary'"
            [rounded]="true"
            [customClass]="
              'font-semibold transition-all duration-300 min-w-[120px]'
            "
            (click)="changeFilter('validated')"
          ></app-button>
          <span
            class="absolute -top-2 -right-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full min-w-[20px] text-center"
          >
            {{ getValidatedCount() }}
          </span>
        </div>
        <div class="relative">
          <app-button
            [text]="'Rejetés'"
            [type]="'button'"
            [color]="currentFilter() === 'rejected' ? 'tertiary' : 'secondary'"
            [rounded]="true"
            [customClass]="
              'font-semibold transition-all duration-300 min-w-[120px]'
            "
            (click)="changeFilter('rejected')"
          ></app-button>
          <span
            class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full min-w-[20px] text-center"
          >
            {{ getRejectedCount() }}
          </span>
        </div>
      </div>
    </div>

    <!-- Contenu principal -->
    <main class="space-y-6">
      <!-- État de chargement -->
      @if (isLoading()) {
      <div class="flex justify-center items-center h-48">
        <div
          class="animate-spin rounded-full h-12 w-12 border-4 border-tertiary border-t-transparent"
        ></div>
      </div>
      } @else {
      <!-- Message si aucun avis -->
      @if (opinions().length === 0) {
      <div class="bg-white rounded-lg shadow-lg p-8 text-center">
        <p class="text-gray-500 font-medium text-lg">
          Aucun avis trouvé pour ce filtre.
        </p>
      </div>
      } @else {
      <!-- Liste des avis -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        @for (opinion of opinions(); track $index) {
        <article
          class="bg-white rounded-lg shadow-lg p-8 transition-all duration-300 border border-quinary/10 hover:border-quinary/20 flex flex-col h-full"
        >
          <!-- En-tête de l'avis -->
          <div class="flex items-center justify-between mb-6">
            <!-- Informations utilisateur -->
            <div class="flex items-center gap-4">
              <!-- Avatar avec première lettre du nom -->
              <div
                class="w-12 h-12 bg-secondary rounded-full flex items-center justify-center"
              >
                <span class="text-white text-xl font-semibold">
                  {{ opinion.name?.charAt(0) ?? "" }}
                </span>
              </div>
              <!-- Nom et date -->
              <div>
                <h3 class="font-semibold text-lg text-quinary">
                  {{ opinion.name }}
                </h3>
                <p class="text-sm text-gray-500">
                  {{ opinion.date | date : "dd MMMM yyyy" : "fr-FR" }}
                </p>
              </div>
            </div>
            <!-- Note -->
            <app-rate
              [rating]="createRatingSignal(opinion.rating)"
              [isReadOnly]="readOnlySignal"
            ></app-rate>
          </div>

          <!-- Corps de l'avis -->
          <p class="text-gray-700 mb-6 italic flex-grow">
            "{{ opinion.message }}"
          </p>

          <!-- Actions -->
          @if (!opinion.validated && !opinion.rejected) {
          <!-- Boutons pour les avis en attente -->
          <div
            class="flex justify-center mt-auto pt-6 border-t border-gray-100"
          >
            <app-button
              [text]="'Valider'"
              [type]="'button'"
              [color]="'success'"
              [rounded]="true"
              class="w-1/3 font-bold mx-2"
              (click)="validateOpinion(opinion)"
              [disabled]="!opinion?._id"
            ></app-button>
            <app-button
              [text]="'Rejeter'"
              [type]="'button'"
              [color]="'danger'"
              [rounded]="true"
              class="w-1/3 font-bold mx-2"
              (click)="rejectOpinion(opinion._id)"
              [disabled]="!opinion?._id"
            ></app-button>
          </div>
          } @else if (opinion.validated) {
          <!-- Bouton pour les avis validés -->
          <div
            class="flex justify-center mt-auto pt-6 border-t border-gray-100"
          >
            <app-button
              [text]="'Supprimer'"
              [type]="'button'"
              [color]="'danger'"
              [rounded]="true"
              class="w-1/3 font-bold"
              (click)="deleteOpinion(opinion._id)"
              [disabled]="!opinion?._id"
            ></app-button>
          </div>
          } @else if (opinion.rejected) {
          <!-- Boutons pour les avis rejetés -->
          <div
            class="flex justify-center mt-auto pt-6 border-t border-gray-100 gap-3"
          >
            <app-button
              [text]="'Supprimer'"
              [type]="'button'"
              [color]="'danger'"
              [rounded]="true"
              class="w-1/3 font-bold"
              (click)="deleteOpinion(opinion._id)"
              [disabled]="!opinion?._id"
            ></app-button>
          </div>
          }
        </article>
        }
      </div>
      } }
    </main>
  </div>
</section>
