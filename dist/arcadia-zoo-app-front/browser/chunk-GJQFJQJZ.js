import{a as $,b as N}from"./chunk-AAFKMVCJ.js";import{a as R}from"./chunk-GYUXLAZ6.js";import{a as I}from"./chunk-TTATSR4U.js";import{c as V,e as A}from"./chunk-PRIUQE34.js";import{a as D}from"./chunk-G3OXHIUX.js";import{Bb as b,Db as v,Fb as a,Hc as k,Ic as T,Ka as d,Pa as g,Pb as M,Qb as u,Sb as x,Wa as S,Yb as F,cc as j,fc as U,ha as p,ia as c,lb as y,lc as f,mb as h,nb as E,pb as O,qa as m,qb as w,rb as _,sb as o,tb as n,ub as C}from"./chunk-JLM7LPRF.js";var z=(i,e)=>e.type;function B(i,e){if(i&1){let t=b();o(0,"div",7)(1,"app-button",12),v("click",function(){let s=p(t).$implicit,l=a();return c(l.changeFilter(s.type))})("keydown.enter",function(){let s=p(t).$implicit,l=a();return c(l.changeFilter(s.type))}),n(),o(2,"span"),u(3),n()()}if(i&2){let t=e.$implicit,r=a();d(),_("text",t.label)("type","button")("color",r.currentFilter()===t.type?"tertiary":"secondary")("rounded",!0)("customClass","font-semibold transition-all duration-300 min-w-[120px]"),d(),M(F("absolute -top-2 -right-2 ",t.badgeColor," text-white text-xs font-bold px-2 py-1 rounded-full min-w-[20px] text-center shadow-md")),d(),x(" ",r.getCount(t.type)," ")}}function P(i,e){i&1&&(o(0,"div",9),C(1,"div",13),n())}function G(i,e){i&1&&(o(0,"div",10)(1,"p",14),u(2," Aucun avis trouv\xE9 pour ce filtre "),n()())}function q(i,e){if(i&1){let t=b();o(0,"app-button",12),v("click",function(){p(t);let s=a().$implicit,l=a(2);return c(l.validateOpinion(s))})("keydown.enter",function(){p(t);let s=a().$implicit,l=a(2);return c(l.validateOpinion(s))}),n(),o(1,"app-button",12),v("click",function(){p(t);let s=a().$implicit,l=a(2);return c(l.rejectOpinion(s._id??""))})("keydown.enter",function(){p(t);let s=a().$implicit,l=a(2);return c(l.rejectOpinion(s._id??""))}),n()}i&2&&(_("text","Valider")("type","button")("color","success")("rounded",!0)("customClass","text-sm px-4 py-2"),d(),_("text","Rejeter")("type","button")("color","danger")("rounded",!0)("customClass","text-sm px-4 py-2"))}function H(i,e){if(i&1){let t=b();o(0,"app-button",12),v("click",function(){p(t);let s=a().$implicit,l=a(2);return c(l.deleteOpinion(s._id??""))})("keydown.enter",function(){p(t);let s=a().$implicit,l=a(2);return c(l.deleteOpinion(s._id??""))}),n()}i&2&&_("text","Supprimer")("type","button")("color","danger")("rounded",!0)("customClass","text-sm px-4 py-2")}function J(i,e){if(i&1&&(o(0,"article",15)(1,"div",16)(2,"div",17)(3,"div",18)(4,"span",19),u(5),n()(),o(6,"div")(7,"h3",20),u(8),n(),o(9,"p",21),u(10),j(11,"date"),n()()(),C(12,"app-rate",22),n(),o(13,"p",23),u(14),n(),o(15,"div",24),y(16,q,2,10)(17,H,1,5,"app-button",25),n()()),i&2){let t=e.$implicit,r=a(2);d(5),x(" ",t.name.charAt(0)," "),d(3),x(" ",t.name," "),d(2),x(" ",U(11,7,t.date,"dd MMMM yyyy","fr-FR")," "),d(2),_("rating",r.createRatingSignal(t.rating))("isReadOnly",r.readOnlySignal),d(2),x('"',t.message,'"'),d(2),h(!t.validated&&!t.rejected?16:17)}}function K(i,e){if(i&1&&(o(0,"div",11),O(1,J,18,11,"article",15,E),n()),i&2){let t=a();d(),w(t.opinions())}}var L=class i{constructor(e,t,r,s){this.userOpinionsService=e;this.toastService=t;this.router=r;this.route=s}allOpinions=m([]);readOnlySignal=m(!0);currentFilter=m("pending");isLoading=m(!1);filters=[{type:"pending",label:"En attente",badgeColor:"bg-yellow-500"},{type:"validated",label:"Valid\xE9s",badgeColor:"bg-green-500"},{type:"rejected",label:"Rejet\xE9s",badgeColor:"bg-red-500"}];opinions=f(()=>{switch(this.currentFilter()){case"pending":return this.allOpinions().filter(e=>e.status==="pending");case"validated":return this.allOpinions().filter(e=>e.status==="approved");case"rejected":return this.allOpinions().filter(e=>e.status==="rejected");default:return this.allOpinions()}});pendingCount=f(()=>this.allOpinions().filter(e=>e.status==="pending").length);validatedCount=f(()=>this.allOpinions().filter(e=>e.status==="approved").length);rejectedCount=f(()=>this.allOpinions().filter(e=>e.status==="rejected").length);ngOnInit(){this.loadAllOpinions(),this.initializeFilter()}initializeFilter(){let e=this.router.url.split("/").pop();e&&["pending","validated","rejected"].includes(e)&&this.currentFilter.set(e)}loadAllOpinions(){this.isLoading.set(!0),this.userOpinionsService.getAllUserOpinions().subscribe({next:e=>{this.allOpinions.set(e),this.isLoading.set(!1)},error:e=>{console.error("Erreur lors du chargement des avis:",e),this.toastService.showError("Erreur lors du chargement des avis"),this.isLoading.set(!1)}})}changeFilter(e){this.currentFilter.set(e),this.router.navigate([e],{relativeTo:this.route,replaceUrl:!0})}getCount(e){switch(e){case"pending":return this.pendingCount();case"validated":return this.validatedCount();case"rejected":return this.rejectedCount();default:return 0}}validateOpinion(e){e?._id&&this.userOpinionsService.validateUserOpinions(e._id).subscribe({next:()=>{this.loadAllOpinions(),this.toastService.showSuccess("Avis valid\xE9 avec succ\xE8s")},error:t=>{console.error("Erreur lors de la validation:",t),this.toastService.showError("Erreur lors de la validation")}})}rejectOpinion(e){this.userOpinionsService.rejectUserOpinions(e).subscribe({next:()=>{this.loadAllOpinions(),this.toastService.showSuccess("Avis rejet\xE9 avec succ\xE8s")},error:t=>{console.error("Erreur lors du rejet:",t),this.toastService.showError("Erreur lors du rejet")}})}deleteOpinion(e){confirm("\xCAtes-vous s\xFBr de vouloir supprimer cet avis ?")&&this.userOpinionsService.deleteUserOpinions(e).subscribe({next:()=>{this.loadAllOpinions(),this.toastService.showSuccess("Avis supprim\xE9 avec succ\xE8s")},error:t=>{console.error("Erreur lors de la suppression:",t),this.toastService.showError("Erreur lors de la suppression")}})}createRatingSignal(e){return m(e)}static \u0275fac=function(t){return new(t||i)(g(N),g(I),g(A),g(V))};static \u0275cmp=S({type:i,selectors:[["app-user-opinion-management"]],decls:16,vars:1,consts:[[1,"w-full","bg-gradient-to-b","from-secondary","to-primary","shadow-lg","py-8"],[1,"container","mx-auto","px-4"],[1,"text-center","space-y-4","mb-12"],[1,"text-3xl","md:text-5xl","lg:text-6xl","font-serif","font-bold","text-quinary"],[1,"text-lg","md:text-xl","text-tertiary","font-serif","italic","max-w-4xl","mx-auto"],[1,"flex","justify-center","mb-8"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-4","flex","gap-4"],[1,"relative"],[1,"space-y-4"],[1,"flex","justify-center","items-center","h-48"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-8","text-center"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[3,"click","keydown.enter","text","type","color","rounded","customClass"],[1,"animate-spin","rounded-full","h-12","w-12","border-4","border-tertiary","border-t-transparent"],[1,"text-gray-600","font-medium","text-lg"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-6","transition-all","duration-300","hover:shadow-xl","hover:-translate-y-1"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","gap-4"],[1,"w-12","h-12","bg-gradient-to-br","from-secondary","to-tertiary","rounded-full","flex","items-center","justify-center","shadow-md"],[1,"text-white","text-xl","font-semibold"],[1,"font-semibold","text-lg","text-tertiary"],[1,"text-sm","text-gray-500"],[3,"rating","isReadOnly"],[1,"text-gray-700","mb-6","italic"],[1,"flex","justify-end","gap-3","pt-4","border-t","border-gray-200"],[3,"text","type","color","rounded","customClass"]],template:function(t,r){t&1&&(o(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),u(4," Gestion des Avis Visiteurs "),n(),o(5,"p",4),u(6," G\xE9rez les avis et commentaires des visiteurs "),n(),C(7,"app-toast"),n(),o(8,"div",5)(9,"div",6),O(10,B,4,9,"div",7,z),n()(),o(12,"div",8),y(13,P,2,0,"div",9)(14,G,3,0,"div",10)(15,K,3,0,"div",11),n()()()),t&2&&(d(10),w(r.filters),d(3),h(r.isLoading()?13:r.opinions().length===0?14:15))},dependencies:[T,D,$,R,k],encapsulation:2})};export{L as a};
