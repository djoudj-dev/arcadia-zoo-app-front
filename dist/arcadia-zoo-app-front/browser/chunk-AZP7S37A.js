import{E as f,V as i,_ as p,a as u,b as h,kc as k,lc as v,o as g,oc as a,s as m}from"./chunk-OS3QXM5S.js";var n=class extends Error{};n.prototype.name="InvalidTokenError";function y(o){return decodeURIComponent(atob(o).replace(/(.)/g,(e,r)=>{let t=r.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function T(o){let e=o.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return y(e)}catch{return atob(e)}}function l(o,e){if(typeof o!="string")throw new n("Invalid token specified: must be a string");e||(e={});let r=e.header===!0?0:1,t=o.split(".")[r];if(typeof t!="string")throw new n(`Invalid token specified: missing part #${r+1}`);let d;try{d=T(t)}catch(c){throw new n(`Invalid token specified: invalid base64 for part #${r+1} (${c.message})`)}try{return JSON.parse(d)}catch(c){throw new n(`Invalid token specified: invalid json for part #${r+1} (${c.message})`)}}var s=class o{TOKEN_KEY="access_token";getToken(){try{return localStorage.getItem(this.TOKEN_KEY)}catch(e){return console.error("Erreur lors de la r\xE9cup\xE9ration du token:",e),null}}getDecodedToken(e){try{return l(e)}catch(r){return console.error("Erreur de d\xE9codage du token:",r),null}}setToken(e){try{localStorage.setItem(this.TOKEN_KEY,e),console.log("Token stock\xE9 avec succ\xE8s")}catch(r){console.error("Erreur lors du stockage du token:",r)}}removeToken(){try{localStorage.removeItem(this.TOKEN_KEY),console.log("Token supprim\xE9 avec succ\xE8s")}catch(e){console.error("Erreur lors de la suppression du token:",e)}}isTokenExpired(){let e=this.getToken();if(!e)return console.warn("Aucun token trouv\xE9, consid\xE9r\xE9 comme expir\xE9."),!0;let r=this.decodeToken(e);if(!r?.exp)return console.warn("Token invalide ou sans date d\u2019expiration."),!0;let t=r.exp*1e3<=Date.now();return t&&console.warn("Token expir\xE9."),t}decodeToken(e){try{return l(e)}catch(r){return console.error("Erreur lors du d\xE9codage du token:",r),null}}refreshToken(){console.log("Pr\xE9parez une logique pour rafra\xEEchir le token.")}getRefreshToken(){let e=localStorage.getItem("refreshToken");if(!e)throw this.redirectToLogin(),new Error("Refresh token non trouv\xE9");return e}redirectToLogin(){localStorage.clear(),window.location.href="/login"}static \u0275fac=function(r){return new(r||o)};static \u0275prov=i({token:o,factory:o.\u0275fac,providedIn:"root"})};var b=class o{constructor(e,r){this.http=e;this.tokenService=r}apiUrl=`${a.apiUrl}/api/veterinary-reports`;animalApiUrl=`${a.apiUrl}/api/animals`;getHeaders(){let e=this.tokenService.getToken();return new k({"Content-Type":"application/json",Authorization:`Bearer ${e}`})}getAllReports(){let e=this.getHeaders();return this.http.get(this.apiUrl,{headers:e}).pipe(f(r=>(console.error("Erreur lors de la r\xE9cup\xE9ration des rapports:",r),g(()=>r))))}getReportById(e){let r=this.getHeaders();return this.http.get(`${this.apiUrl}/${e}`,{headers:r})}createReport(e){let r=this.getHeaders();return this.http.post(this.apiUrl,e,{headers:r})}updateReport(e,r){let t=this.getHeaders();return this.http.put(`${this.apiUrl}/${e}`,r,{headers:t})}deleteReport(e){return this.http.delete(`${this.apiUrl}/${e}`)}fetchAnimalDetails(e){let r=this.getHeaders();return this.http.get(`${this.animalApiUrl}/${e}`,{headers:r}).pipe(m(t=>h(u({},t),{images:t.images?`${a.apiUrl}/api/${t.images}`:""})))}updateReportStatus(e,r){let t=this.getHeaders();return this.http.patch(`${this.apiUrl}/${e}/status`,{is_treated:r},{headers:t})}static \u0275fac=function(r){return new(r||o)(p(v),p(s))};static \u0275prov=i({token:o,factory:o.\u0275fac,providedIn:"root"})};export{s as a,b};
