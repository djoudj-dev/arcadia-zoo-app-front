import{a as ie}from"./chunk-FOF6UJEQ.js";import{a as te,b as re}from"./chunk-5WQUE5VX.js";import{a as B}from"./chunk-TTATSR4U.js";import{e as L}from"./chunk-PRIUQE34.js";import{a as ee}from"./chunk-G3OXHIUX.js";import{c as P,e as G,f as J,h as K,j as Q,k as X,s as Y,u as Z}from"./chunk-OLGVRGRS.js";import{Bb as w,Db as v,Fa as q,Fb as d,G as g,Ka as c,Pa as f,Qb as l,Rb as R,Sb as V,Tb as W,Tc as H,V as _,Vb as F,Wa as z,Wb as E,Wc as M,Xb as D,Y as N,a as h,aa as $,b as S,d as b,ha as m,ia as u,lb as y,mb as C,pb as I,q as j,qa as x,qb as T,rb as p,sb as a,t as O,tb as o,ub as A}from"./chunk-JLM7LPRF.js";var k=class s{constructor(t){this.http=t}apiUrl=`${M.apiUrl}/api/admin/service-management`;getAllServices(){return this.http.get(this.apiUrl).pipe(g(this.handleError("r\xE9cup\xE9ration des services")))}getAllFeatures(){return this.http.get(`${this.apiUrl}/features`).pipe(g(this.handleError("r\xE9cup\xE9ration des caract\xE9ristiques")))}createService(t){return console.log("Donn\xE9es envoy\xE9es au serveur:",t),this.http.post(`${this.apiUrl}`,t).pipe(_(()=>console.log("Service cr\xE9\xE9 avec succ\xE8s")),g(e=>(console.log("Erreur d\xE9taill\xE9e:",e.error),this.handleError("cr\xE9ation du service")(e))))}createFeature(t){return this.http.post(`${this.apiUrl}/features`,t).pipe(_(e=>console.log("Caract\xE9ristique cr\xE9\xE9e avec succ\xE8s:",e)),g(this.handleError("cr\xE9ation de la caract\xE9ristique")))}updateService(t,e){return this.http.put(`${this.apiUrl}/${t}`,e).pipe(_(r=>console.log("Service mis \xE0 jour avec succ\xE8s:",r)),g(this.handleError("mise \xE0 jour du service")))}deleteService(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(_(()=>console.log("Service supprim\xE9 avec succ\xE8s")),g(this.handleError("suppression du service")))}clearCache(){console.log("Cache des services effac\xE9")}handleError(t){return e=>(console.error(`Erreur lors de la ${t}:`,e),j(()=>new Error(`Erreur lors de la ${t}`)))}static \u0275fac=function(e){return new(e||s)($(H))};static \u0275prov=N({token:s,factory:s.\u0275fac,providedIn:"root"})};var se=(s,t)=>t.id_service,ce=(s,t)=>t.id_feature;function le(s,t){if(s&1){let e=w();a(0,"div",6)(1,"div",23),A(2,"img",24),a(3,"div",25)(4,"h3",26),l(5),o()()(),a(6,"div",27)(7,"p",28),l(8),o(),a(9,"div",29)(10,"app-button",30),v("click",function(){let i=m(e).$implicit,n=d();return u(n.editService(i.id_service))})("keydown",function(){let i=m(e).$implicit,n=d();return u(n.editService(i.id_service))}),o(),a(11,"app-button",30),v("click",function(){let i=m(e).$implicit,n=d();return u(n.confirmDeleteService(i.id_service))})("keydown",function(){let i=m(e).$implicit,n=d();return u(n.confirmDeleteService(i.id_service))}),o()()()()}if(s&2){let e=t.$implicit;c(2),p("src",e.images,q)("alt",e.name),c(3),R(e.name),c(3),V(" ",e.description," "),c(2),p("text","Modifier")("color","tertiary")("rounded",!0)("customClass","px-6 min-w-[120px] text-lg font-medium"),c(),p("text","Supprimer")("color","danger")("rounded",!0)("customClass","px-6 min-w-[120px] text-lg font-medium")}}function de(s,t){if(s&1){let e=w();a(0,"div",34)(1,"input",35),D("ngModelChange",function(i){m(e);let n=d().$implicit;return E(n.value,i)||(n.value=i),u(i)}),o()()}if(s&2){let e=d().$implicit;c(),F("ngModel",e.value),p("name","feature-value-"+e.id_feature)}}function me(s,t){if(s&1){let e=w();a(0,"div",18)(1,"div",31)(2,"input",32),v("change",function(i){let n=m(e).$implicit,U=d();return u(U.onFeatureChange(n,i))}),o(),a(3,"label",33),l(4),o()(),y(5,de,2,2,"div",34),o()}if(s&2){let e=t.$implicit,r=d();c(2),p("id","feature-"+e.id_feature)("checked",r.isFeatureSelected(e)),c(),p("for","feature-"+e.id_feature),c(),W(" ",e.name," (",e.type,") "),c(),C(r.isFeatureSelected(e)?5:-1)}}function ue(s,t){s&1&&(a(0,"p",19),l(1,"Aucune caract\xE9ristique disponible"),o())}function pe(s,t){if(s&1){let e=w();a(0,"app-button",36),v("click",function(){m(e);let i=d();return u(i.cancelEdit())})("keydown",function(){m(e);let i=d();return u(i.cancelEdit())}),o()}s&2&&p("text","Annuler")("color","secondary")("rounded",!0)("customClass","px-6 min-w-[120px] text-lg font-medium")}var ne=class s{constructor(t,e,r,i,n,U){this.router=t;this.serviceManagement=e;this.toastService=r;this.imageOptimizer=i;this.fileSecurityService=n;this.imageUrlService=U}services=x([]);allFeatures=x([]);selectedFile=x(null);serviceToDelete=null;newServiceData={};imageBaseUrl=`${M.apiUrl}/api`;showModal=!1;isFeatureDropdownOpen=!1;ngOnInit(){this.loadServices(),this.loadFeatures()}loadServices(){this.serviceManagement.getAllServices().subscribe({next:t=>{this.services.set(t.map(e=>S(h({},e),{showFullDescription:!1,images:this.formatImageUrl("services",e.images)})))},error:t=>{console.error("Erreur lors de la r\xE9cup\xE9ration des services:",t),this.toastService.showError("Erreur lors du chargement des services")}})}formatImageUrl(t,e){return this.imageUrlService.getImageUrl(e)}getImageUrl(t){return this.imageUrlService.getImageUrl(t)}loadFeatures(){this.serviceManagement.getAllFeatures().subscribe({next:t=>{this.allFeatures.set(t)},error:t=>{console.error("Erreur lors de la r\xE9cup\xE9ration des caract\xE9ristiques:",t),this.toastService.showError("Erreur lors du chargement des caract\xE9ristiques")}})}onFileSelected(t){return b(this,null,function*(){try{let e=yield this.fileSecurityService.scan(t);if(!e.isSafe){this.toastService.showError(e.threats.join(`
`));return}this.selectedFile.set(t);let r=new FileReader;r.onload=()=>{this.newServiceData.images=r.result,this.toastService.showSuccess("Image s\xE9lectionn\xE9e avec succ\xE8s")},r.readAsDataURL(t)}catch(e){console.error("Erreur lors du traitement du fichier:",e),this.toastService.showError("Erreur lors du traitement du fichier")}})}onFileChange(t){return b(this,null,function*(){let e=t.target.files?.[0];if(e)try{let r=yield this.fileSecurityService.scan(e);if(!r.isSafe){this.toastService.showError(r.threats.join(`
`));return}this.selectedFile.set(e);let i=new FileReader;i.onload=()=>{this.newServiceData.images=i.result},i.readAsDataURL(e),this.toastService.showSuccess("Image s\xE9lectionn\xE9e avec succ\xE8s")}catch(r){console.error("Erreur lors du traitement du fichier:",r),this.toastService.showError("Erreur lors du traitement du fichier")}})}createService(){return b(this,null,function*(){try{let t=this.buildFormData();yield O(this.serviceManagement.createService(t)),this.toastService.showSuccess("Service cr\xE9\xE9 avec succ\xE8s !"),this.toggleModal(),this.resetForm(),this.loadServices()}catch{this.toastService.showError("Erreur lors de la cr\xE9ation du service")}})}updateService(){if(!this.validateServiceData(!0)){this.toastService.showError("Veuillez remplir tous les champs requis");return}let t=this.buildFormData();this.serviceManagement.updateService(this.newServiceData.id_service,t).subscribe({next:()=>{this.loadServices(),this.resetForm(),this.toastService.showSuccess("Service mis \xE0 jour avec succ\xE8s")},error:e=>{console.error("Erreur lors de la mise \xE0 jour du service:",e),this.toastService.showError("Erreur lors de la mise \xE0 jour du service")}})}editService(t){let e=this.services().find(r=>r.id_service===t);e&&(this.newServiceData=S(h({},e),{features:e.features||[]}),this.showModal=!0,this.toastService.showSuccess("Service s\xE9lectionn\xE9 pour modification"))}deleteService(t){if(!t){this.toastService.showError("ID de service invalide");return}this.serviceManagement.deleteService(t).subscribe({next:()=>{this.services.update(e=>e.filter(r=>r.id_service!==t)),this.toastService.showSuccess("Service supprim\xE9 avec succ\xE8s")},error:e=>{console.error("Erreur lors de la suppression du service:",e),this.toastService.showError("Erreur lors de la suppression du service")}})}resetForm(){this.newServiceData={name:"",description:"",features:[],images:""},this.selectedFile.set(null)}toggleDescription(t){this.services.update(e=>e.map(r=>r.id_service===t?S(h({},r),{showFullDescription:!r.showFullDescription}):r))}isFeatureSelected(t){return!!this.newServiceData.features?.some(e=>e.id_feature===t.id_feature)}onFeatureChange(t,e){if(e.target.checked){let i=S(h({},t),{value:t.value||""});this.newServiceData.features=[...this.newServiceData.features||[],i]}else this.newServiceData.features=this.newServiceData.features?.filter(i=>i.id_feature!==t.id_feature)}goBack(){this.router.navigate(["/admin"])}openNewServiceModal(){this.resetForm(),this.showModal=!0}toggleModal(){this.showModal=!this.showModal,this.showModal||this.resetForm()}toggleFeatureDropdown(){this.isFeatureDropdownOpen=!this.isFeatureDropdownOpen}validateServiceData(t=!1){let{name:e,description:r,features:i}=this.newServiceData,n=this.selectedFile()||t||this.newServiceData.images;return!!(e&&r&&i&&n)}buildFormData(){let t=new FormData,e=this.newServiceData;Object.entries(e).forEach(([i,n])=>{n!=null&&(i==="features"?t.append(i,JSON.stringify(n)):t.append(i,n.toString()))});let r=this.selectedFile();if(r){let i=this.imageOptimizer.sanitizeFileName(r.name);t.append("image",r,i)}return t}confirmDeleteService(t){this.serviceToDelete=t}cancelDelete(){this.serviceToDelete=null}deleteServiceConfirmed(){this.serviceToDelete!==null&&(this.deleteService(this.serviceToDelete),this.serviceToDelete=null)}cancelEdit(){this.resetForm(),this.toastService.showSuccess("Modification annul\xE9e")}static \u0275fac=function(e){return new(e||s)(f(L),f(k),f(B),f(ie),f(te),f(re))};static \u0275cmp=z({type:s,selectors:[["app-service-management"]],decls:36,vars:9,consts:[[1,"w-full","bg-gradient-to-b","from-secondary","to-primary","shadow-lg","py-8"],[1,"container","mx-auto","px-4"],[1,"text-center","space-y-4","mb-12"],[1,"text-3xl","md:text-5xl","lg:text-6xl","font-serif","font-bold","text-quinary"],[1,"text-lg","md:text-xl","text-tertiary","font-serif","italic","max-w-4xl","mx-auto"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6","mb-12"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","overflow-hidden"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-6"],[1,"text-2xl","font-serif","font-semibold","text-tertiary","mb-6"],["enctype","multipart/form-data",1,"space-y-6",3,"ngSubmit"],["for","name",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["type","text","id","name","name","name","required","","placeholder","Nom du service",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent",3,"ngModelChange","ngModel"],["for","description",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["id","description","name","description","required","","rows","4","placeholder","Description du service",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent",3,"ngModelChange","ngModel"],["for","image",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["type","file","id","image","accept","image/*",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent",3,"change"],[1,"block","text-lg","font-medium","text-tertiary","mb-2"],[1,"space-y-3","max-h-60","overflow-y-auto","p-2","border","border-secondary/30","rounded-lg"],[1,"flex","flex-col","space-y-2","p-2","border-b","border-secondary/20"],[1,"text-gray-500","italic","text-center","py-2"],[1,"flex","justify-end","space-x-4"],["type","button",3,"text","color","rounded","customClass"],["type","submit",3,"keydown","text","color","rounded","customClass"],[1,"relative","h-48"],[1,"w-full","h-full","object-cover",3,"src","alt"],[1,"absolute","bottom-0","left-0","right-0","bg-black/50","p-4"],[1,"text-white","font-serif","text-xl"],[1,"p-4"],[1,"text-gray-600","mb-4","line-clamp-3"],[1,"flex","justify-end","space-x-2"],[3,"click","keydown","text","color","rounded","customClass"],[1,"flex","items-center"],["type","checkbox",1,"mr-2","h-5","w-5","text-tertiary","focus:ring-tertiary",3,"change","id","checked"],[1,"text-tertiary","font-medium",3,"for"],[1,"ml-7"],["type","text","placeholder","Valeur (ex: oui, gratuit, etc.)",1,"w-full","p-2","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent",3,"ngModelChange","ngModel","name"],["type","button",3,"click","keydown","text","color","rounded","customClass"]],template:function(e,r){e&1&&(a(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),l(4," Gestion des Services "),o(),a(5,"p",4),l(6," G\xE9rez les services du zoo "),o()(),a(7,"div",5),I(8,le,12,12,"div",6,se),o(),a(10,"div",7)(11,"h3",8),l(12),o(),a(13,"form",9),v("ngSubmit",function(){return r.newServiceData.id_service?r.updateService():r.createService()}),a(14,"div")(15,"label",10),l(16," Nom du service "),o(),a(17,"input",11),D("ngModelChange",function(n){return E(r.newServiceData.name,n)||(r.newServiceData.name=n),n}),o()(),a(18,"div")(19,"label",12),l(20," Description "),o(),a(21,"textarea",13),D("ngModelChange",function(n){return E(r.newServiceData.description,n)||(r.newServiceData.description=n),n}),o()(),a(22,"div")(23,"label",14),l(24," Image "),o(),a(25,"input",15),v("change",function(n){return r.onFileChange(n)}),o()(),a(26,"div")(27,"label",16),l(28," Caract\xE9ristiques "),o(),a(29,"div",17),I(30,me,6,6,"div",18,ce),y(32,ue,2,0,"p",19),o()(),a(33,"div",20),y(34,pe,1,4,"app-button",21),a(35,"app-button",22),v("keydown",function(n){return n.key==="Enter"&&(r.newServiceData.id_service?r.updateService():r.createService())}),o()()()()()()),e&2&&(c(8),T(r.services()),c(4),V(" ",r.newServiceData.id_service?"Modifier le service":"Ajouter un service"," "),c(5),F("ngModel",r.newServiceData.name),c(4),F("ngModel",r.newServiceData.description),c(9),T(r.allFeatures()),c(2),C(r.allFeatures().length===0?32:-1),c(2),C(r.newServiceData.id_service?34:-1),c(),p("text",r.newServiceData.id_service?"Mettre \xE0 jour":"Cr\xE9er")("color","tertiary")("rounded",!0)("customClass","px-6 min-w-[120px] text-lg font-medium"))},dependencies:[Z,X,P,G,J,Y,Q,K,ee],encapsulation:2})};export{ne as a};
