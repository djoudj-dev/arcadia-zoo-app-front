import{a as N}from"./chunk-TTATSR4U.js";import{a as P}from"./chunk-OLGVRGRS.js";import{Bb as $,Eb as j,Fb as h,G as i,Ka as c,Ob as u,Qb as x,Tc as I,V as n,Wa as w,Wc as M,X as U,Y as b,Zb as T,a as g,aa as l,b as O,bb as S,ha as C,ia as y,j as f,ob as E,pb as _,q as d,qa as o,qb as R,u as a,vb as p,wb as m}from"./chunk-JLM7LPRF.js";function F(r,e){if(r&1){let t=$();p(0,"span",2),j("click",function(){let D=C(t).$implicit,v=h();return y(!v.isReadOnly()&&v.changeRate(D))}),p(1,"i",3),x(2,"\u2605"),m()()}if(r&2){let t=e.$implicit,s=h();u("read-only",s.isReadOnly()),c(),u("filled",t<=s.rating())}}var V=class r{rating=o(0);stars=o([1,2,3,4,5]);isReadOnly=o(!1);ratingChange=new S;onChange=()=>{};onTouched=()=>{};writeValue(e){e!==void 0&&this.rating.set(e)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}changeRate(e){this.isReadOnly()||(this.rating.set(e),this.onChange(this.rating()),this.ratingChange.emit(this.rating()),this.onTouched())}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=w({type:r,selectors:[["app-rate"]],inputs:{rating:"rating",stars:"stars",isReadOnly:"isReadOnly"},outputs:{ratingChange:"ratingChange"},features:[T([{provide:P,useExisting:U(()=>r),multi:!0}])],decls:3,vars:0,consts:[[1,"star-rating"],[3,"read-only"],[3,"click"],[1,"star"]],template:function(t,s){t&1&&(p(0,"div",0),_(1,F,3,4,"span",1,E),m()),t&2&&(c(),R(s.stars()))},styles:[".star[_ngcontent-%COMP%]{color:gray;cursor:pointer;font-size:1.5rem}.filled[_ngcontent-%COMP%]{color:gold}.read-only[_ngcontent-%COMP%]{cursor:default}"]})};var A=class r{constructor(e,t){this.http=e;this.toastService=t}apiUrl=`${M.apiUrl}/api/user-opinions`;opinionsUpdatedSource=new f;opinionsUpdated$=this.opinionsUpdatedSource.asObservable();transformOpinion(e){return O(g({},e),{id_opinion:Number(e._id)||0,name:e.name??"",message:e.message??e.content??"",date:e.date??e.createdAt??new Date,rating:e.rating?Number(e.rating):0,validated:!!e.validated,rejected:!!e.rejected})}getUserOpinions(){return this.http.get(`${this.apiUrl}/validated`,{params:{validated:"true",rejected:"false"}}).pipe(a(e=>e.map(this.transformOpinion)),i(e=>{throw this.toastService.showError("Impossible de charger les avis utilisateurs"),e}))}addUserOpinions(e){return this.http.post(this.apiUrl,e).pipe(n(()=>{this.toastService.showSuccess("Votre avis a \xE9t\xE9 ajout\xE9 avec succ\xE8s")}),i(t=>{throw this.toastService.showError("Une erreur est survenue lors de l'envoi de votre avis"),t}))}validateUserOpinions(e){return this.http.patch(`${this.apiUrl}/validate/${e}`,{}).pipe(n(()=>{this.toastService.showSuccess("Avis valid\xE9 avec succ\xE8s"),this.notifyOpinionsUpdated()}),i(t=>(this.toastService.showError("Une erreur est survenue lors de la validation de l'avis"),d(()=>t))))}getAllUserOpinions(){return this.http.get(`${this.apiUrl}/all`,{params:{sort:"date,desc"}}).pipe(a(e=>e.map(this.transformOpinion)),i(e=>{throw this.toastService.showError("Impossible de charger les avis"),e}))}getPendingOpinions(){return this.http.get(`${this.apiUrl}/pending`).pipe(a(e=>e.map(this.transformOpinion)),n(()=>{}),i(e=>{throw this.toastService.showError("Impossible de charger les avis en attente"),e}))}rejectUserOpinions(e){return this.http.patch(`${this.apiUrl}/reject/${e}`,{}).pipe(n(()=>{this.notifyOpinionsUpdated()}),i(t=>(this.toastService.showError("Une erreur est survenue lors du rejet de l'avis"),d(()=>t))))}deleteUserOpinions(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(n(()=>{this.notifyOpinionsUpdated()}))}notifyOpinionsUpdated(){this.opinionsUpdatedSource.next()}static \u0275fac=function(t){return new(t||r)(l(I),l(N))};static \u0275prov=b({token:r,factory:r.\u0275fac,providedIn:"root"})};export{V as a,A as b};
