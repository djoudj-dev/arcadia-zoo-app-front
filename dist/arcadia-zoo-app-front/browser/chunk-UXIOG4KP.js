import{a as at}from"./chunk-TVVECW45.js";import{a as nt}from"./chunk-GWO2KCD4.js";import{a as G,c as J,d as K,e as Q,f as X,g as Y,m as Z,o as tt,p as et}from"./chunk-2QYQOEU4.js";import{d as z}from"./chunk-ZZFP4HC6.js";import{k as A,p as q,s as v,t as it}from"./chunk-H7WWMUX6.js";import{$ as U,$a as p,C as g,Da as l,Ea as w,Ia as M,Na as D,Pa as d,Q as _,Ra as E,T as j,Ta as B,Ua as O,Va as a,Wa as r,Xa as F,Y as y,Ya as W,a as u,ab as c,b as f,cb as m,db as I,eb as T,gb as k,hb as V,ia as x,ib as $,ja as H,kb as L,o as h,ob as P,rb as R,za as N}from"./chunk-FRW6CNJS.js";var C=class n{constructor(e,t){this.http=e;this.habitatService=t}apiUrl=`${v.apiUrl}/admin/habitat-management`;getAllHabitats(){return this.http.get(this.apiUrl).pipe(g(e=>(console.error("Erreur lors de la r\xE9cup\xE9ration des habitats :",e),h(()=>new Error("Erreur lors de la r\xE9cup\xE9ration des habitats")))))}createHabitat(e){return this.http.post(this.apiUrl,e).pipe(_(()=>this.habitatService.clearCache()),g(t=>(console.error("Erreur lors de la cr\xE9ation de l'habitat :",t),h(()=>new Error("Erreur lors de la cr\xE9ation de l'habitat")))))}updateHabitat(e,t){return this.http.put(`${this.apiUrl}/${e}`,t).pipe(_(()=>this.habitatService.clearCache()),g(i=>(console.error("Erreur lors de la mise \xE0 jour de l'habitat :",i),h(()=>new Error("Erreur lors de la mise \xE0 jour de l'habitat")))))}deleteHabitat(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(_(()=>this.habitatService.clearCache()),g(t=>(console.error("Erreur lors de la suppression de l'habitat :",t),h(()=>new Error("Erreur lors de la suppression de l'habitat")))))}static \u0275fac=function(t){return new(t||n)(y(q),y(at))};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var mt=(n,e)=>e.id_habitat;function pt(n,e){if(n&1&&(a(0,"span"),m(1),P(2,"slice"),r()),n&2){let t=c().$implicit;l(),T("",R(2,1,t.description,0,30),"...")}}function dt(n,e){if(n&1&&(a(0,"span"),m(1),r()),n&2){let t=c().$implicit;l(),I(t.description)}}function ct(n,e){n&1&&m(0," Lire la suite ")}function bt(n,e){n&1&&m(0," Voir moins ")}function ut(n,e){if(n&1){let t=W();a(0,"div",18),F(1,"img",19),a(2,"div",20)(3,"h4",21),m(4),r(),a(5,"p",22)(6,"span",23),m(7,"Description:"),r(),D(8,pt,3,5,"span")(9,dt,2,1,"span"),a(10,"button",24),p("click",function(){let s=x(t).$implicit,o=c();return H(o.toggleDescription(s.id_habitat))}),D(11,ct,1,0)(12,bt,1,0),r()()(),a(13,"div",25)(14,"app-button",26),p("click",function(){let s=x(t).$implicit,o=c();return H(o.editHabitat(s.id_habitat))}),r(),a(15,"app-button",26),p("click",function(){let s=x(t).$implicit,o=c();return H(o.deleteHabitat(s.id_habitat))}),r()()()}if(n&2){let t=e.$implicit;l(),d("src",t.images,N),l(3),I(t.name),l(4),E(t.showDescription?9:8),l(3),E(t.showDescription?12:11),l(3),d("text","Modifier")("type","button")("color","tertiary")("rounded",!0)("customClass","text-xs px-2 py-1 font-bold"),l(),d("text","Supprimer")("type","button")("color","red")("rounded",!0)("customClass","text-xs px-2 py-1 font-bold")}}var rt=class n{constructor(e,t,i){this.router=e;this.habitatManagement=t;this.statsService=i}habitats=M([]);selectedFile=M(null);newHabitatData={};imageBaseUrl=`${v.apiUrl}`;ngOnInit(){this.loadHabitats()}loadHabitats(){this.habitatManagement.getAllHabitats().subscribe({next:e=>{this.habitats.set(e.map(t=>f(u({},t),{showDescription:!1,images:`${this.imageBaseUrl}/${t.images}`})))},error:e=>console.error("Erreur lors de la r\xE9cup\xE9ration des habitats:",e)})}onFileChange(e){let t=e.target;t.files&&t.files.length>0&&(this.selectedFile.set(t.files[0]),console.log("Fichier s\xE9lectionn\xE9 :",t.files[0]))}createHabitat(){if(this.newHabitatData.name&&this.newHabitatData.description&&this.selectedFile()){let e=new FormData;e.append("name",this.newHabitatData.name),e.append("description",this.newHabitatData.description);let t=this.selectedFile();t&&e.append("images",t),console.log("Fichier s\xE9lectionn\xE9 :",t),this.habitatManagement.createHabitat(e).subscribe({next:i=>{console.log("Habitat cr\xE9\xE9 avec succ\xE8s:",i),this.resetForm(),this.loadHabitats(),this.statsService.incrementTotalHabitats()},error:i=>{console.error("Erreur lors de la cr\xE9ation de l'habitat :",i)}})}else console.error("Veuillez remplir tous les champs")}updateHabitat(){let{id_habitat:e,name:t,description:i}=this.newHabitatData;if(e&&t&&i){let s=new FormData;s.append("name",t),s.append("description",i);let o=this.selectedFile();o&&s.append("images",o),this.habitatManagement.updateHabitat(e.toString(),s).subscribe({next:b=>{this.habitats.update(ot=>ot.map(S=>S.id_habitat===b.id_habitat?f(u({},b),{showDescription:S.showDescription,images:`${this.imageBaseUrl}/${b.images}`}):S)),this.resetForm()},error:b=>console.error("Erreur lors de la mise \xE0 jour de l'habitat :",b)})}else console.error("Veuillez remplir tous les champs")}editHabitat(e){let t=this.habitats().find(i=>i.id_habitat===e);t&&(this.newHabitatData=u({},t))}deleteHabitat(e){if(e==null){console.error("ID invalide pour la suppression :",e);return}this.habitatManagement.deleteHabitat(e.toString()).subscribe({next:()=>{console.log("Habitat supprim\xE9"),this.habitats.update(t=>t.filter(i=>i.id_habitat!==e)),this.statsService.decrementTotalHabitats()},error:t=>console.error("Erreur lors de la suppression de l'habitat:",t)})}cancel(){this.resetForm()}resetForm(){this.newHabitatData={},this.selectedFile.set(null)}toggleDescription(e){this.habitats.update(t=>t.map(i=>i.id_habitat===e?f(u({},i),{showDescription:!i.showDescription}):i))}goBack(){this.router.navigate(["/admin"])}static \u0275fac=function(t){return new(t||n)(w(z),w(C),w(nt))};static \u0275cmp=U({type:n,selectors:[["app-habitat-management"]],standalone:!0,features:[L],decls:29,vars:11,consts:[[1,"habitats-management","mb-12","p-6","bg-secondary","rounded-lg","shadow-xl","shadow-tertiary"],[1,"text-2xl","font-semibold","mb-8","text-center"],[1,"flex","flex-col","lg:flex-row","gap-8"],[1,"w-full","lg:w-1/2","bg-gray-100","p-6","rounded-lg","shadow-sm"],[1,"text-xl","font-semibold","mb-4"],["enctype","multipart/form-data",1,"space-y-3","sm:space-y-4",3,"ngSubmit"],["for","habitat-name",1,"block","text-base","sm:text-lg","font-medium","mb-1","sm:mb-2"],["type","text","id","name","name","name","required","","placeholder","Nom de l'habitat",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"ngModelChange","ngModel"],["for","description",1,"block","text-base","sm:text-lg","font-medium","mb-1","sm:mb-2"],["id","description","name","description","required","","placeholder","Description de l'habitat",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"ngModelChange","ngModel"],["for","habitat-image",1,"block","text-base","sm:text-lg","font-medium","mb-1","sm:mb-2"],["type","file","id","images","name","images",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"change"],[1,"flex","space-x-2"],[1,"w-full","sm:w-1/2","lg:w-1/4","font-bold","px-4",3,"text","type","color","rounded"],[1,"w-full","sm:w-1/2","lg:w-1/4","font-bold","px-4",3,"click","text","type","color","rounded"],[1,"w-full","lg:w-1/2","bg-gray-100","p-4","sm:p-6","rounded-lg","shadow-sm"],[1,"text-lg","sm:text-xl","font-semibold","mb-3","sm:mb-4"],[1,"space-y-4","sm:space-y-6"],[1,"p-4","bg-white","rounded-lg","shadow-md","flex","flex-col","sm:flex-row","items-center"],["alt","Image de l'habitat",1,"w-24","h-24","sm:w-32","sm:h-32","object-cover","rounded-lg","shadow-md","mb-4","sm:mb-0","sm:mr-4",3,"src"],[1,"flex-1"],[1,"text-lg","font-semibold"],[1,"text-sm","sm:text-base"],[1,"font-semibold"],[1,"text-blue-500","hover:underline","mt-2",3,"click"],[1,"flex","space-x-2","mt-4","sm:mt-0","sm:ml-4"],[3,"click","text","type","color","rounded","customClass"]],template:function(t,i){t&1&&(a(0,"section",0)(1,"h2",1),m(2,"Gestion des habitats"),r(),a(3,"div",2)(4,"div",3)(5,"h3",4),m(6),r(),a(7,"form",5),p("ngSubmit",function(){return i.newHabitatData.id_habitat?i.updateHabitat():i.createHabitat()}),a(8,"div")(9,"label",6),m(10,"Nom de l'habitat:"),r(),a(11,"input",7),$("ngModelChange",function(o){return V(i.newHabitatData.name,o)||(i.newHabitatData.name=o),o}),r()(),a(12,"div")(13,"label",8),m(14,"Description:"),r(),a(15,"textarea",9),$("ngModelChange",function(o){return V(i.newHabitatData.description,o)||(i.newHabitatData.description=o),o}),r()(),a(16,"div")(17,"label",10),m(18,"Images:"),r(),a(19,"input",11),p("change",function(o){return i.onFileChange(o)}),r()(),a(20,"div",12),F(21,"app-button",13),a(22,"app-button",14),p("click",function(){return i.cancel()}),r()()()(),a(23,"div",15)(24,"h3",16),m(25," Liste des habitats "),r(),a(26,"div",17),B(27,ut,16,14,"div",18,mt),r()()()()),t&2&&(l(6),T(" ",i.newHabitatData.id_habitat?"Modifier l'habitat":"Cr\xE9er un habitat"," "),l(5),k("ngModel",i.newHabitatData.name),l(4),k("ngModel",i.newHabitatData.description),l(6),d("text",i.newHabitatData.id_habitat?"Modifier":"Cr\xE9er")("type","submit")("color","tertiary")("rounded",!0),l(),d("text","Annuler")("type","button")("color","secondary")("rounded",!0),l(5),O(i.habitats()))},dependencies:[it,et,Y,G,J,K,Z,tt,X,Q,A],encapsulation:2})};export{rt as HabitatManagementComponent};
