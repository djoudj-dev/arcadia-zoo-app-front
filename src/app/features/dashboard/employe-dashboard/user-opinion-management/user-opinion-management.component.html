<section
  class="min-h-screen bg-gradient-to-br from-primary/40 to-secondary/10 p-4 sm:py-12 sm:px-8"
>
  <div class="max-w-5xl mx-auto">
    <!-- En-tête -->
    <header class="text-center mb-8 sm:mb-12">
      <h1
        class="text-3xl sm:text-4xl font-serif text-quinary mb-4 drop-shadow-sm"
      >
        Gestion des avis visiteurs
      </h1>
    </header>

    <!-- Filtres -->
    <div class="flex flex-col items-center justify-center mb-8 sm:mb-10">
      <div
        class="flex flex-wrap justify-center gap-3 sm:inline-flex sm:items-center bg-white/70 backdrop-blur-md rounded-2xl p-3 sm:p-4 shadow-xl sm:gap-4 border border-secondary/20 w-full sm:w-auto"
      >
        @for (filter of filters; track filter.type) {
        <div class="relative flex-1 sm:flex-none">
          <app-button
            [text]="filter.label"
            [type]="'button'"
            [color]="currentFilter() === filter.type ? 'tertiary' : 'secondary'"
            [rounded]="true"
            [customClass]="
              'font-semibold transition-all duration-300 w-full sm:min-w-[120px] hover:shadow-md text-sm sm:text-base'
            "
            (click)="changeFilter(filter.type)"
          ></app-button>
          <span
            class="absolute -top-2 -right-2 {{
              filter.badgeColor
            }} text-white text-xs font-bold px-2 py-1 rounded-full min-w-[20px] text-center shadow-md transform hover:scale-110 transition-transform"
          >
            {{ getCount(filter.type) }}
          </span>
        </div>
        }
      </div>
    </div>

    <!-- Contenu principal -->
    <main class="space-y-4 sm:space-y-6">
      @if (isLoading()) {
      <div class="flex justify-center items-center h-48">
        <div
          class="animate-spin rounded-full h-10 w-10 sm:h-12 sm:w-12 border-4 border-tertiary border-t-transparent"
        ></div>
      </div>
      } @else if (opinions().length === 0) {
      <div
        class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg p-6 sm:p-8 text-center border border-secondary/20"
      >
        <p class="text-gray-600 font-medium text-base sm:text-lg">
          Aucun avis trouvé pour ce filtre.
        </p>
      </div>
      } @else {
      <div class="grid grid-cols-1 gap-4 sm:gap-6 lg:grid-cols-2">
        @for (opinion of opinions(); track $index) {
        <article
          class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg p-6 sm:p-8 transition-all duration-300 border border-secondary/20 hover:shadow-xl hover:transform hover:-translate-y-1 flex flex-col h-full"
        >
          <!-- En-tête de l'avis -->
          <div
            class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6"
          >
            <div class="flex items-center gap-3 sm:gap-4">
              <div
                class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-secondary to-tertiary rounded-full flex items-center justify-center shadow-md"
              >
                <span class="text-white text-lg sm:text-xl font-semibold">
                  {{ opinion.name.charAt(0) }}
                </span>
              </div>
              <div>
                <h3 class="font-semibold text-base sm:text-lg text-quinary">
                  {{ opinion.name }}
                </h3>
                <p class="text-xs sm:text-sm text-gray-500">
                  {{ opinion.date | date : "dd MMMM yyyy" : "fr-FR" }}
                </p>
              </div>
            </div>
            <app-rate
              [rating]="createRatingSignal(opinion.rating)"
              [isReadOnly]="readOnlySignal"
            ></app-rate>
          </div>

          <!-- Corps de l'avis -->
          <p
            class="text-gray-700 mb-6 italic flex-grow leading-relaxed text-sm sm:text-base"
          >
            "{{ opinion.message }}"
          </p>

          <!-- Actions -->
          <div
            class="flex justify-center mt-auto pt-4 sm:pt-6 border-t border-gray-200 gap-3"
          >
            @if (!opinion.validated && !opinion.rejected) {
            <app-button
              [text]="'Valider'"
              [type]="'button'"
              [color]="'success'"
              [rounded]="true"
              class="w-full sm:w-1/3 font-bold hover:shadow-lg transition-shadow text-sm sm:text-base"
              (click)="validateOpinion(opinion)"
              [disabled]="!opinion?._id"
            ></app-button>
            <app-button
              [text]="'Rejeter'"
              [type]="'button'"
              [color]="'danger'"
              [rounded]="true"
              class="w-full sm:w-1/3 font-bold hover:shadow-lg transition-shadow text-sm sm:text-base"
              (click)="rejectOpinion(opinion._id ?? '')"
              [disabled]="!opinion?._id"
            ></app-button>
            } @else {
            <app-button
              [text]="'Supprimer'"
              [type]="'button'"
              [color]="'danger'"
              [rounded]="true"
              class="w-full sm:w-1/3 font-bold hover:shadow-lg transition-shadow text-sm sm:text-base"
              (click)="deleteOpinion(opinion._id ?? '')"
              [disabled]="!opinion?._id"
            ></app-button>
            }
          </div>
        </article>
        }
      </div>
      }
    </main>
  </div>
</section>
