import{a as Ce}from"./chunk-EWDR5VPA.js";import"./chunk-ZKKSB4BP.js";import{a as Se}from"./chunk-PA57LU76.js";import{d as q,e as xe,f as V}from"./chunk-WZJFZ7S2.js";import"./chunk-DRNBQNPL.js";import"./chunk-O66G5F3S.js";import{a as ae}from"./chunk-7LW6J6UB.js";import{a as he}from"./chunk-MWR6PVUV.js";import"./chunk-QMO5IVA6.js";import{a as be}from"./chunk-IMR7M5YK.js";import{a as O}from"./chunk-VV7GXU3B.js";import{e as oe}from"./chunk-OTF63C3I.js";import{a as N}from"./chunk-M6XTAS6A.js";import{c as re,e as de,f as se,h as le,j as me,k as pe,l as ce,o as ue,p as ge,q as fe,r as ye,s as _e,u as ve}from"./chunk-IVPOVWWL.js";import{Dc as ne,Ec as S,Hb as d,I as J,Ib as E,Jb as _,Kb as Z,Ma as $,Mb as D,Nb as M,O as R,Ob as k,Qb as C,Sa as r,Ta as x,V as K,Vb as ee,W as H,Xb as te,_a as m,a as z,b as B,d as L,db as f,ea as w,hb as p,ia as b,j as I,jc as ie,kb as Y,mb as y,o as W,pb as v,qb as h,rb as i,sa as F,sb as o,t as G,ta as T,tb as u,u as U,w as Q,xb as A,yb as c,za as X,zb as g}from"./chunk-RMHEMJYH.js";var Ee=(a,e)=>e.id_feeding;function De(a,e){a&1&&(i(0,"div",6),u(1,"div",10),o())}function Me(a,e){a&1&&(i(0,"div",7),d(1," Aucun historique de repas disponible pour cet animal. "),o())}function ke(a,e){if(a&1&&(i(0,"div",17),d(1),o()),a&2){let t=g().$implicit;r(),_(' "',t.notes,'" ')}}function Ie(a,e){if(a&1&&(i(0,"div",11)(1,"div",12)(2,"div")(3,"div",13),d(4),o(),i(5,"div",14),d(6),o()(),i(7,"div",15)(8,"div",14),d(9),ee(10,"date"),o(),i(11,"div",16),d(12),o()()(),f(13,ke,2,1,"div",17),o()),a&2){let t=e.$implicit;r(4),_(" ",t.food_type," "),r(2),Z(" Quantit\xE9: ",t.quantity," ",t.unit," "),r(3),_(" ",te(10,6,t.feeding_date,"dd/MM/yyyy \xE0 HH:mm")," "),r(3),_(" Par: ",t.user_name," "),r(),y(t.notes?13:-1)}}function He(a,e){if(a&1&&(i(0,"div",8),v(1,Ie,14,9,"div",11,Ee),o()),a&2){let t=g();r(),h(t.sortedHistory())}}var j=class a{animalId;animalName;destroy$=new I;feedingHistory=m([]);isModalOpen=m(!1);isLoading=m(!0);sortedHistory=ie(()=>[...this.feedingHistory()].sort((e,t)=>new Date(t.feeding_date).getTime()-new Date(e.feeding_date).getTime()));animalFeeding=w(V);toastService=w(O);ngOnInit(){this.loadFeedingHistory()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadFeedingHistory(){this.isLoading.set(!0),this.animalFeeding.getFeedingHistory(this.animalId).pipe(H(this.destroy$)).subscribe({next:e=>{let t=e.map(this.mapHistoryResponse);this.feedingHistory.set(t),this.isLoading.set(!1)},error:e=>{console.error("Erreur lors du chargement de l'historique:",e),this.toastService.showError("Erreur lors du chargement de l'historique"),this.isLoading.set(!1)}})}mapHistoryResponse(e){return{_id:e._id,id_feeding:e.id_feeding,animal_id:e.animal_id,feeding_date:e.feeding_date,food_type:e.food_type,quantity:e.quantity,unit:e.unit,notes:e.notes,user_name:e.user_name,status:e.status,created_at:e.created_at,updated_at:e.updated_at}}closeModal(){this.isModalOpen.set(!1)}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=b({type:a,selectors:[["app-feeding-history"]],inputs:{animalId:"animalId",animalName:"animalName"},standalone:!0,features:[C],decls:12,vars:12,consts:[[3,"click","text","type","color","rounded","customClass"],[3,"close","isOpen"],[1,"bg-white","rounded-2xl","shadow-lg","overflow-hidden"],[1,"bg-tertiary","px-6","py-4"],[1,"text-xl","font-serif","font-semibold","text-white"],[1,"p-6","max-h-[70vh]","overflow-y-auto"],[1,"flex","justify-center","items-center","h-48"],[1,"text-center","py-4","text-gray-500"],[1,"space-y-4"],[1,"bg-gray-50","px-6","py-4","flex","justify-end"],[1,"animate-spin","rounded-full","h-12","w-12","border-4","border-tertiary","border-t-transparent"],[1,"bg-gray-50","rounded-lg","p-4","hover:shadow-md","transition-all","duration-300"],[1,"flex","justify-between","items-start"],[1,"text-sm","font-medium","text-tertiary"],[1,"text-sm","text-gray-500"],[1,"text-right"],[1,"text-xs","text-gray-400"],[1,"mt-2","text-sm","text-gray-600","italic"]],template:function(t,n){t&1&&(i(0,"app-button",0),c("click",function(){return n.isModalOpen.set(!0)}),o(),i(1,"app-modal",1),c("close",function(){return n.closeModal()}),i(2,"div",2)(3,"div",3)(4,"h3",4),d(5," Historique des repas "),o()(),i(6,"div",5),f(7,De,2,0,"div",6)(8,Me,2,0,"div",7)(9,He,3,0,"div",8),o(),i(10,"div",9)(11,"app-button",0),c("click",function(){return n.closeModal()}),o()()()()),t&2&&(p("text","Historique")("type","button")("color","secondary")("rounded",!0)("customClass","text-sm px-4 py-2"),r(),p("isOpen",n.isModalOpen()),r(6),y(n.isLoading()?7:n.sortedHistory().length===0?8:9),r(4),p("text","Fermer")("type","button")("color","secondary")("rounded",!0)("customClass","px-6"))},dependencies:[S,ne,N,q],encapsulation:2,changeDetection:0})};var Ae=(a,e)=>e.id_habitat,Oe=(a,e)=>e.id_animal;function qe(a,e){a&1&&(i(0,"div",5),u(1,"div",33),o())}function Ne(a,e){a&1&&(i(0,"div",48),d(1," Animal nourri ! "),o())}function Ve(a,e){if(a&1){let t=A();i(0,"div",41)(1,"div",42)(2,"div",43),u(3,"img",44),i(4,"div")(5,"h4",45),d(6),o(),i(7,"p",46),d(8),o()()(),i(9,"div",47),f(10,Ne,2,0,"div",48),i(11,"app-button",49),c("click",function(){let s=F(t).$implicit,l=g(3);return T(l.openFeedingModal(s.id_animal))})("keydown.enter",function(){let s=F(t).$implicit,l=g(3);return T(l.openFeedingModal(s.id_animal))}),o(),u(12,"app-feeding-history",50),o()()()}if(a&2){let t=e.$implicit,n=g(3);r(3),p("src",t.images,$)("alt",t.name),r(3),E(t.name),r(2),E(t.species),r(2),y(n.activeToasts().has(t.id_animal)?10:-1),r(),p("text","Nourrir")("type","button")("color","tertiary")("rounded",!0)("customClass","text-sm px-4 py-2")("disabled",n.feedingInProgress().has(t.id_animal)),r(),p("animalId",t.id_animal)}}function je(a,e){if(a&1&&(i(0,"div",34)(1,"div",35),u(2,"img",36)(3,"div",37),i(4,"h2",38),d(5),o()(),i(6,"div",39)(7,"h3",40),d(8," Animaux \xE0 nourrir "),o(),v(9,Ve,13,12,"div",41,Oe),o()()),a&2){let t=e.$implicit;r(2),p("src",t.images,$)("alt",t.name),r(3),_(" ",t.name," "),r(4),h(t.animals)}}function Pe(a,e){if(a&1&&(i(0,"div",6),v(1,je,11,3,"div",34,Ae),o()),a&2){let t=g();r(),h(t.habitats())}}function Le(a,e){a&1&&(i(0,"div",12),d(1," Consommation enregistr\xE9e avec succ\xE8s ! "),o())}var P=class a{constructor(e,t,n,s,l){this.habitatService=e;this.animalFeedingService=t;this.router=n;this.authService=s;this.toastService=l}habitats=m([]);animals=m([]);isLoading=m(!1);error=m(null);feedingInProgress=m(new Set);modalToastVisible=m(!1);isModalOpen=m(!1);selectedAnimalId=m(null);activeToasts=m(new Set);feedingData={feedingTime:new Date,foodType:"",quantity:0,animalId:0,employeId:0,employeName:"",notes:""};destroy$=new I;destroyRef=w(X);ngOnInit(){this.loadHabitats()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}markAsFed(e){return L(this,null,function*(){if(this.feedingInProgress().has(e)){this.toastService.showError("Op\xE9ration d\xE9j\xE0 en cours");return}let t=this.authService.user();if(!t?.id){this.toastService.showError("ID utilisateur non disponible");return}let n=this.prepareFeedingData(e,t);this.updateFeedingProgress(e,!0);try{yield G(this.animalFeedingService.markAnimalAsFed(e,n).pipe(H(this.destroy$),R(()=>this.updateFeedingProgress(e,!1)))),this.toastService.showSuccess("Animal nourri avec succ\xE8s"),this.habitatService.clearCache(),this.loadHabitats(),this.showToastForAnimal(e)}catch(s){console.error("Erreur compl\xE8te:",s),this.toastService.showError("Erreur lors du marquage de l'animal comme nourri")}})}loadHabitats(){this.isLoading.set(!0),this.error.set(null),this.habitatService.getHabitats().pipe(K(e=>W(e).pipe(Q(t=>this.habitatService.getAnimalsByHabitatId(t.id_habitat).pipe(U(n=>B(z({},t),{animals:n,images:t.images??void 0}))),3),xe(this.destroyRef),J())),R(()=>this.isLoading.set(!1))).subscribe({next:e=>{this.habitats.set(e)},error:()=>{this.error.set("Erreur lors du chargement des habitats"),this.toastService.showError("Erreur lors du chargement des habitats")}})}openFeedingModal(e){if(!e){this.toastService.showError("ID animal invalide");return}this.selectedAnimalId.set(e),this.feedingData.animalId=e,this.isModalOpen.set(!0)}handleFeedingSave(){return L(this,null,function*(){if(!this.validateFeedingData()){this.toastService.showError("Veuillez remplir tous les champs correctement");return}try{yield this.markAsFed(this.feedingData.animalId),this.modalToastVisible.set(!0),this.resetFeedingData(),setTimeout(()=>{this.modalToastVisible.set(!1),this.isModalOpen.set(!1)},3e3)}catch(e){console.error("Erreur lors de l'enregistrement:",e),this.toastService.showError("Erreur lors de l'enregistrement de la consommation")}})}closeModal(){this.isModalOpen.set(!1),this.modalToastVisible.set(!1)}goBack(){this.router.navigate(["/"])}prepareFeedingData(e,t){return{feedingTime:new Date,animalId:e,employeId:t.id,employeName:t.name||"Employ\xE9 inconnu",user_id:t.id,user_name:t.name||"Employ\xE9 inconnu",foodType:this.feedingData.foodType,quantity:this.feedingData.quantity,notes:this.feedingData.notes||""}}updateFeedingProgress(e,t){let n=new Set(this.feedingInProgress());t?n.add(e):n.delete(e),this.feedingInProgress.set(n)}validateFeedingData(){return!!(this.feedingData.animalId&&this.feedingData.foodType&&this.feedingData.quantity>0)}resetFeedingData(){this.feedingData={feedingTime:new Date,foodType:"",quantity:0,animalId:0,employeId:0,employeName:"",notes:""}}showToastForAnimal(e){this.activeToasts.update(t=>{let n=new Set(t);return n.add(e),n}),setTimeout(()=>{this.activeToasts.update(t=>{let n=new Set(t);return n.delete(e),n})},3e3)}static \u0275fac=function(t){return new(t||a)(x(be),x(V),x(oe),x(ae),x(O))};static \u0275cmp=b({type:a,selectors:[["app-animal-feeding-management"]],standalone:!0,features:[C],decls:51,vars:21,consts:[[1,"w-full","bg-gradient-to-b","from-secondary","to-primary","shadow-lg","py-8"],[1,"container","mx-auto","px-4"],[1,"text-center","space-y-4","mb-12"],[1,"text-3xl","md:text-5xl","lg:text-6xl","font-serif","font-bold","text-quinary"],[1,"text-lg","md:text-xl","text-tertiary","font-serif","italic","max-w-4xl","mx-auto"],[1,"flex","justify-center","items-center","h-48"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[3,"close","isOpen"],[1,"bg-white","rounded-2xl","shadow-lg","overflow-hidden"],[1,"bg-tertiary","px-6","py-4"],[1,"text-xl","font-serif","font-semibold","text-white"],[1,"p-6","space-y-6"],[1,"bg-green-100","text-green-700","px-4","py-2","rounded-lg","text-center"],[1,"space-y-6",3,"submit"],["for","dateTime",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","dateTime","type","datetime-local","name","dateTime","required","",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary",3,"ngModelChange","ngModel"],["for","foodType",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","foodType","name","foodType","required","",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary",3,"ngModelChange","ngModel"],["value",""],["value","viande"],["value","poisson"],["value","fruits"],["value","legumes"],["value","graines"],["for","quantity",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","quantity","type","number","name","quantity","min","0","step","0.1","required","",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary",3,"ngModelChange","ngModel"],["for","notes",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","notes","name","notes","rows","3","placeholder","Ajoutez des observations ou commentaires...",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary","resize-none",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-4","pt-4"],[3,"click","keydown.enter","text","type","color","rounded","customClass"],[3,"keydown.enter","text","type","color","rounded","customClass"],[1,"flex","justify-center","mt-8"],[1,"w-full","sm:w-1/3","lg:w-1/4","font-bold","shadow-md","hover:shadow-lg","transition-all","duration-300",3,"click","keydown.enter","text","type","color","rounded"],[1,"animate-spin","rounded-full","h-12","w-12","border-4","border-tertiary","border-t-transparent"],[1,"bg-white/80","backdrop-blur-sm","rounded-2xl","shadow-lg","overflow-hidden"],[1,"relative","h-48"],[1,"w-full","h-full","object-cover",3,"src","alt"],[1,"absolute","inset-0","bg-gradient-to-t","from-black/70","to-transparent"],[1,"absolute","bottom-4","left-4","text-2xl","font-serif","font-bold","text-white"],[1,"p-4","space-y-4"],[1,"text-lg","font-serif","font-semibold","text-tertiary","mb-4"],[1,"relative","bg-gray-50","rounded-xl","p-4","hover:shadow-md","transition-all","duration-300"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","rounded-full","object-cover","shadow-md",3,"src","alt"],[1,"font-medium","text-tertiary"],[1,"text-sm","text-gray-500"],[1,"flex","items-center","gap-2"],[1,"bg-green-100","text-green-700","px-3","py-1","rounded-full","text-sm"],[3,"click","keydown.enter","text","type","color","rounded","customClass","disabled"],[3,"animalId"]],template:function(t,n){t&1&&(i(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),d(4," Alimentation des Animaux "),o(),i(5,"p",4),d(6," G\xE9rez les repas et suivez l'historique d'alimentation "),o(),u(7,"app-toast"),o(),f(8,qe,2,0,"div",5)(9,Pe,3,0,"div",6),i(10,"app-modal",7),c("close",function(){return n.closeModal()}),i(11,"div",8)(12,"div",9)(13,"h3",10),d(14," Enregistrer une consommation "),o()(),i(15,"div",11),f(16,Le,2,0,"div",12),i(17,"form",13),c("submit",function(){return n.handleFeedingSave()}),i(18,"div")(19,"label",14),d(20," Date et heure "),o(),i(21,"input",15),k("ngModelChange",function(l){return M(n.feedingData.feedingTime,l)||(n.feedingData.feedingTime=l),l}),o()(),i(22,"div")(23,"label",16),d(24," Type d'alimentation "),o(),i(25,"select",17),k("ngModelChange",function(l){return M(n.feedingData.foodType,l)||(n.feedingData.foodType=l),l}),i(26,"option",18),d(27,"S\xE9lectionnez un type"),o(),i(28,"option",19),d(29,"Viande"),o(),i(30,"option",20),d(31,"Poisson"),o(),i(32,"option",21),d(33,"Fruits"),o(),i(34,"option",22),d(35,"L\xE9gumes"),o(),i(36,"option",23),d(37,"Graines"),o()()(),i(38,"div")(39,"label",24),d(40," Quantit\xE9 (en kg) "),o(),i(41,"input",25),k("ngModelChange",function(l){return M(n.feedingData.quantity,l)||(n.feedingData.quantity=l),l}),o()(),i(42,"div")(43,"label",26),d(44," Notes (optionnel) "),o(),i(45,"textarea",27),k("ngModelChange",function(l){return M(n.feedingData.notes,l)||(n.feedingData.notes=l),l}),o()(),i(46,"div",28)(47,"app-button",29),c("click",function(){return n.closeModal()})("keydown.enter",function(){return n.closeModal()}),o(),i(48,"app-button",30),c("keydown.enter",function(){return n.handleFeedingSave()}),o()()()()()(),i(49,"div",31)(50,"app-button",32),c("click",function(){return n.goBack()})("keydown.enter",function(){return n.goBack()}),o()()()()),t&2&&(r(8),y(n.isLoading()?8:9),r(2),p("isOpen",n.isModalOpen()),r(6),y(n.modalToastVisible()?16:-1),r(5),D("ngModel",n.feedingData.feedingTime),r(4),D("ngModel",n.feedingData.foodType),r(16),D("ngModel",n.feedingData.quantity),r(4),D("ngModel",n.feedingData.notes),r(2),p("text","Annuler")("type","button")("color","secondary")("rounded",!0)("customClass","px-6"),r(),p("text","Enregistrer")("type","submit")("color","tertiary")("rounded",!0)("customClass","px-6"),r(2),p("text","Retour")("type","button")("color","tertiary")("rounded",!0))},dependencies:[S,q,ve,pe,ge,fe,re,ce,ue,de,se,_e,ye,me,le,he,j,N],encapsulation:2})};var Re=(a,e)=>e.type;function $e(a,e){if(a&1&&(i(0,"div",11),d(1),o()),a&2){let t=g().$implicit;r(),_(" ",t.description," ")}}function ze(a,e){if(a&1){let t=A();i(0,"button",9),c("click",function(){let s=F(t).$implicit,l=g();return T(l.setActiveTab(s.type))}),i(1,"span",10),d(2),o(),f(3,$e,2,1,"div",11),o()}if(a&2){let t=e.$implicit,n=g();Y(n.activeTab()===t.type?"bg-tertiary text-white shadow-md":"text-tertiary hover:bg-tertiary/10"),r(2),E(t.text),r(),y(t.description?3:-1)}}function Be(a,e){a&1&&u(0,"app-user-opinion-management")}function We(a,e){a&1&&u(0,"app-service-management")}function Ge(a,e){a&1&&u(0,"app-animal-feeding-management")}var Te=class a{activeTab=m("opinions");navigationItems=[{text:"Gestion des avis",type:"opinions",description:"G\xE9rer les avis des visiteurs"},{text:"Gestion des services",type:"services",description:"G\xE9rer les services du zoo"},{text:"Gestion de l'alimentation",type:"feeding",description:"G\xE9rer l'alimentation des animaux"}];setActiveTab(e){this.activeTab.set(e)}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=b({type:a,selectors:[["app-employe-dashboard"]],standalone:!0,features:[C],decls:15,vars:1,consts:[[1,"w-full","bg-gradient-to-b","from-secondary","to-primary","min-h-screen"],[1,"container","mx-auto","px-4","py-8"],[1,"text-center","space-y-4","mb-12"],[1,"text-3xl","md:text-5xl","lg:text-6xl","font-serif","font-bold","text-quinary"],[1,"text-lg","md:text-xl","text-tertiary","font-serif","italic","max-w-4xl","mx-auto"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-4","mb-8"],[1,"flex","flex-wrap","justify-center","gap-4"],[1,"px-6","py-3","rounded-lg","transition-all","duration-300","relative","group",3,"class"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-6"],[1,"px-6","py-3","rounded-lg","transition-all","duration-300","relative","group",3,"click"],[1,"font-medium"],[1,"absolute","bottom-full","left-1/2","transform","-translate-x-1/2","mb-2","px-3","py-1","bg-black/75","text-white","text-sm","rounded-lg","opacity-0","group-hover:opacity-100","transition-opacity","duration-200","whitespace-nowrap","pointer-events-none"]],template:function(t,n){if(t&1&&(i(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),d(4," Tableau de Bord Employ\xE9 "),o(),i(5,"p",4),d(6," G\xE9rez les diff\xE9rentes fonctionnalit\xE9s du zoo "),o()(),i(7,"nav",5)(8,"div",6),v(9,ze,4,4,"button",7,Re),o()(),i(11,"div",8),f(12,Be,1,0,"app-user-opinion-management")(13,We,1,0,"app-service-management")(14,Ge,1,0,"app-animal-feeding-management"),o()()()),t&2){let s;r(9),h(n.navigationItems),r(3),y((s=n.activeTab())==="opinions"?12:s==="services"?13:s==="feeding"?14:-1)}},dependencies:[S,Se,Ce,P],encapsulation:2})};export{Te as EmployeDashboardComponent};
