"use strict";(self.webpackChunkarcadia_zoo_app_front=self.webpackChunkarcadia_zoo_app_front||[]).push([[14],{6014:(K,c,s)=>{s.r(c),s.d(c,{EmployeDashboardComponent:()=>W});var m=s(177),e=s(4438),F=s(5198),u=s(467),l=s(9417),g=s(8219),f=s(9081),b=s(6029),y=s(1413),_=s(4843),p=s(6977),h=s(980),D=s(5558),C=s(7468),E=s(6354),v=s(9955),x=s(9702);const T=(i,a)=>a.id_feeding;function j(i,a){1&i&&(e.j41(0,"div",6),e.nrm(1,"div",10),e.k0s())}function k(i,a){1&i&&(e.j41(0,"div",7),e.EFF(1," Aucun historique de repas disponible pour cet animal. "),e.k0s())}function w(i,a){if(1&i&&(e.j41(0,"div",17),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI(' "',t.notes,'" ')}}function M(i,a){if(1&i&&(e.j41(0,"div",11)(1,"div",12)(2,"div")(3,"div",13),e.EFF(4),e.k0s(),e.j41(5,"div",14),e.EFF(6),e.k0s()(),e.j41(7,"div",15)(8,"div",14),e.EFF(9),e.nI1(10,"date"),e.k0s(),e.j41(11,"div",16),e.EFF(12),e.k0s()()(),e.DNE(13,w,2,1,"div",17),e.k0s()),2&i){const t=a.$implicit;e.R7$(4),e.SpI(" ",t.food_type," "),e.R7$(2),e.Lme(" Quantit\xe9: ",t.quantity," ",t.unit," "),e.R7$(3),e.SpI(" ",e.i5U(10,6,t.feeding_date,"dd/MM/yyyy \xe0 HH:mm")," "),e.R7$(3),e.SpI(" Par: ",t.user_name," "),e.R7$(),e.vxM(t.notes?13:-1)}}function R(i,a){if(1&i&&(e.j41(0,"div",8),e.Z7z(1,M,14,9,"div",11,T),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Dyx(t.sortedHistory())}}let $=(()=>{class i{animalFeeding;toastService;animalId;animalName;destroy$=new y.B;feedingHistory=(0,e.vPA)([]);isModalOpen=(0,e.vPA)(!1);isLoading=(0,e.vPA)(!0);sortedHistory=(0,e.EWP)(()=>[...this.feedingHistory()].sort((t,n)=>new Date(n.feeding_date).getTime()-new Date(t.feeding_date).getTime()));constructor(t,n){this.animalFeeding=t,this.toastService=n}ngOnInit(){this.loadFeedingHistory()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadFeedingHistory(){this.isLoading.set(!0),this.animalFeeding.getFeedingHistory(this.animalId).pipe((0,p.Q)(this.destroy$)).subscribe({next:t=>{const n=t.map(this.mapHistoryResponse);this.feedingHistory.set(n),this.isLoading.set(!1)},error:t=>{console.error("Erreur lors du chargement de l'historique:",t),this.toastService.showError("Erreur lors du chargement de l'historique"),this.isLoading.set(!1)}})}mapHistoryResponse(t){return{_id:t._id,id_feeding:t.id_feeding,animal_id:t.animal_id,feeding_date:t.feeding_date,food_type:t.food_type,quantity:t.quantity,unit:t.unit,notes:t.notes,user_name:t.user_name,status:t.status,created_at:t.created_at,updated_at:t.updated_at}}closeModal(){this.isModalOpen.set(!1)}static \u0275fac=function(n){return new(n||i)(e.rXU(v.r),e.rXU(x.f))};static \u0275cmp=e.VBU({type:i,selectors:[["app-feeding-history"]],inputs:{animalId:"animalId",animalName:"animalName"},standalone:!0,features:[e.aNF],decls:12,vars:12,consts:[[3,"click","text","type","color","rounded","customClass"],[3,"close","isOpen"],[1,"bg-white","rounded-2xl","shadow-lg","overflow-hidden"],[1,"bg-tertiary","px-6","py-4"],[1,"text-xl","font-serif","font-semibold","text-white"],[1,"p-6","max-h-[70vh]","overflow-y-auto"],[1,"flex","justify-center","items-center","h-48"],[1,"text-center","py-4","text-gray-500"],[1,"space-y-4"],[1,"bg-gray-50","px-6","py-4","flex","justify-end"],[1,"animate-spin","rounded-full","h-12","w-12","border-4","border-tertiary","border-t-transparent"],[1,"bg-gray-50","rounded-lg","p-4","hover:shadow-md","transition-all","duration-300"],[1,"flex","justify-between","items-start"],[1,"text-sm","font-medium","text-tertiary"],[1,"text-sm","text-gray-500"],[1,"text-right"],[1,"text-xs","text-gray-400"],[1,"mt-2","text-sm","text-gray-600","italic"]],template:function(n,o){1&n&&(e.j41(0,"app-button",0),e.bIt("click",function(){return o.isModalOpen.set(!0)}),e.k0s(),e.j41(1,"app-modal",1),e.bIt("close",function(){return o.closeModal()}),e.j41(2,"div",2)(3,"div",3)(4,"h3",4),e.EFF(5," Historique des repas "),e.k0s()(),e.j41(6,"div",5),e.DNE(7,j,2,0,"div",6)(8,k,2,0,"div",7)(9,R,3,0,"div",8),e.k0s(),e.j41(10,"div",9)(11,"app-button",0),e.bIt("click",function(){return o.closeModal()}),e.k0s()()()()),2&n&&(e.Y8G("text","Historique")("type","button")("color","secondary")("rounded",!0)("customClass","text-sm px-4 py-2"),e.R7$(),e.Y8G("isOpen",o.isModalOpen()),e.R7$(6),e.vxM(o.isLoading()?7:0===o.sortedHistory().length?8:9),e.R7$(4),e.Y8G("text","Fermer")("type","button")("color","secondary")("rounded",!0)("customClass","px-6"))},dependencies:[m.MD,m.vh,g.Q,f.z],encapsulation:2,changeDetection:0})}return i})();var S=s(1403),I=s(494),H=s(2773);const A=(i,a)=>a.id_habitat,G=(i,a)=>a.id_animal;function P(i,a){1&i&&(e.j41(0,"div",5),e.nrm(1,"div",30),e.k0s())}function N(i,a){1&i&&(e.j41(0,"div",45),e.EFF(1," Animal nourri ! "),e.k0s())}function z(i,a){if(1&i){const t=e.RV6();e.j41(0,"div",38)(1,"div",39)(2,"div",40),e.nrm(3,"img",41),e.j41(4,"div")(5,"h4",42),e.EFF(6),e.k0s(),e.j41(7,"p",43),e.EFF(8),e.k0s()()(),e.j41(9,"div",44),e.DNE(10,N,2,0,"div",45),e.j41(11,"app-button",46),e.bIt("click",function(){const o=e.eBV(t).$implicit,r=e.XpG(3);return e.Njj(r.openFeedingModal(o.id_animal))}),e.k0s(),e.nrm(12,"app-feeding-history",47),e.k0s()()()}if(2&i){const t=a.$implicit,n=e.XpG(3);e.R7$(3),e.Y8G("src",t.images,e.B4B)("alt",t.name),e.R7$(3),e.JRh(t.name),e.R7$(2),e.JRh(t.species),e.R7$(2),e.vxM(n.activeToasts().has(t.id_animal)?10:-1),e.R7$(),e.Y8G("text","Nourrir")("type","button")("color","tertiary")("rounded",!0)("customClass","text-sm px-4 py-2")("disabled",n.feedingInProgress().has(t.id_animal)),e.R7$(),e.Y8G("animalId",t.id_animal)}}function O(i,a){if(1&i&&(e.j41(0,"div",31)(1,"div",32),e.nrm(2,"img",33)(3,"div",34),e.j41(4,"h2",35),e.EFF(5),e.k0s()(),e.j41(6,"div",36)(7,"h3",37),e.EFF(8," Animaux \xe0 nourrir "),e.k0s(),e.Z7z(9,z,13,12,"div",38,G),e.k0s()()),2&i){const t=a.$implicit;e.R7$(2),e.Y8G("src",t.images,e.B4B)("alt",t.name),e.R7$(3),e.SpI(" ",t.name," "),e.R7$(4),e.Dyx(t.animals)}}function V(i,a){if(1&i&&(e.j41(0,"div",6),e.Z7z(1,O,11,3,"div",31,A),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Dyx(t.habitats())}}function B(i,a){1&i&&(e.j41(0,"div",12),e.EFF(1," Consommation enregistr\xe9e avec succ\xe8s ! "),e.k0s())}let X=(()=>{class i{habitatService;animalFeedingService;router;authService;toastService;habitats=(0,e.vPA)([]);animals=(0,e.vPA)([]);isLoading=(0,e.vPA)(!1);error=(0,e.vPA)(null);feedingInProgress=(0,e.vPA)(new Set);modalToastVisible=(0,e.vPA)(!1);isModalOpen=(0,e.vPA)(!1);selectedAnimalId=(0,e.vPA)(null);activeToasts=(0,e.vPA)(new Set);feedingData={feedingTime:new Date,foodType:"",quantity:0,animalId:0,employeId:0,employeName:"",notes:""};destroy$=new y.B;constructor(t,n,o,r,d){this.habitatService=t,this.animalFeedingService=n,this.router=o,this.authService=r,this.toastService=d}ngOnInit(){this.loadHabitats()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}markAsFed(t){var n=this;return(0,u.A)(function*(){if(n.feedingInProgress().has(t))return void n.toastService.showError("Op\xe9ration d\xe9j\xe0 en cours");const o=n.authService.currentUserSignal();if(!o?.id)return void n.toastService.showError("ID utilisateur non disponible");const r=n.prepareFeedingData(t,o);n.updateFeedingProgress(t,!0);try{yield(0,_._)(n.animalFeedingService.markAnimalAsFed(t,r).pipe((0,p.Q)(n.destroy$),(0,h.j)(()=>n.updateFeedingProgress(t,!1)))),n.toastService.showSuccess("Animal nourri avec succ\xe8s"),n.habitatService.clearCache(),n.loadHabitats(),n.showToastForAnimal(t)}catch(d){console.error("Erreur compl\xe8te:",d),n.toastService.showError("Erreur lors du marquage de l'animal comme nourri")}})()}loadHabitats(){this.isLoading.set(!0),this.error.set(null),this.habitatService.getHabitats().pipe((0,D.n)(t=>(0,C.p)(t.map(n=>this.habitatService.getAnimalsByHabitatId(n.id_habitat).pipe((0,E.T)(o=>({...n,animals:o,images:n.images||void 0})))))),(0,p.Q)(this.destroy$),(0,h.j)(()=>this.isLoading.set(!1))).subscribe({next:t=>{this.habitats.set(t)},error:()=>{this.error.set("Erreur lors du chargement des habitats"),this.toastService.showError("Erreur lors du chargement des habitats")}})}openFeedingModal(t){t?(this.selectedAnimalId.set(t),this.feedingData.animalId=t,this.isModalOpen.set(!0)):this.toastService.showError("ID animal invalide")}handleFeedingSave(){var t=this;return(0,u.A)(function*(){if(t.validateFeedingData())try{yield t.markAsFed(t.feedingData.animalId),t.modalToastVisible.set(!0),t.resetFeedingData(),setTimeout(()=>{t.modalToastVisible.set(!1),t.isModalOpen.set(!1)},3e3)}catch(n){console.error("Erreur lors de l'enregistrement:",n),t.toastService.showError("Erreur lors de l'enregistrement de la consommation")}else t.toastService.showError("Veuillez remplir tous les champs correctement")})()}closeModal(){this.isModalOpen.set(!1),this.modalToastVisible.set(!1)}goBack(){this.router.navigate(["/"])}prepareFeedingData(t,n){return{feedingTime:new Date,animalId:t,employeId:n.id,employeName:n.name||"Employ\xe9 inconnu",user_id:n.id,user_name:n.name||"Employ\xe9 inconnu",foodType:this.feedingData.foodType,quantity:this.feedingData.quantity,notes:this.feedingData.notes||""}}updateFeedingProgress(t,n){const o=new Set(this.feedingInProgress());n?o.add(t):o.delete(t),this.feedingInProgress.set(o)}validateFeedingData(){return!!(this.feedingData.animalId&&this.feedingData.foodType&&this.feedingData.quantity>0)}resetFeedingData(){this.feedingData={feedingTime:new Date,foodType:"",quantity:0,animalId:0,employeId:0,employeName:"",notes:""}}showToastForAnimal(t){this.activeToasts.update(n=>{const o=new Set(n);return o.add(t),o}),setTimeout(()=>{this.activeToasts.update(n=>{const o=new Set(n);return o.delete(t),o})},3e3)}static \u0275fac=function(n){return new(n||i)(e.rXU(S.R),e.rXU(v.r),e.rXU(I.Ix),e.rXU(H.u),e.rXU(x.f))};static \u0275cmp=e.VBU({type:i,selectors:[["app-animal-feeding-management"]],standalone:!0,features:[e.aNF],decls:51,vars:21,consts:[[1,"w-full","bg-gradient-to-b","from-secondary","to-primary","shadow-lg","py-8"],[1,"container","mx-auto","px-4"],[1,"text-center","space-y-4","mb-12"],[1,"text-3xl","md:text-5xl","lg:text-6xl","font-serif","font-bold","text-quinary"],[1,"text-lg","md:text-xl","text-tertiary","font-serif","italic","max-w-4xl","mx-auto"],[1,"flex","justify-center","items-center","h-48"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[3,"close","isOpen"],[1,"bg-white","rounded-2xl","shadow-lg","overflow-hidden"],[1,"bg-tertiary","px-6","py-4"],[1,"text-xl","font-serif","font-semibold","text-white"],[1,"p-6","space-y-6"],[1,"bg-green-100","text-green-700","px-4","py-2","rounded-lg","text-center"],[1,"space-y-6",3,"submit"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","datetime-local","name","dateTime","required","",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary",3,"ngModelChange","ngModel"],["name","foodType","required","",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary",3,"ngModelChange","ngModel"],["value",""],["value","viande"],["value","poisson"],["value","fruits"],["value","legumes"],["value","graines"],["type","number","name","quantity","min","0","step","0.1","required","",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary",3,"ngModelChange","ngModel"],["name","notes","rows","3","placeholder","Ajoutez des observations ou commentaires...",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary","resize-none",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-4","pt-4"],[3,"click","text","type","color","rounded","customClass"],[3,"text","type","color","rounded","customClass"],[1,"flex","justify-center","mt-8"],[1,"w-full","sm:w-1/3","lg:w-1/4","font-bold","shadow-md","hover:shadow-lg","transition-all","duration-300",3,"click","text","type","color","rounded"],[1,"animate-spin","rounded-full","h-12","w-12","border-4","border-tertiary","border-t-transparent"],[1,"bg-white/80","backdrop-blur-sm","rounded-2xl","shadow-lg","overflow-hidden"],[1,"relative","h-48"],[1,"w-full","h-full","object-cover",3,"src","alt"],[1,"absolute","inset-0","bg-gradient-to-t","from-black/70","to-transparent"],[1,"absolute","bottom-4","left-4","text-2xl","font-serif","font-bold","text-white"],[1,"p-4","space-y-4"],[1,"text-lg","font-serif","font-semibold","text-tertiary","mb-4"],[1,"bg-gray-50","rounded-xl","p-4","hover:shadow-md","transition-all","duration-300"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","rounded-full","object-cover","shadow-md",3,"src","alt"],[1,"font-medium","text-tertiary"],[1,"text-sm","text-gray-500"],[1,"flex","items-center","gap-2"],[1,"bg-green-100","text-green-700","px-3","py-1","rounded-full","text-sm"],[3,"click","text","type","color","rounded","customClass","disabled"],[3,"animalId"]],template:function(n,o){1&n&&(e.j41(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),e.EFF(4," Alimentation des Animaux "),e.k0s(),e.j41(5,"p",4),e.EFF(6," G\xe9rez les repas et suivez l'historique d'alimentation "),e.k0s(),e.nrm(7,"app-toast"),e.k0s(),e.DNE(8,P,2,0,"div",5)(9,V,3,0,"div",6),e.j41(10,"app-modal",7),e.bIt("close",function(){return o.closeModal()}),e.j41(11,"div",8)(12,"div",9)(13,"h3",10),e.EFF(14," Enregistrer une consommation "),e.k0s()(),e.j41(15,"div",11),e.DNE(16,B,2,0,"div",12),e.j41(17,"form",13),e.bIt("submit",function(){return o.handleFeedingSave()}),e.j41(18,"div")(19,"label",14),e.EFF(20," Date et heure "),e.k0s(),e.j41(21,"input",15),e.mxI("ngModelChange",function(d){return e.DH7(o.feedingData.feedingTime,d)||(o.feedingData.feedingTime=d),d}),e.k0s()(),e.j41(22,"div")(23,"label",14),e.EFF(24," Type d'alimentation "),e.k0s(),e.j41(25,"select",16),e.mxI("ngModelChange",function(d){return e.DH7(o.feedingData.foodType,d)||(o.feedingData.foodType=d),d}),e.j41(26,"option",17),e.EFF(27,"S\xe9lectionnez un type"),e.k0s(),e.j41(28,"option",18),e.EFF(29,"Viande"),e.k0s(),e.j41(30,"option",19),e.EFF(31,"Poisson"),e.k0s(),e.j41(32,"option",20),e.EFF(33,"Fruits"),e.k0s(),e.j41(34,"option",21),e.EFF(35,"L\xe9gumes"),e.k0s(),e.j41(36,"option",22),e.EFF(37,"Graines"),e.k0s()()(),e.j41(38,"div")(39,"label",14),e.EFF(40," Quantit\xe9 (en kg) "),e.k0s(),e.j41(41,"input",23),e.mxI("ngModelChange",function(d){return e.DH7(o.feedingData.quantity,d)||(o.feedingData.quantity=d),d}),e.k0s()(),e.j41(42,"div")(43,"label",14),e.EFF(44," Notes (optionnel) "),e.k0s(),e.j41(45,"textarea",24),e.mxI("ngModelChange",function(d){return e.DH7(o.feedingData.notes,d)||(o.feedingData.notes=d),d}),e.k0s()(),e.j41(46,"div",25)(47,"app-button",26),e.bIt("click",function(){return o.closeModal()}),e.k0s(),e.nrm(48,"app-button",27),e.k0s()()()()(),e.j41(49,"div",28)(50,"app-button",29),e.bIt("click",function(){return o.goBack()}),e.k0s()()()()),2&n&&(e.R7$(8),e.vxM(o.isLoading()?8:9),e.R7$(2),e.Y8G("isOpen",o.isModalOpen()),e.R7$(6),e.vxM(o.modalToastVisible()?16:-1),e.R7$(5),e.R50("ngModel",o.feedingData.feedingTime),e.R7$(4),e.R50("ngModel",o.feedingData.foodType),e.R7$(16),e.R50("ngModel",o.feedingData.quantity),e.R7$(4),e.R50("ngModel",o.feedingData.notes),e.R7$(2),e.Y8G("text","Annuler")("type","button")("color","secondary")("rounded",!0)("customClass","px-6"),e.R7$(),e.Y8G("text","Enregistrer")("type","submit")("color","tertiary")("rounded",!0)("customClass","px-6"),e.R7$(2),e.Y8G("text","Retour")("type","button")("color","tertiary")("rounded",!0))},dependencies:[m.MD,f.z,l.YN,l.qT,l.xH,l.y7,l.me,l.Q0,l.wz,l.BC,l.cb,l.YS,l.VZ,l.vS,l.cV,b.d,$,g.Q],encapsulation:2})}return i})();var Y=s(5606);const U=(i,a)=>a.type;function L(i,a){if(1&i&&(e.j41(0,"div",11),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",t.description," ")}}function Q(i,a){if(1&i){const t=e.RV6();e.j41(0,"button",9),e.bIt("click",function(){const o=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.setActiveTab(o.type))}),e.j41(1,"span",10),e.EFF(2),e.k0s(),e.DNE(3,L,2,1,"div",11),e.k0s()}if(2&i){const t=a.$implicit,n=e.XpG();e.HbH(n.activeTab()===t.type?"bg-tertiary text-white shadow-md":"text-tertiary hover:bg-tertiary/10"),e.R7$(2),e.JRh(t.text),e.R7$(),e.vxM(t.description?3:-1)}}function Z(i,a){1&i&&e.nrm(0,"app-user-opinion-management")}function J(i,a){1&i&&e.nrm(0,"app-service-management")}function q(i,a){1&i&&e.nrm(0,"app-animal-feeding-management")}let W=(()=>{class i{activeTab=(0,e.vPA)("opinions");navigationItems=[{text:"Gestion des avis",type:"opinions",description:"G\xe9rer les avis des visiteurs"},{text:"Gestion des services",type:"services",description:"G\xe9rer les services du zoo"},{text:"Gestion de l'alimentation",type:"feeding",description:"G\xe9rer l'alimentation des animaux"}];setActiveTab(t){this.activeTab.set(t)}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-employe-dashboard"]],standalone:!0,features:[e.aNF],decls:15,vars:1,consts:[[1,"w-full","bg-gradient-to-b","from-secondary","to-primary","min-h-screen"],[1,"container","mx-auto","px-4","py-8"],[1,"text-center","space-y-4","mb-12"],[1,"text-3xl","md:text-5xl","lg:text-6xl","font-serif","font-bold","text-quinary"],[1,"text-lg","md:text-xl","text-tertiary","font-serif","italic","max-w-4xl","mx-auto"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-4","mb-8"],[1,"flex","flex-wrap","justify-center","gap-4"],[1,"px-6","py-3","rounded-lg","transition-all","duration-300","relative","group",3,"class"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-6"],[1,"px-6","py-3","rounded-lg","transition-all","duration-300","relative","group",3,"click"],[1,"font-medium"],[1,"absolute","bottom-full","left-1/2","transform","-translate-x-1/2","mb-2","px-3","py-1","bg-black/75","text-white","text-sm","rounded-lg","opacity-0","group-hover:opacity-100","transition-opacity","duration-200","whitespace-nowrap","pointer-events-none"]],template:function(n,o){if(1&n&&(e.j41(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),e.EFF(4," Tableau de Bord Employ\xe9 "),e.k0s(),e.j41(5,"p",4),e.EFF(6," G\xe9rez les diff\xe9rentes fonctionnalit\xe9s du zoo "),e.k0s()(),e.j41(7,"nav",5)(8,"div",6),e.Z7z(9,Q,4,4,"button",7,U),e.k0s()(),e.j41(11,"div",8),e.DNE(12,Z,1,0,"app-user-opinion-management")(13,J,1,0,"app-service-management")(14,q,1,0,"app-animal-feeding-management"),e.k0s()()()),2&n){let r;e.R7$(9),e.Dyx(o.navigationItems),e.R7$(3),e.vxM("opinions"===(r=o.activeTab())?12:"services"===r?13:"feeding"===r?14:-1)}},dependencies:[m.MD,Y.UserOpinionManagementComponent,F.ServiceManagementComponent,X],encapsulation:2})}return i})()}}]);