import{a as B}from"./chunk-GFOZMZCS.js";import{a as A}from"./chunk-YQ5HTG6F.js";import{a as L}from"./chunk-SHRURUTQ.js";import{Ab as z,Eb as T,Gb as V,Ka as m,T as v,Va as x,W as k,Za as E,_a as F,aa as s,bb as h,c as C,ca as I,eb as $,ec as D,fb as q,gb as t,hb as r,ib as l,jb as w,kb as H,lb as c,ma as S,na as b,nc as R,oa as d,pa as p,qc as j,rb as o,sb as u,tb as M}from"./chunk-TKCV3HAR.js";var f=class n{apiUrl=`${j.apiUrl}/api/habitat-comment`;http=s(R);commentStatusService=s(B);constructor(){}getHabitatCommentHistory(){return this.http.get(this.apiUrl).pipe(v(i=>{console.log("Tous les commentaires r\xE9cup\xE9r\xE9s:",i)}))}markCommentAsResolved(i){let e=`${this.apiUrl}/${i}/resolve`;return console.log("Tentative de r\xE9solution du commentaire:",i),this.http.patch(e,{}).pipe(v({next:a=>{console.log("Commentaire marqu\xE9 comme r\xE9solu:",a),this.commentStatusService.emitCommentStatusChange(a)},error:a=>console.error("Erreur lors de la r\xE9solution:",a)}))}reopenComment(i){let e=`${this.apiUrl}/${i}/reopen`;return console.log("Tentative de r\xE9ouverture du commentaire:",i),this.http.patch(e,{}).pipe(v({next:a=>{console.log("Commentaire rouvert:",a),this.commentStatusService.emitCommentStatusChange(a)},error:a=>console.error("Erreur lors de la r\xE9ouverture:",a)}))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=k({token:n,factory:n.\u0275fac,providedIn:"root"})};var U=(n,i)=>i._id;function G(n,i){n&1&&(t(0,"div",10),d(),t(1,"svg",17),l(2,"path",18),r(),p(),t(3,"span"),o(4,"R\xE9gl\xE9"),r()())}function N(n,i){n&1&&(t(0,"div",11),d(),t(1,"svg",17),l(2,"path",19),r(),p(),t(3,"span"),o(4,"En attente"),r()())}function J(n,i){if(n&1){let e=w();t(0,"div",20),d(),t(1,"svg",21),l(2,"path",22),r(),p(),t(3,"span"),o(4," R\xE9solu par "),t(5,"span",23),o(6),r(),t(7,"span",24),o(8),T(9,"date"),r()()(),t(10,"app-button",25),H("click",function(g){S(e);let y=c().$implicit,_=c();return g.preventDefault(),b(_.reopenComment(y._id))}),r()}if(n&2){let e=c().$implicit;m(6),u(e.resolved_by),m(2),M("le ",V(9,5,e.resolved_at,"dd/MM/yyyy"),""),m(2),E("color","tertiary")("text","Rouvrir le ticket")("rounded",!0)}}function K(n,i){if(n&1){let e=w();t(0,"div",20),d(),t(1,"svg",21),l(2,"path",26),r(),p(),t(3,"span"),o(4,"En attente de r\xE9solution"),r()(),t(5,"app-button",25),H("click",function(g){S(e);let y=c().$implicit,_=c();return g.preventDefault(),b(_.markAsResolved(y._id))}),r()}n&2&&(m(5),E("color","success")("text","Valider la r\xE9solution")("rounded",!0))}function Q(n,i){if(n&1&&(t(0,"div",3),l(1,"div",5),t(2,"div",6)(3,"div",7)(4,"div",8),o(5),T(6,"date"),r(),t(7,"div",9),x(8,G,5,0,"div",10)(9,N,5,0,"div",11),r()(),t(10,"div",12)(11,"div",13)(12,"div",14),o(13," Habitat "),r(),t(14,"div",15),o(15),r()(),t(16,"div",13)(17,"div",14),o(18," V\xE9t\xE9rinaire "),r(),t(19,"div",15),o(20),r()(),t(21,"div",13)(22,"div",14),o(23," Commentaire "),r(),t(24,"div",15),o(25),r()()(),t(26,"div",16),x(27,J,11,8)(28,K,6,3),r()()()),n&2){let e=i.$implicit;m(),F("bg-green-500",e.is_resolved)("bg-red-500",!e.is_resolved),m(4),M(" ",V(6,10,e.createdAt,"dd/MM/yyyy HH:mm")," "),m(3),h(e.is_resolved?8:9),m(7),u(e.habitat_name),m(5),u(e.user_name),m(5),u(e.comment),m(2),h(e.is_resolved?27:28)}}function W(n,i){n&1&&(t(0,"div",4)(1,"div",27),o(2," Aucun historique de commentaire disponible "),r()())}var O=class n{commentHistory=[];historyService=s(f);toastService=s(A);ngOnInit(){this.loadCommentHistory()}loadCommentHistory(){this.historyService.getHabitatCommentHistory().subscribe({next:i=>{this.commentHistory=i,this.toastService.showSuccess("Historique charg\xE9 avec succ\xE8s")},error:i=>{console.error("Erreur lors du chargement de l'historique:",i),this.toastService.showError("Erreur lors du chargement de l'historique")}})}markAsResolved(i){return C(this,null,function*(){if(!i){this.toastService.showError("ID du commentaire manquant");return}try{yield this.historyService.markCommentAsResolved(i).toPromise(),this.loadCommentHistory(),this.toastService.showSuccess("Commentaire marqu\xE9 comme r\xE9solu")}catch(e){console.error("Erreur lors du marquage comme r\xE9solu:",e),this.toastService.showError("Erreur lors de la r\xE9solution du commentaire")}})}reopenComment(i){return C(this,null,function*(){if(!i){this.toastService.showError("ID du commentaire manquant");return}try{yield this.historyService.reopenComment(i).toPromise(),this.loadCommentHistory(),this.toastService.showSuccess("Commentaire rouvert avec succ\xE8s")}catch(e){console.error("Erreur lors de la r\xE9ouverture du commentaire:",e),this.toastService.showError("Erreur lors de la r\xE9ouverture du commentaire")}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-history-management"]],standalone:!0,features:[z],decls:7,vars:1,consts:[[1,"p-6","bg-white","rounded-xl","shadow-xl","shadow-tertiary/20","my-4"],[1,"text-3xl","font-serif","font-bold","text-tertiary","text-center","mb-8"],[1,"space-y-4"],[1,"bg-white","rounded-lg","shadow-md","hover:shadow-lg","transition-all","duration-300","overflow-hidden"],[1,"text-center","py-12"],[1,"h-1","w-full"],[1,"p-4"],[1,"flex","justify-between","items-start","mb-4"],[1,"text-sm","text-tertiary/80"],[1,"flex","items-center","gap-2"],[1,"flex","items-center","gap-1.5","bg-green-50","text-green-700","px-3","py-1","rounded-full","text-xs","font-medium"],[1,"flex","items-center","gap-1.5","bg-red-50","text-red-700","px-3","py-1","rounded-full","text-xs","font-medium"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-4"],[1,"space-y-1"],[1,"text-xs","font-medium","text-tertiary/60","uppercase"],[1,"text-sm","text-tertiary"],[1,"flex","flex-col-reverse","sm:flex-row","justify-between","items-center","gap-4","pt-4","border-t","border-gray-100"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-3.5","w-3.5"],["fill-rule","evenodd","d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule","evenodd"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 102 0V6zm-1 8a1 1 0 100-2 1 1 0 000 2z","clip-rule","evenodd"],[1,"text-sm","text-tertiary/70","flex","items-center","gap-2"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-4","w-4","text-tertiary/50"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"font-medium","text-tertiary"],[1,"text-tertiary/50"],[1,"w-full","sm:w-auto","min-w-[160px]",3,"click","color","text","rounded"],["fill-rule","evenodd","d","M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule","evenodd"],[1,"text-tertiary/50","text-lg","font-medium"]],template:function(e,a){e&1&&(t(0,"section",0)(1,"h2",1),o(2," Consultation des commentaires sur les habitats "),r(),t(3,"div",2),$(4,Q,29,13,"div",3,U),r(),x(6,W,3,0,"div",4),r()),e&2&&(m(4),q(a.commentHistory),m(2),h(a.commentHistory.length===0?6:-1))},dependencies:[D,L],encapsulation:2})};export{O as HistoryManagementComponent};
