<!-- Section principale des avis utilisateurs -->
<section class="w-full bg-primary shadow py-8">
  <div class="container mx-auto px-4">
    <div class="text-center mb-12">
      <h1 class="text-3xl md:text-5xl font-serif text-quinary font-bold mb-6">
        Avis de nos visiteurs
      </h1>
      <p class="text-base md:text-lg text-quinary font-sans max-w-4xl mx-auto">
        Découvrez ce que nos visiteurs pensent de leur expérience
      </p>
    </div>

    <!-- Container des avis -->
    <div class="max-w-xl mx-auto">
      @if (isLoading()) {
      <div class="text-center py-8">
        <p>Chargement des avis...</p>
      </div>
      } @else if (hasError()) {
      <div class="text-center py-8 text-red-500">
        <p>Une erreur est survenue lors du chargement des avis.</p>
        <button class="mt-4 text-blue-500" (click)="loadUserOpinions()">
          Réessayer
        </button>
      </div>
      } @else if (userOpinions().length > 0) {
      <div
        class="bg-white rounded-lg shadow-lg p-8 mb-8 transition-all duration-300 border border-quinary/10 hover:border-quinary/20"
      >
        <!-- En-tête de l'avis avec informations utilisateur et note -->
        <div class="flex items-center justify-between mb-6">
          <!-- Informations utilisateur -->
          <div class="flex items-center gap-4">
            <!-- Avatar avec première lettre du nom -->
            <div
              class="w-12 h-12 bg-secondary rounded-full flex items-center justify-center"
            >
              <span class="text-white text-xl font-semibold">
                {{ userOpinions()[currentUserOpinionsIndex()].name.charAt(0) }}
              </span>
            </div>
            <!-- Nom et date -->
            <div>
              <h3 class="font-semibold text-lg text-quinary">
                {{ userOpinions()[currentUserOpinionsIndex()].name }}
              </h3>
              <p class="text-sm text-gray-500">
                {{
                  userOpinions()[currentUserOpinionsIndex()].date
                    | date : "dd MMMM yyyy" : "fr-FR"
                }}
              </p>
            </div>
          </div>

          <!-- Composant d'affichage de la note -->
          <app-rate
            [rating]="currentRating"
            [isReadOnly]="isReadOnly"
          ></app-rate>
        </div>

        <!-- Message de l'avis -->
        <p class="text-gray-700 mb-6 italic">
          "{{ userOpinions()[currentUserOpinionsIndex()].message }}"
        </p>

        <!-- Navigation entre les avis -->
        <div class="flex justify-between items-center">
          <!-- Bouton précédent -->
          <app-button
            [text]="''"
            [color]="'secondary'"
            [customClass]="
              '!w-10 !h-10 flex items-center justify-center rounded-full !p-0'
            "
            (click)="changeUserOpinions('previous')"
            [disabled]="currentUserOpinionsIndex() === 0"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 19l-7-7 7-7"
              />
            </svg>
          </app-button>

          <!-- Indicateurs de pagination -->
          <div class="flex gap-2">
            @for (review of userOpinions(); track $index) {
            <div
              class="w-2 h-2 rounded-full cursor-pointer transition-all duration-300"
              [class.bg-tertiary]="$index === currentUserOpinionsIndex()"
              [class.bg-gray-300]="$index !== currentUserOpinionsIndex()"
              (click)="currentUserOpinionsIndex.set($index)"
            ></div>
            }
          </div>

          <!-- Bouton suivant -->
          <app-button
            [text]="''"
            [color]="'secondary'"
            [customClass]="
              '!w-10 !h-10 flex items-center justify-center rounded-full !p-0'
            "
            (click)="changeUserOpinions('next')"
            [disabled]="
              currentUserOpinionsIndex() === userOpinions().length - 1
            "
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              />
            </svg>
          </app-button>
        </div>
      </div>
      } @else {
      <!-- Message affiché quand aucun avis n'est disponible -->
      <p class="text-center text-gray-500">
        Aucun avis disponible pour le moment.
      </p>
      }

      <!-- Bouton pour ajouter un nouvel avis -->
      <div class="text-center mt-8">
        <app-button
          [text]="'Partagez votre expérience'"
          [color]="'tertiary'"
          [rounded]="true"
          [customClass]="
            '!w-auto !px-6 !py-3 font-semibold text-white hover:bg-quaternary transition-colors duration-300'
          "
          (click)="openModal()"
        >
        </app-button>
      </div>
    </div>
  </div>
</section>

<!-- Modal pour l'ajout d'avis -->
<app-modal [isOpen]="isModalOpen()" (closed)="closeModal()">
  <app-add-user-opinions (closeModal)="closeModal()"></app-add-user-opinions>
</app-modal>
