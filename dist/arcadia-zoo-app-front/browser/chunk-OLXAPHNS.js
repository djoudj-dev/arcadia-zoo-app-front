import{a as V}from"./chunk-3PZTUIRH.js";import{a as F}from"./chunk-XTDWMBHN.js";import{E as i,Ja as d,Pa as a,S as s,U,V as b,Za as u,_ as c,a as g,b as O,ba as C,cb as E,db as _,eb as j,fb as l,gb as v,i as f,ib as R,jb as $,kb as m,la as y,lc as I,ma as S,o as p,oc as P,qb as T,s as o,ua as w,yb as x,zb as A}from"./chunk-OS3QXM5S.js";function B(r,e){if(r&1){let t=R();l(0,"span",2),$("click",function(){let N=y(t).$implicit,h=m();return S(!h.isReadOnly()&&h.changeRate(N))}),l(1,"i",3),T(2,"\u2605"),v()()}if(r&2){let t=e.$implicit,n=m();u("read-only",n.isReadOnly()),d(),u("filled",t<=n.rating())}}var k=class r{rating=a(0);stars=a([1,2,3,4,5]);isReadOnly=a(!1);ratingChange=new w;onChange=()=>{};onTouched=()=>{};writeValue(e){e!==void 0&&this.rating.set(e)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}changeRate(e){this.isReadOnly()||(this.rating.set(e),this.onChange(this.rating()),this.ratingChange.emit(this.rating()),this.onTouched())}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=C({type:r,selectors:[["app-rate"]],inputs:{rating:"rating",stars:"stars",isReadOnly:"isReadOnly"},outputs:{ratingChange:"ratingChange"},standalone:!0,features:[x([{provide:F,useExisting:U(()=>r),multi:!0}]),A],decls:3,vars:0,consts:[[1,"star-rating"],[3,"read-only"],[3,"click"],[1,"star"]],template:function(t,n){t&1&&(l(0,"div",0),_(1,B,3,4,"span",1,E),v()),t&2&&(d(),j(n.stars()))},styles:[".star[_ngcontent-%COMP%]{color:gray;cursor:pointer;font-size:1.5rem}.filled[_ngcontent-%COMP%]{color:gold}.read-only[_ngcontent-%COMP%]{cursor:default}"]})};var M=class r{constructor(e,t){this.http=e;this.toastService=t}apiUrl=`${P.apiUrl}/api/user-opinions`;opinionsUpdatedSource=new f;opinionsUpdated$=this.opinionsUpdatedSource.asObservable();transformOpinion(e){return O(g({},e),{id_opinion:Number(e._id)||0,name:e.name??"",message:e.message??e.content??"",date:e.date??e.createdAt??new Date,rating:e.rating?Number(e.rating):0,validated:!!e.validated,rejected:!!e.rejected})}getUserOpinions(){return this.http.get(`${this.apiUrl}/validated`,{params:{validated:"true",rejected:"false"}}).pipe(o(e=>e.map(this.transformOpinion)),i(e=>{throw console.error("Erreur lors de la r\xE9cup\xE9ration des avis:",e),this.toastService.showError("Impossible de charger les avis utilisateurs"),e}))}addUserOpinions(e){return console.log("Opinion \xE0 envoyer:",e),this.http.post(this.apiUrl,e).pipe(s(t=>{console.log("Avis ajout\xE9 avec succ\xE8s:",t),this.toastService.showSuccess("Votre avis a \xE9t\xE9 ajout\xE9 avec succ\xE8s")}),i(t=>{throw console.error("Erreur lors de l'envoi de l'avis",t),this.toastService.showError("Une erreur est survenue lors de l'envoi de votre avis"),t}))}validateUserOpinions(e){return this.http.patch(`${this.apiUrl}/validate/${e}`,{}).pipe(s(t=>{console.log("Avis valid\xE9 avec succ\xE8s:",t),this.toastService.showSuccess("Avis valid\xE9 avec succ\xE8s"),this.notifyOpinionsUpdated()}),i(t=>(console.error("Erreur lors de la validation de l'avis",t),this.toastService.showError("Une erreur est survenue lors de la validation de l'avis"),p(()=>t))))}getAllUserOpinions(){return this.http.get(`${this.apiUrl}/all`,{params:{sort:"date,desc"}}).pipe(o(e=>e.map(this.transformOpinion)),s(e=>{console.log("Tous les avis r\xE9cup\xE9r\xE9s:",e)}),i(e=>{throw console.error("Erreur lors de la r\xE9cup\xE9ration des avis:",e),this.toastService.showError("Impossible de charger les avis"),e}))}getPendingOpinions(){return this.http.get(`${this.apiUrl}/pending`).pipe(o(e=>e.map(this.transformOpinion)),s(e=>{console.log("Liste finale des avis transform\xE9s:",e)}),i(e=>{throw console.error("Erreur lors de la r\xE9cup\xE9ration des avis:",e),this.toastService.showError("Impossible de charger les avis en attente"),e}))}rejectUserOpinions(e){return this.http.patch(`${this.apiUrl}/reject/${e}`,{}).pipe(s(t=>{console.log("Avis rejet\xE9 avec succ\xE8s:",t),this.notifyOpinionsUpdated()}),i(t=>(console.error("Erreur lors du rejet de l'avis",t),this.toastService.showError("Une erreur est survenue lors du rejet de l'avis"),p(()=>t))))}deleteUserOpinions(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(s(()=>{this.notifyOpinionsUpdated()}))}notifyOpinionsUpdated(){this.opinionsUpdatedSource.next()}static \u0275fac=function(t){return new(t||r)(c(I),c(V))};static \u0275prov=b({token:r,factory:r.\u0275fac,providedIn:"root"})};export{k as a,M as b};
