<div class="bg-white rounded-lg shadow-lg p-6">
  <!-- Formulaire d'ajout de commentaire -->
  <div class="mb-8">
    <h2 class="text-xl font-semibold mb-4 text-tertiary">
      Ajouter un commentaire
    </h2>
    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >État de l'habitat</label
        >
        <select
          [(ngModel)]="newHabitatCommentData.habitat_status"
          class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-tertiary focus:border-tertiary"
        >
          @for (status of statusOptions; track status) {
          <option [value]="status">{{ status }}</option>
          }
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Commentaire</label
        >
        <textarea
          [(ngModel)]="newHabitatCommentData.comment"
          class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-tertiary focus:border-tertiary"
          rows="3"
        ></textarea>
      </div>
      <app-button
        [color]="'tertiary'"
        [text]="'Ajouter le commentaire'"
        (click)="submitComment()"
        [rounded]="true"
      />
    </div>
  </div>

  <!-- Liste des commentaires -->
  <div class="space-y-4">
    <h2 class="text-xl font-semibold mb-4 text-tertiary">
      Historique des commentaires
    </h2>
    @if (habitatsComments().length === 0) {
    <p class="text-gray-500 text-center">Aucun commentaire pour cet habitat</p>
    } @else { @for (comment of habitatsComments(); track comment._id) {
    <div class="border rounded-lg p-4 bg-gray-50">
      <div class="flex justify-between items-start mb-2">
        <div>
          <span class="font-medium">État : </span>
          <span
            [class]="
              comment.habitat_status === 'Optimal'
                ? 'text-green-600'
                : comment.habitat_status === 'Acceptable'
                ? 'text-yellow-600'
                : 'text-red-600'
            "
          >
            {{ comment.habitat_status }}
          </span>
        </div>
        <!-- Ajout du statut résolu/non résolu -->
        <div>
          <span
            [class]="comment.is_resolved ? 'text-green-600' : 'text-red-600'"
          >
            {{ comment.is_resolved ? "Réglé" : "En attente" }}
          </span>
          @if (comment.is_resolved) {
          <p class="text-xs text-gray-500 mt-1">
            Par {{ comment.resolved_by }} le
            {{ comment.resolved_at | date : "dd/MM/yyyy" }}
          </p>
          }
        </div>
      </div>
      <p class="text-gray-700 mb-2">{{ comment.comment }}</p>
      <div class="text-sm text-gray-500">
        <span>Par {{ comment.user_name }}</span>
        <span class="mx-2">•</span>
        <span>{{ comment.createdAt | date : "dd/MM/yyyy HH:mm" }}</span>
      </div>
    </div>
    } }
  </div>
</div>

<app-toast
  *ngIf="isToastVisible()"
  [message]="toastMessage()"
  [type]="toastType()"
/>
