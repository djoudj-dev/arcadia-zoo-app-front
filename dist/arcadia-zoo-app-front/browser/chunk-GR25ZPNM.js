import{a as me}from"./chunk-Q36X3LJI.js";import{b as ce}from"./chunk-ZGZVMIRH.js";import{a as le}from"./chunk-5VXZOEXZ.js";import{a as K}from"./chunk-3PZTUIRH.js";import{c as Z,e as ee,f as te,h as re,j as ie,k as ne,t as oe,v as ae}from"./chunk-XTDWMBHN.js";import{d as Y}from"./chunk-63Q2HYMA.js";import{a as se}from"./chunk-D7JCWFOM.js";import{Db as X,E as f,Ea as O,Gb as G,Ja as c,Ka as S,Pa as I,S as x,Ua as y,V as F,Ya as v,Za as R,_ as P,a as E,ab as C,b as M,ba as H,c as _,db as N,eb as A,ec as J,fb as n,gb as s,hb as h,ib as w,jb as d,kb as m,la as u,lc as Q,ma as p,na as D,o as B,oa as k,oc as T,qb as l,r as q,rb as $,sb as b,vb as L,wb as U,xb as z,zb as W}from"./chunk-OS3QXM5S.js";var V=class a{constructor(t){this.http=t}apiUrl=`${T.apiUrl}/api/admin/service-management`;getAllServices(){return this.http.get(this.apiUrl).pipe(f(this.handleError("r\xE9cup\xE9ration des services")))}getAllFeatures(){return this.http.get(`${this.apiUrl}/features`).pipe(f(this.handleError("r\xE9cup\xE9ration des caract\xE9ristiques")))}createService(t){return console.log("Donn\xE9es envoy\xE9es au serveur:",t),this.http.post(`${this.apiUrl}`,t).pipe(x(()=>console.log("Service cr\xE9\xE9 avec succ\xE8s")),f(e=>(console.log("Erreur d\xE9taill\xE9e:",e.error),this.handleError("cr\xE9ation du service")(e))))}createFeature(t){return this.http.post(`${this.apiUrl}/features`,t).pipe(x(e=>console.log("Caract\xE9ristique cr\xE9\xE9e avec succ\xE8s:",e)),f(this.handleError("cr\xE9ation de la caract\xE9ristique")))}updateService(t,e){return this.http.put(`${this.apiUrl}/${t}`,e).pipe(x(r=>console.log("Service mis \xE0 jour avec succ\xE8s:",r)),f(this.handleError("mise \xE0 jour du service")))}deleteService(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(x(()=>console.log("Service supprim\xE9 avec succ\xE8s")),f(this.handleError("suppression du service")))}clearCache(){console.log("Cache des services effac\xE9")}handleError(t){return e=>(console.error(`Erreur lors de la ${t}:`,e),B(()=>new Error(`Erreur lors de la ${t}`)))}static \u0275fac=function(e){return new(e||a)(P(Q))};static \u0275prov=F({token:a,factory:a.\u0275fac,providedIn:"root"})};var j=class a{MAX_DIMENSION=2048;QUALITY=.8;optimizeImage(t){return _(this,null,function*(){if(!t.type.startsWith("image/"))throw new Error("Le fichier n'est pas une image");try{let e=yield this.loadImage(t),{width:r,height:i}=this.calculateDimensions(e),o=document.createElement("canvas");o.width=r,o.height=i;let g=o.getContext("2d");if(!g)throw new Error("Impossible de cr\xE9er le contexte 2D");g.drawImage(e,0,0,r,i);let pe=yield new Promise(ve=>{o.toBlob(ge=>ve(ge),t.type,this.QUALITY)});return new File([pe],t.name,{type:t.type,lastModified:Date.now()})}catch(e){throw console.error("Erreur lors de l'optimisation de l'image:",e),e}})}loadImage(t){return new Promise((e,r)=>{let i=new Image;i.onload=()=>e(i),i.onerror=r,i.src=URL.createObjectURL(t)})}calculateDimensions(t){let{width:e,height:r}=t;return(e>this.MAX_DIMENSION||r>this.MAX_DIMENSION)&&(e>r?(r=Math.round(r*this.MAX_DIMENSION/e),e=this.MAX_DIMENSION):(e=Math.round(e*this.MAX_DIMENSION/r),r=this.MAX_DIMENSION)),{width:e,height:r}}static \u0275fac=function(e){return new(e||a)};static \u0275prov=F({token:a,factory:a.\u0275fac,providedIn:"root"})};var _e=(a,t)=>t.id_service,Se=(a,t)=>t.id_feature;function we(a,t){if(a&1){let e=w();l(0),X(1,"slice"),n(2,"button",49),d("click",function(){u(e);let i=m().$implicit,o=m();return p(o.toggleDescription(i.id_service))}),l(3," Lire la suite "),s()}if(a&2){let e=m().$implicit;b(" ",G(1,1,e.description,0,100),"... ")}}function be(a,t){if(a&1){let e=w();l(0),n(1,"button",49),d("click",function(){u(e);let i=m().$implicit,o=m();return p(o.toggleDescription(i.id_service))}),l(2," Voir moins "),s()}if(a&2){let e=m().$implicit;b(" ",e.description," ")}}function xe(a,t){if(a&1){let e=w();n(0,"div",48)(1,"p",50),l(2),s(),n(3,"div",51)(4,"button",52),d("click",function(){u(e);let i=m(2);return p(i.deleteServiceConfirmed())}),l(5," Confirmer "),s(),n(6,"button",53),d("click",function(){u(e);let i=m(2);return p(i.cancelDelete())}),l(7," Annuler "),s()()()}if(a&2){let e=m().$implicit;c(2),b(' \xCAtes-vous s\xFBr de vouloir supprimer le service "',e.name,'" ? ')}}function ye(a,t){if(a&1){let e=w();n(0,"div",7)(1,"div",40),h(2,"img",41),n(3,"div",42)(4,"h4",43),l(5),s()()(),n(6,"div",44)(7,"div",30)(8,"p",45),y(9,we,4,5,"button",46)(10,be,3,1,"button",46),s()(),n(11,"div",47)(12,"app-button",3),d("click",function(){let i=u(e).$implicit,o=m();return p(o.editService(i.id_service))})("keydown",function(i){let o=u(e).$implicit,g=m();return p(i.key==="Enter"&&g.editService(o.id_service))}),s(),n(13,"app-button",3),d("click",function(){let i=u(e).$implicit,o=m();return p(o.confirmDeleteService(i.id_service))})("keydown",function(i){let o=u(e).$implicit,g=m();return p(i.key==="Enter"&&g.confirmDeleteService(o.id_service))}),s()(),y(14,xe,8,1,"div",48),s()()}if(a&2){let e=t.$implicit,r=m();c(2),v("src",e.images||"/public/images/img_services/restaurant.webp",O)("alt","Service "+e.name),c(3),$(e.name),c(4),C(e.showFullDescription?10:9),c(3),v("text","Modifier")("type","button")("color","secondary")("rounded",!0)("customClass","px-4 py-2 hover:shadow-lg transition-all duration-300"),c(),v("text","Supprimer")("type","button")("color","red")("rounded",!0)("customClass","px-4 py-2 hover:shadow-lg transition-all duration-300"),c(),C(r.serviceToDelete===e.id_service?14:-1)}}function Ce(a,t){if(a&1){let e=w();n(0,"div",54)(1,"label",55)(2,"input",56),d("change",function(i){let o=u(e).$implicit,g=m(2);return p(g.onFeatureChange(o,i))}),s(),n(3,"span",25),l(4),s()()()}if(a&2){let e=t.$implicit,r=m(2);c(2),v("value",e.id_feature)("checked",r.isFeatureSelected(e)),c(2),$(e.name)}}function Ee(a,t){if(a&1&&(n(0,"div",29),N(1,Ce,5,3,"div",54,Se),s()),a&2){let e=m();c(),A(e.allFeatures())}}function Me(a,t){a&1&&(n(0,"div",34),D(),n(1,"svg",57),h(2,"path",58),s(),k(),n(3,"p",59)(4,"span",60),l(5,"Cliquez pour t\xE9l\xE9charger"),s(),l(6," ou glissez-d\xE9posez "),s(),n(7,"p",61),l(8," PNG, JPG ou WEBP (MAX. 5MB) "),s()())}function Fe(a,t){if(a&1&&h(0,"img",35),a&2){let e=m();v("src",e.newServiceData.images,O)}}var ue=class a{constructor(t,e,r,i,o){this.router=t;this.serviceManagement=e;this.toastService=r;this.fileSecurityService=i;this.imageOptimizer=o}services=I([]);allFeatures=I([]);selectedFile=I(null);serviceToDelete=null;newServiceData={};imageBaseUrl=`${T.apiUrl}/api`;showModal=!1;isFeatureDropdownOpen=!1;ngOnInit(){this.loadServices(),this.loadFeatures()}loadServices(){this.serviceManagement.getAllServices().subscribe({next:t=>{this.services.set(t.map(e=>M(E({},e),{showFullDescription:!1,images:`${this.imageBaseUrl}/${e.images}`})))},error:t=>{console.error("Erreur lors de la r\xE9cup\xE9ration des services:",t),this.toastService.showError("Erreur lors du chargement des services")}})}loadFeatures(){this.serviceManagement.getAllFeatures().subscribe({next:t=>{this.allFeatures.set(t)},error:t=>{console.error("Erreur lors de la r\xE9cup\xE9ration des caract\xE9ristiques:",t),this.toastService.showError("Erreur lors du chargement des caract\xE9ristiques")}})}onFileSelected(t){return _(this,null,function*(){try{let e=yield this.fileSecurityService.validateFile(t);if(!e.isValid){this.toastService.showError(e.errors.join(`
`));return}this.selectedFile.set(t);let r=new FileReader;r.onload=()=>{this.newServiceData.images=r.result,this.toastService.showSuccess("Image s\xE9lectionn\xE9e avec succ\xE8s")},r.readAsDataURL(t)}catch(e){console.error("Erreur lors du traitement du fichier:",e),this.toastService.showError("Erreur lors du traitement du fichier")}})}onFileChange(t){return _(this,null,function*(){let e=t.target.files?.[0];if(e)try{let r=yield this.fileSecurityService.validateFile(e);if(!r.isValid){this.toastService.showError(r.errors.join(`
`));return}this.selectedFile.set(e);let i=new FileReader;i.onload=()=>{this.newServiceData.images=i.result},i.readAsDataURL(e),this.toastService.showSuccess("Image s\xE9lectionn\xE9e avec succ\xE8s")}catch(r){console.error("Erreur lors du traitement du fichier:",r),this.toastService.showError("Erreur lors du traitement du fichier")}})}createService(){return _(this,null,function*(){try{let t=this.buildFormData();yield q(this.serviceManagement.createService(t)),this.toastService.showSuccess("Service cr\xE9\xE9 avec succ\xE8s !"),this.toggleModal(),this.resetForm(),this.loadServices()}catch{this.toastService.showError("Erreur lors de la cr\xE9ation du service")}})}updateService(){if(!this.validateServiceData(!0)){this.toastService.showError("Veuillez remplir tous les champs requis");return}let t=this.buildFormData();this.serviceManagement.updateService(this.newServiceData.id_service,t).subscribe({next:()=>{this.loadServices(),this.resetForm(),this.toastService.showSuccess("Service mis \xE0 jour avec succ\xE8s")},error:e=>{console.error("Erreur lors de la mise \xE0 jour du service:",e),this.toastService.showError("Erreur lors de la mise \xE0 jour du service")}})}editService(t){let e=this.services().find(r=>r.id_service===t);e&&(this.newServiceData=M(E({},e),{features:e.features||[]}),this.showModal=!0,this.toastService.showSuccess("Service s\xE9lectionn\xE9 pour modification"))}deleteService(t){if(!t){this.toastService.showError("ID de service invalide");return}this.serviceManagement.deleteService(t).subscribe({next:()=>{this.services.update(e=>e.filter(r=>r.id_service!==t)),this.toastService.showSuccess("Service supprim\xE9 avec succ\xE8s")},error:e=>{console.error("Erreur lors de la suppression du service:",e),this.toastService.showError("Erreur lors de la suppression du service")}})}resetForm(){this.newServiceData={name:"",description:"",features:[],images:""},this.selectedFile.set(null)}toggleDescription(t){this.services.update(e=>e.map(r=>r.id_service===t?M(E({},r),{showFullDescription:!r.showFullDescription}):r))}isFeatureSelected(t){return!!this.newServiceData.features?.some(e=>e.id_feature===t.id_feature)}onFeatureChange(t,e){let r=e.target.checked;this.newServiceData.features=r?[...this.newServiceData.features||[],t]:this.newServiceData.features?.filter(i=>i.id_feature!==t.id_feature)}goBack(){this.router.navigate(["/admin"])}openNewServiceModal(){this.resetForm(),this.showModal=!0}toggleModal(){this.showModal=!this.showModal,this.showModal||this.resetForm()}toggleFeatureDropdown(){this.isFeatureDropdownOpen=!this.isFeatureDropdownOpen}validateServiceData(t=!1){let{name:e,description:r,features:i}=this.newServiceData,o=this.selectedFile()||t||this.newServiceData.images;return!!(e&&r&&i&&o)}buildFormData(){let t=new FormData,e=this.newServiceData;Object.entries(e).forEach(([i,o])=>{o!=null&&(i==="features"?t.append(i,JSON.stringify(o)):t.append(i,o.toString()))});let r=this.selectedFile();if(r){let i=this.fileSecurityService.sanitizeFileName(r.name);t.append("image",r,i)}return t}confirmDeleteService(t){this.serviceToDelete=t}cancelDelete(){this.serviceToDelete=null}deleteServiceConfirmed(){this.serviceToDelete!==null&&(this.deleteService(this.serviceToDelete),this.serviceToDelete=null)}static \u0275fac=function(e){return new(e||a)(S(Y),S(V),S(K),S(me),S(j))};static \u0275cmp=H({type:a,selectors:[["app-service-management"]],standalone:!0,features:[W],decls:52,vars:22,consts:[["aria-labelledby","serviceManagementTitle",1,"service-management","mb-8","sm:mb-12","px-4","sm:px-6","py-6","bg-secondary","rounded-lg","shadow-xl","shadow-tertiary"],["id","serviceManagementTitle",1,"text-xl","sm:text-2xl","font-semibold","mb-6","sm:mb-8","text-center"],[1,"flex","justify-end","mb-4"],[3,"click","keydown","text","type","color","rounded","customClass"],[1,"bg-gray-100","p-4","sm:p-6","rounded-lg","shadow-sm"],[1,"text-lg","sm:text-xl","font-semibold","mb-6","text-center","text-gray-800"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[1,"bg-white","rounded-xl","shadow-lg","overflow-hidden","transform","transition-all","duration-300","hover:shadow-2xl","hover:-translate-y-1","relative"],[3,"close","isOpen"],[1,"bg-tertiary","px-6","py-4","rounded-t-lg"],[1,"flex","items-center","justify-between"],[1,"text-xl","font-semibold","text-white"],[1,"text-white","hover:text-gray-200","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6","bg-white","rounded-b-lg"],["enctype","multipart/form-data",3,"ngSubmit"],[1,"space-y-6"],["for","serviceName",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","serviceName","type","text","name","name","required","","placeholder","Entrez le nom du service",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent","transition-all","duration-200",3,"ngModelChange","ngModel"],["for","serviceDescription",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","serviceDescription","name","description","required","","rows","4","placeholder","D\xE9crivez le service",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent","transition-all","duration-200","resize-none",3,"ngModelChange","ngModel"],[1,"relative"],["for","serviceFeatures",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","serviceFeatures","type","button",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","bg-white","text-left","flex","justify-between","items-center","hover:border-tertiary","transition-colors","duration-200",3,"click"],[1,"text-gray-700"],[1,"transform","transition-transform","duration-200"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-gray-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"absolute","z-20","w-full","mt-2","bg-white","border","border-gray-200","rounded-lg","shadow-lg","max-h-60","overflow-y-auto"],[1,"mb-4"],["for","serviceImage",1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"flex","items-center","justify-center","w-full"],[1,"flex","flex-col","items-center","justify-center","w-full","h-64","border-2","border-gray-300","border-dashed","rounded-lg","cursor-pointer","bg-gray-50","hover:bg-gray-100","transition-all","duration-300"],[1,"flex","flex-col","items-center","justify-center","pt-5","pb-6"],["alt","Aper\xE7u",1,"w-full","h-full","object-cover","rounded-lg",3,"src"],["id","serviceImage","type","file","accept","image/*",1,"hidden",3,"change"],[1,"flex","space-x-3","mt-8"],[1,"flex-1",3,"text","type","color","rounded"],[1,"flex-1",3,"click","keydown","text","type","color","rounded"],[1,"relative","h-48","overflow-hidden"],[1,"w-full","h-full","object-cover",3,"src","alt"],[1,"absolute","bottom-0","left-0","right-0","bg-gradient-to-t","from-black/70","to-transparent","p-4"],[1,"text-lg","font-semibold","text-white"],[1,"p-4"],[1,"text-sm","text-gray-600"],[1,"text-tertiary","hover:text-quaternary","font-medium","ml-1"],[1,"flex","justify-end","space-x-2","mt-4"],[1,"mt-4","bg-red-50","border","border-red-200","rounded-lg","p-4","shadow-sm"],[1,"text-tertiary","hover:text-quaternary","font-medium","ml-1",3,"click"],[1,"text-red-700","mb-3"],[1,"flex","justify-end","gap-3"],[1,"px-4","py-2","bg-red-600","text-white","rounded-lg","hover:bg-red-700","transition-colors","duration-300",3,"click"],[1,"px-4","py-2","bg-gray-100","text-gray-700","rounded-lg","hover:bg-gray-200","transition-colors","duration-300",3,"click"],[1,"p-3","hover:bg-gray-50","transition-colors","duration-150"],[1,"flex","items-center","space-x-3","cursor-pointer"],["type","checkbox",1,"w-4","h-4","text-tertiary","border-gray-300","rounded","focus:ring-tertiary",3,"change","value","checked"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 20 16",1,"w-8","h-8","mb-4","text-gray-500"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"],[1,"mb-2","text-sm","text-gray-500"],[1,"font-semibold"],[1,"text-xs","text-gray-500"]],template:function(e,r){e&1&&(n(0,"main",0)(1,"h2",1),l(2," Gestion des services "),s(),h(3,"app-toast"),n(4,"div",2)(5,"app-button",3),d("click",function(){return r.openNewServiceModal()})("keydown",function(o){return o.key==="Enter"&&r.openNewServiceModal()}),s()(),n(6,"div",4)(7,"h3",5),l(8," Liste des services "),s(),n(9,"div",6),N(10,ye,15,15,"div",7,_e),s()(),n(12,"app-modal",8),d("close",function(){return r.toggleModal()}),n(13,"div",9)(14,"div",10)(15,"h3",11),l(16),s(),n(17,"button",12),d("click",function(){return r.toggleModal()}),D(),n(18,"svg",13),h(19,"path",14),s()()()(),k(),n(20,"div",15)(21,"form",16),d("ngSubmit",function(){return r.newServiceData.id_service?r.updateService():r.createService()}),n(22,"div",17)(23,"div")(24,"label",18),l(25," Nom du service "),s(),n(26,"input",19),z("ngModelChange",function(o){return U(r.newServiceData.name,o)||(r.newServiceData.name=o),o}),s()(),n(27,"div")(28,"label",20),l(29," Description "),s(),n(30,"textarea",21),z("ngModelChange",function(o){return U(r.newServiceData.description,o)||(r.newServiceData.description=o),o}),s()(),n(31,"div",22)(32,"label",23),l(33," Caract\xE9ristiques "),s(),n(34,"button",24),d("click",function(){return r.toggleFeatureDropdown()}),n(35,"span",25),l(36),s(),n(37,"span",26),D(),n(38,"svg",27),h(39,"path",28),s()()(),y(40,Ee,3,0,"div",29),s(),k(),n(41,"div",30)(42,"label",31),l(43," Image du service "),s(),n(44,"div",32)(45,"label",33),y(46,Me,9,0,"div",34)(47,Fe,1,1,"img",35),n(48,"input",36),d("change",function(o){return r.onFileChange(o)}),s()()()()(),n(49,"div",37),h(50,"app-button",38),n(51,"app-button",39),d("click",function(){return r.toggleModal()})("keydown",function(o){return o.key==="Enter"&&r.toggleModal()}),s()()()()()()),e&2&&(c(5),v("text","Ajouter un service")("type","button")("color","tertiary")("rounded",!0)("customClass","px-4 py-2 hover:shadow-lg transition-all duration-300"),c(5),A(r.services()),c(2),v("isOpen",r.showModal),c(4),b(" ",r.newServiceData.id_service?"Modifier le service":"Cr\xE9er un service"," "),c(10),L("ngModel",r.newServiceData.name),c(4),L("ngModel",r.newServiceData.description),c(6),b(" ",r.isFeatureDropdownOpen?"Fermer la s\xE9lection":"S\xE9lectionner les caract\xE9ristiques"," "),c(),R("rotate-180",r.isFeatureDropdownOpen),c(3),C(r.isFeatureDropdownOpen?40:-1),c(6),C(r.newServiceData.images?47:46),c(4),v("text",r.newServiceData.id_service?"Modifier":"Cr\xE9er")("type","submit")("color","tertiary")("rounded",!0),c(),v("text","Annuler")("type","button")("color","secondary")("rounded",!0))},dependencies:[ae,ne,Z,ee,te,oe,ie,re,J,ce,se,le],encapsulation:2})};export{ue as a};
