import{W as m,c as o}from"./chunk-TKCV3HAR.js";var I=class a{CONFIG={MAX_DIMENSION:2048,QUALITY:.8,MIN_DIMENSION:100};optimizeImage(i){return o(this,null,function*(){if(!i.type.startsWith("image/"))throw new Error("Format de fichier invalide");try{let e=yield this.loadImage(i),t=yield this.processImage(e,i.type);return new File([t],this.sanitizeFileName(i.name),{type:i.type,lastModified:Date.now()})}catch(e){throw new Error(`\xC9chec de l'optimisation: ${e instanceof Error?e.message:"Erreur inconnue"}`)}})}processImage(i,e){return o(this,null,function*(){let{width:t,height:n}=this.calculateDimensions(i),r=document.createElement("canvas"),s=r.getContext("2d");if(!s)throw new Error("Contexte 2D non disponible");return r.width=t,r.height=n,s.drawImage(i,0,0,t,n),yield new Promise((h,l)=>{r.toBlob(c=>c?h(c):l(new Error("\xC9chec de conversion")),e,this.CONFIG.QUALITY)})})}sanitizeFileName(i){let t=i.toLowerCase().replace(/[^a-z0-9.]/g,"-").replace(/-+/g,"-").split(".").pop();return`${`${Date.now()}-${Math.random().toString(36).substring(2,11)}`}.${t}`}loadImage(i){return new Promise((e,t)=>{let n=new Image;n.onload=()=>e(n),n.onerror=t,n.src=URL.createObjectURL(i)})}calculateDimensions(i){let{width:e,height:t}=i;return(e>this.CONFIG.MAX_DIMENSION||t>this.CONFIG.MAX_DIMENSION)&&(e>t?(t=Math.round(t*this.CONFIG.MAX_DIMENSION/e),e=this.CONFIG.MAX_DIMENSION):(e=Math.round(e*this.CONFIG.MAX_DIMENSION/t),t=this.CONFIG.MAX_DIMENSION)),{width:e,height:t}}static \u0275fac=function(e){return new(e||a)};static \u0275prov=m({token:a,factory:a.\u0275fac,providedIn:"root"})};export{I as a};
