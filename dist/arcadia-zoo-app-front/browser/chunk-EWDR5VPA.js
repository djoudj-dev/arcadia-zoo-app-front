import{a as te}from"./chunk-ZKKSB4BP.js";import{a as ee}from"./chunk-DRNBQNPL.js";import{a as L}from"./chunk-VV7GXU3B.js";import{e as B}from"./chunk-OTF63C3I.js";import{a as Z}from"./chunk-M6XTAS6A.js";import{c as W,e as P,f as G,h as J,j as K,k as Q,s as X,u as Y}from"./chunk-IVPOVWWL.js";import{H as d,Hb as l,Ib as R,Jb as E,Ma as V,Mb as D,Nb as C,Nc as H,Ob as M,Qb as A,Qc as x,Sa as c,Ta as h,X as f,_ as I,_a as b,a as g,b as w,d as _,da as j,db as $,hb as S,ia as O,mb as N,pb as U,q as k,qb as q,rb as o,sa as m,sb as a,t as T,ta as u,tb as z,xb as F,yb as p,zb as v}from"./chunk-RMHEMJYH.js";var y=class s{constructor(t){this.http=t}apiUrl=`${x.apiUrl}/api/admin/service-management`;getAllServices(){return this.http.get(this.apiUrl).pipe(d(this.handleError("r\xE9cup\xE9ration des services")))}getAllFeatures(){return this.http.get(`${this.apiUrl}/features`).pipe(d(this.handleError("r\xE9cup\xE9ration des caract\xE9ristiques")))}createService(t){return console.log("Donn\xE9es envoy\xE9es au serveur:",t),this.http.post(`${this.apiUrl}`,t).pipe(f(()=>console.log("Service cr\xE9\xE9 avec succ\xE8s")),d(e=>(console.log("Erreur d\xE9taill\xE9e:",e.error),this.handleError("cr\xE9ation du service")(e))))}createFeature(t){return this.http.post(`${this.apiUrl}/features`,t).pipe(f(e=>console.log("Caract\xE9ristique cr\xE9\xE9e avec succ\xE8s:",e)),d(this.handleError("cr\xE9ation de la caract\xE9ristique")))}updateService(t,e){return this.http.put(`${this.apiUrl}/${t}`,e).pipe(f(r=>console.log("Service mis \xE0 jour avec succ\xE8s:",r)),d(this.handleError("mise \xE0 jour du service")))}deleteService(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(f(()=>console.log("Service supprim\xE9 avec succ\xE8s")),d(this.handleError("suppression du service")))}clearCache(){console.log("Cache des services effac\xE9")}handleError(t){return e=>(console.error(`Erreur lors de la ${t}:`,e),k(()=>new Error(`Erreur lors de la ${t}`)))}static \u0275fac=function(e){return new(e||s)(j(H))};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};var oe=(s,t)=>t.id_service;function ae(s,t){if(s&1){let e=F();o(0,"div",6)(1,"div",19),z(2,"img",20),o(3,"div",21)(4,"h3",22),l(5),a()()(),o(6,"div",23)(7,"p",24),l(8),a(),o(9,"div",25)(10,"app-button",26),p("click",function(){let i=m(e).$implicit,n=v();return u(n.editService(i.id_service))})("keydown",function(){let i=m(e).$implicit,n=v();return u(n.editService(i.id_service))}),a(),o(11,"app-button",26),p("click",function(){let i=m(e).$implicit,n=v();return u(n.confirmDeleteService(i.id_service))})("keydown",function(){let i=m(e).$implicit,n=v();return u(n.confirmDeleteService(i.id_service))}),a()()()()}if(s&2){let e=t.$implicit;c(2),S("src",e.images,V)("alt",e.name),c(3),R(e.name),c(3),E(" ",e.description," "),c(2),S("text","Modifier")("color","tertiary")("rounded",!0)("customClass","px-6 min-w-[120px] text-lg font-medium"),c(),S("text","Supprimer")("color","danger")("rounded",!0)("customClass","px-6 min-w-[120px] text-lg font-medium")}}function se(s,t){if(s&1){let e=F();o(0,"app-button",27),p("click",function(){m(e);let i=v();return u(i.cancelEdit())})("keydown",function(){m(e);let i=v();return u(i.cancelEdit())}),a()}s&2&&S("text","Annuler")("color","secondary")("rounded",!0)("customClass","px-6 min-w-[120px] text-lg font-medium")}var re=class s{constructor(t,e,r,i,n){this.router=t;this.serviceManagement=e;this.toastService=r;this.imageOptimizer=i;this.fileSecurityService=n}services=b([]);allFeatures=b([]);selectedFile=b(null);serviceToDelete=null;newServiceData={};imageBaseUrl=`${x.apiUrl}/api`;showModal=!1;isFeatureDropdownOpen=!1;ngOnInit(){this.loadServices(),this.loadFeatures()}loadServices(){this.serviceManagement.getAllServices().subscribe({next:t=>{this.services.set(t.map(e=>w(g({},e),{showFullDescription:!1,images:`${this.imageBaseUrl}/${e.images}`})))},error:t=>{console.error("Erreur lors de la r\xE9cup\xE9ration des services:",t),this.toastService.showError("Erreur lors du chargement des services")}})}loadFeatures(){this.serviceManagement.getAllFeatures().subscribe({next:t=>{this.allFeatures.set(t)},error:t=>{console.error("Erreur lors de la r\xE9cup\xE9ration des caract\xE9ristiques:",t),this.toastService.showError("Erreur lors du chargement des caract\xE9ristiques")}})}onFileSelected(t){return _(this,null,function*(){try{let e=yield this.fileSecurityService.scan(t);if(!e.isSafe){this.toastService.showError(e.threats.join(`
`));return}this.selectedFile.set(t);let r=new FileReader;r.onload=()=>{this.newServiceData.images=r.result,this.toastService.showSuccess("Image s\xE9lectionn\xE9e avec succ\xE8s")},r.readAsDataURL(t)}catch(e){console.error("Erreur lors du traitement du fichier:",e),this.toastService.showError("Erreur lors du traitement du fichier")}})}onFileChange(t){return _(this,null,function*(){let e=t.target.files?.[0];if(e)try{let r=yield this.fileSecurityService.scan(e);if(!r.isSafe){this.toastService.showError(r.threats.join(`
`));return}this.selectedFile.set(e);let i=new FileReader;i.onload=()=>{this.newServiceData.images=i.result},i.readAsDataURL(e),this.toastService.showSuccess("Image s\xE9lectionn\xE9e avec succ\xE8s")}catch(r){console.error("Erreur lors du traitement du fichier:",r),this.toastService.showError("Erreur lors du traitement du fichier")}})}createService(){return _(this,null,function*(){try{let t=this.buildFormData();yield T(this.serviceManagement.createService(t)),this.toastService.showSuccess("Service cr\xE9\xE9 avec succ\xE8s !"),this.toggleModal(),this.resetForm(),this.loadServices()}catch{this.toastService.showError("Erreur lors de la cr\xE9ation du service")}})}updateService(){if(!this.validateServiceData(!0)){this.toastService.showError("Veuillez remplir tous les champs requis");return}let t=this.buildFormData();this.serviceManagement.updateService(this.newServiceData.id_service,t).subscribe({next:()=>{this.loadServices(),this.resetForm(),this.toastService.showSuccess("Service mis \xE0 jour avec succ\xE8s")},error:e=>{console.error("Erreur lors de la mise \xE0 jour du service:",e),this.toastService.showError("Erreur lors de la mise \xE0 jour du service")}})}editService(t){let e=this.services().find(r=>r.id_service===t);e&&(this.newServiceData=w(g({},e),{features:e.features||[]}),this.showModal=!0,this.toastService.showSuccess("Service s\xE9lectionn\xE9 pour modification"))}deleteService(t){if(!t){this.toastService.showError("ID de service invalide");return}this.serviceManagement.deleteService(t).subscribe({next:()=>{this.services.update(e=>e.filter(r=>r.id_service!==t)),this.toastService.showSuccess("Service supprim\xE9 avec succ\xE8s")},error:e=>{console.error("Erreur lors de la suppression du service:",e),this.toastService.showError("Erreur lors de la suppression du service")}})}resetForm(){this.newServiceData={name:"",description:"",features:[],images:""},this.selectedFile.set(null)}toggleDescription(t){this.services.update(e=>e.map(r=>r.id_service===t?w(g({},r),{showFullDescription:!r.showFullDescription}):r))}isFeatureSelected(t){return!!this.newServiceData.features?.some(e=>e.id_feature===t.id_feature)}onFeatureChange(t,e){let r=e.target.checked;this.newServiceData.features=r?[...this.newServiceData.features||[],t]:this.newServiceData.features?.filter(i=>i.id_feature!==t.id_feature)}goBack(){this.router.navigate(["/admin"])}openNewServiceModal(){this.resetForm(),this.showModal=!0}toggleModal(){this.showModal=!this.showModal,this.showModal||this.resetForm()}toggleFeatureDropdown(){this.isFeatureDropdownOpen=!this.isFeatureDropdownOpen}validateServiceData(t=!1){let{name:e,description:r,features:i}=this.newServiceData,n=this.selectedFile()||t||this.newServiceData.images;return!!(e&&r&&i&&n)}buildFormData(){let t=new FormData,e=this.newServiceData;Object.entries(e).forEach(([i,n])=>{n!=null&&(i==="features"?t.append(i,JSON.stringify(n)):t.append(i,n.toString()))});let r=this.selectedFile();if(r){let i=this.imageOptimizer.sanitizeFileName(r.name);t.append("image",r,i)}return t}confirmDeleteService(t){this.serviceToDelete=t}cancelDelete(){this.serviceToDelete=null}deleteServiceConfirmed(){this.serviceToDelete!==null&&(this.deleteService(this.serviceToDelete),this.serviceToDelete=null)}cancelEdit(){this.resetForm(),this.toastService.showSuccess("Modification annul\xE9e")}static \u0275fac=function(e){return new(e||s)(h(B),h(y),h(L),h(te),h(ee))};static \u0275cmp=O({type:s,selectors:[["app-service-management"]],standalone:!0,features:[A],decls:29,vars:8,consts:[[1,"w-full","bg-gradient-to-b","from-secondary","to-primary","shadow-lg","py-8"],[1,"container","mx-auto","px-4"],[1,"text-center","space-y-4","mb-12"],[1,"text-3xl","md:text-5xl","lg:text-6xl","font-serif","font-bold","text-quinary"],[1,"text-lg","md:text-xl","text-tertiary","font-serif","italic","max-w-4xl","mx-auto"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6","mb-12"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","overflow-hidden"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-6"],[1,"text-2xl","font-serif","font-semibold","text-tertiary","mb-6"],["enctype","multipart/form-data",1,"space-y-6",3,"ngSubmit"],["for","name",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["type","text","id","name","name","name","required","","placeholder","Nom du service",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent",3,"ngModelChange","ngModel"],["for","description",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["id","description","name","description","required","","rows","4","placeholder","Description du service",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent",3,"ngModelChange","ngModel"],["for","image",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["type","file","id","image","accept","image/*",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent",3,"change"],[1,"flex","justify-end","space-x-4"],["type","button",3,"text","color","rounded","customClass"],["type","submit",3,"keydown","text","color","rounded","customClass"],[1,"relative","h-48"],[1,"w-full","h-full","object-cover",3,"src","alt"],[1,"absolute","bottom-0","left-0","right-0","bg-black/50","p-4"],[1,"text-white","font-serif","text-xl"],[1,"p-4"],[1,"text-gray-600","mb-4","line-clamp-3"],[1,"flex","justify-end","space-x-2"],[3,"click","keydown","text","color","rounded","customClass"],["type","button",3,"click","keydown","text","color","rounded","customClass"]],template:function(e,r){e&1&&(o(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),l(4," Gestion des Services "),a(),o(5,"p",4),l(6," G\xE9rez les services du zoo "),a()(),o(7,"div",5),U(8,ae,12,12,"div",6,oe),a(),o(10,"div",7)(11,"h3",8),l(12),a(),o(13,"form",9),p("ngSubmit",function(){return r.newServiceData.id_service?r.updateService():r.createService()}),o(14,"div")(15,"label",10),l(16," Nom du service "),a(),o(17,"input",11),M("ngModelChange",function(n){return C(r.newServiceData.name,n)||(r.newServiceData.name=n),n}),a()(),o(18,"div")(19,"label",12),l(20," Description "),a(),o(21,"textarea",13),M("ngModelChange",function(n){return C(r.newServiceData.description,n)||(r.newServiceData.description=n),n}),a()(),o(22,"div")(23,"label",14),l(24," Image "),a(),o(25,"input",15),p("change",function(n){return r.onFileChange(n)}),a()(),o(26,"div",16),$(27,se,1,4,"app-button",17),o(28,"app-button",18),p("keydown",function(n){return n.key==="Enter"&&(r.newServiceData.id_service?r.updateService():r.createService())}),a()()()()()()),e&2&&(c(8),q(r.services()),c(4),E(" ",r.newServiceData.id_service?"Modifier le service":"Ajouter un service"," "),c(5),D("ngModel",r.newServiceData.name),c(4),D("ngModel",r.newServiceData.description),c(6),N(r.newServiceData.id_service?27:-1),c(),S("text",r.newServiceData.id_service?"Mettre \xE0 jour":"Cr\xE9er")("color","tertiary")("rounded",!0)("customClass","px-6 min-w-[120px] text-lg font-medium"))},dependencies:[Y,Q,W,P,G,X,K,J,Z],encapsulation:2})};export{re as a};
