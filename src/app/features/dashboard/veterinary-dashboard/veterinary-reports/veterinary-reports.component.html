<div class="max-w-xl mx-auto">
  <!-- Navigation -->
  <div class="flex gap-2 mb-6">
    <app-button
      [text]="'Historique des repas'"
      [color]="activeTab() === 'feeding' ? 'tertiary' : 'secondary'"
      (click)="activeTab.set('feeding')"
      (keydown)="activeTab.set('feeding')"
      [customClass]="'flex-1 py-2 px-4 rounded-lg text-sm font-medium'"
    />
    <app-button
      [text]="'Rapports vétérinaires'"
      [color]="activeTab() === 'veterinary' ? 'tertiary' : 'secondary'"
      (click)="activeTab.set('veterinary')"
      (keydown)="activeTab.set('veterinary')"
      [customClass]="'flex-1 py-2 px-4 rounded-lg text-sm font-medium'"
    />
    <app-button
      [text]="'Nouveau Rapport'"
      [color]="activeTab() === 'new' ? 'tertiary' : 'secondary'"
      (click)="activeTab.set('new')"
      (keydown)="activeTab.set('new')"
      [customClass]="'flex-1 py-2 px-4 rounded-lg text-sm font-medium'"
    />
  </div>

  <!-- Contenu -->
  <div class="bg-white p-4 rounded-lg shadow-sm">
    <!-- Historique des repas -->
    @if (activeTab() === 'feeding') {
    <div class="space-y-3">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">
        Historique des repas
      </h2>
      @for (meal of feedingHistory(); track meal.id) {
      <div class="p-3 bg-gray-50 rounded-lg">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-sm text-gray-600">
              {{ meal.date | date : "dd/MM/yyyy HH:mm" }}
            </p>
            <p class="font-medium">
              {{ meal.food_type }} - {{ meal.quantity }}{{ meal.unit }}
            </p>
          </div>
        </div>
        @if (meal.notes) {
        <p class="mt-1 text-sm text-gray-600">{{ meal.notes }}</p>
        }
      </div>
      }
    </div>
    }

    <!-- Rapports vétérinaires -->
    @if (activeTab() === 'veterinary') {
    <div class="space-y-3">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">
        Rapports vétérinaires
      </h2>
      @for (report of veterinaryReports(); track report._id) {
      <div class="p-3 bg-gray-50 rounded-lg">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-sm text-gray-600">
              {{ report.visit_date | date : "dd/MM/yyyy HH:mm" }}
            </p>
            <p class="font-medium">Dr. {{ report.user_name }}</p>
          </div>
          <span [class]="getStateClass(report.animal_state)">
            {{ report.animal_state }}
          </span>
        </div>
        <p class="mt-2 text-sm font-medium">
          Alimentation recommandée: {{ report.recommended_food_type }} -
          {{ report.recommended_food_quantity }}{{ report.food_unit }}
        </p>
        @if (report.additional_details) {
        <p class="mt-1 text-sm text-gray-600 italic">
          "{{ report.additional_details }}"
        </p>
        }
      </div>
      }
    </div>
    }

    <!-- Nouveau rapport -->
    @if (activeTab() === 'new') {
    <div>
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Nouveau Rapport</h2>
      <form [formGroup]="reportForm" class="space-y-3">
        <div>
          <label
            for="animal-name"
            class="block text-sm font-medium text-gray-700"
            >Animal</label
          >
          <div id="animal-name" class="text-gray-900">
            {{ reportForm.get("animal_name")?.value }}
          </div>
        </div>

        <div>
          <label
            for="health-state"
            class="block text-sm font-medium text-gray-700"
            >État de santé de l'animal</label
          >
          <select
            id="health-state"
            [ngModel]="selectedState()"
            (ngModelChange)="selectedState.set($event)"
            (change)="updateHealthState()"
            class="w-full p-2 border border-gray-300 rounded-md text-sm"
          >
            <option [value]="AnimalState.GOOD_HEALTH">Bonne santé</option>
            <option [value]="AnimalState.INJURED">Blessé</option>
            <option [value]="AnimalState.SICK">Malade</option>
          </select>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div>
            <label
              for="visit-date"
              class="block text-sm font-medium text-gray-700"
              >Date de visite</label
            >
            <input
              id="visit-date"
              type="date"
              formControlName="visit_date"
              class="w-full p-2 border border-gray-300 rounded-md text-sm"
            />
          </div>
          <div>
            <label
              for="animal-state"
              class="block text-sm font-medium text-gray-700"
              >État de santé</label
            >
            <select
              id="animal-state"
              formControlName="animal_state"
              class="w-full p-2 border border-gray-300 rounded-md text-sm"
            >
              <option value="">Choisir un état</option>
              <option *ngFor="let state of animalStates" [value]="state">
                {{ state }}
              </option>
            </select>
          </div>
        </div>

        <div>
          <h3 class="text-sm font-medium text-gray-700 mb-2">
            Recommandations alimentaires
          </h3>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label
                for="food-type"
                class="block text-sm font-medium text-gray-700"
                >Type d'alimentation</label
              >
              <input
                id="food-type"
                type="text"
                formControlName="recommended_food_type"
                placeholder="Type d'alimentation"
                class="w-full p-2 border border-gray-300 rounded-md text-sm"
              />
            </div>
            <div class="flex gap-2">
              <div class="w-2/3">
                <label
                  for="food-quantity"
                  class="block text-sm font-medium text-gray-700"
                  >Quantité</label
                >
                <input
                  id="food-quantity"
                  type="number"
                  formControlName="recommended_food_quantity"
                  placeholder="Quantité"
                  class="w-full p-2 border border-gray-300 rounded-md text-sm"
                />
              </div>
              <div class="w-1/3">
                <label
                  for="food-unit"
                  class="block text-sm font-medium text-gray-700"
                  >Unité</label
                >
                <select
                  id="food-unit"
                  formControlName="food_unit"
                  class="w-full p-2 border border-gray-300 rounded-md text-sm"
                >
                  <option value="">Unité</option>
                  <option *ngFor="let unit of foodUnits" [value]="unit">
                    {{ unit }}
                  </option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div>
          <label
            for="observations"
            class="block text-sm font-medium text-gray-700"
            >Observations</label
          >
          <textarea
            id="observations"
            formControlName="additional_details"
            rows="2"
            class="w-full p-2 border border-gray-300 rounded-md text-sm"
            placeholder="Ajoutez des observations complémentaires..."
          ></textarea>
        </div>

        <div class="flex justify-end gap-2 pt-2">
          <button
            type="button"
            (click)="closeModal()"
            class="px-3 py-1.5 text-sm text-gray-600 hover:text-gray-800"
          >
            Annuler
          </button>
          <button
            type="submit"
            class="px-3 py-1.5 text-sm bg-green-600 text-white rounded-md hover:bg-green-700"
          >
            Enregistrer
          </button>
        </div>
      </form>
    </div>
    }
  </div>
</div>

<!-- Style pour les inputs -->
<style>
  input::placeholder,
  textarea::placeholder {
    color: rgba(85, 122, 70, 0.4);
  }

  input:focus::placeholder,
  textarea:focus::placeholder {
    color: rgba(85, 122, 70, 0.6);
  }

  select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23557A46'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
    background-position: right 0.5rem center;
    background-repeat: no-repeat;
    background-size: 1.5em 1.5em;
    padding-right: 2.5rem;
  }
</style>
