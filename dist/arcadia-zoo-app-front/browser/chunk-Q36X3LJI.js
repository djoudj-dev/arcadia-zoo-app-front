import{V as s,c as a}from"./chunk-OS3QXM5S.js";var o=class n{ALLOWED_MIME_TYPES=["image/jpeg","image/png","image/webp","image/gif"];MAX_FILE_SIZE=5*1024*1024;MAX_IMAGE_DIMENSIONS={width:4096,height:4096};validateFile(i){return a(this,null,function*(){let e=[];this.ALLOWED_MIME_TYPES.includes(i.type)||e.push("Type de fichier non autoris\xE9. Formats accept\xE9s : JPG, PNG, WebP, GIF"),i.size>this.MAX_FILE_SIZE&&e.push("Le fichier est trop volumineux (maximum 5MB)");try{let t=yield this.getImageDimensions(i);(t.width>this.MAX_IMAGE_DIMENSIONS.width||t.height>this.MAX_IMAGE_DIMENSIONS.height)&&e.push(`Les dimensions de l'image sont trop grandes (max ${this.MAX_IMAGE_DIMENSIONS.width}x${this.MAX_IMAGE_DIMENSIONS.height})`)}catch(t){e.push("Format d'image invalide : "+t.message)}try{(yield this.validateImageContent(i))||e.push("Le contenu du fichier est invalide")}catch(t){e.push(`Impossible de valider le contenu du fichier : ${t.message}`)}return{isValid:e.length===0,errors:e}})}sanitizeFileName(i){return i.replace(/[^a-zA-Z0-9.-]/g,"_").replace(/\.{2,}/g,".").substring(0,255)}getImageDimensions(i){return new Promise((e,t)=>{let r=new Image;r.onload=()=>{URL.revokeObjectURL(r.src),e({width:r.width,height:r.height})},r.onerror=()=>{URL.revokeObjectURL(r.src),t(new Error("Image invalide"))},r.src=URL.createObjectURL(i)})}validateImageContent(i){return a(this,null,function*(){let e=yield i.arrayBuffer(),t=new Uint8Array(e.slice(0,4));return Object.values({jpeg:[255,216,255],png:[137,80,78,71],gif:[71,73,70,56],webp:[82,73,70,70]}).some(c=>c.every((h,g)=>t[g]===h))})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=s({token:n,factory:n.\u0275fac,providedIn:"root"})};export{o as a};
