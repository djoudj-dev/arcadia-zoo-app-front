"use strict";(self.webpackChunkarcadia_zoo_app_front=self.webpackChunkarcadia_zoo_app_front||[]).push([[76],{9172:(f,_,r)=>{r.d(_,{U:()=>E});var l=r(9437),t=r(8810),h=r(5312),m=r(4438),v=r(1626);let E=(()=>{class d{http;apiUrl=`${h.c.apiUrl}/api/admin/account-management`;constructor(s){this.http=s}getAllUsers(){return this.http.get(this.apiUrl).pipe((0,l.W)(s=>this.handleError("chargement des utilisateurs",s)))}createUser(s){return this.http.post(this.apiUrl,s).pipe((0,l.W)(n=>this.handleError("cr\xe9ation dutilisateur",n)))}updateUser(s){return this.http.put(`${this.apiUrl}/${s.id}`,s).pipe((0,l.W)(n=>this.handleError("mise \xe0 jour dutilisateur",n)))}deleteUser(s){return this.http.delete(`${this.apiUrl}/${s}`).pipe((0,l.W)(n=>this.handleError("suppression dutilisateur",n)))}getRoles(){return this.http.get(`${this.apiUrl}/roles`).pipe((0,l.W)(s=>this.handleError("chargement des r\xf4les",s)))}handleError(s,n){return console.error(`Erreur lors de ${s} :`,n.message),(0,t.$)(()=>new Error(`Erreur de ${s}.`))}updatePassword(s,n){return this.http.post(`${this.apiUrl}/update-password`,{currentPassword:s,newPassword:n})}static \u0275fac=function(n){return new(n||d)(m.KVO(v.Qq))};static \u0275prov=m.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()},1593:(f,_,r)=>{r.d(_,{v:()=>d});var l=r(4438),t=r(5312),h=r(8141),m=r(9437),v=r(8810),E=r(1626);let d=(()=>{class u{http;apiUrl=`${t.c.apiUrl}/api/stats/count-resource`;totalAnimals=(0,l.vPA)(0);totalHabitats=(0,l.vPA)(0);totalServices=(0,l.vPA)(0);totalEmploye=(0,l.vPA)(0);totalVet=(0,l.vPA)(0);constructor(n){this.http=n}getStats(){return this.http.get(this.apiUrl).pipe((0,h.M)(n=>{this.updateStats(n)}),(0,m.W)(this.handleError))}incrementTotalAnimals(){this.totalAnimals.update(n=>n+1)}decrementTotalAnimals(){this.totalAnimals.update(n=>Math.max(0,n-1))}incrementTotalHabitats(){this.totalHabitats.update(n=>n+1)}decrementTotalHabitats(){this.totalHabitats.update(n=>Math.max(0,n-1))}incrementTotalServices(){this.totalServices.update(n=>n+1)}decrementTotalServices(){this.totalServices.update(n=>Math.max(0,n-1))}incrementTotalEmploye(){this.totalEmploye.update(n=>n+1)}decrementTotalEmploye(){this.totalEmploye.update(n=>Math.max(0,n-1))}incrementTotalVet(){this.totalVet.update(n=>n+1)}decrementTotalVet(){this.totalVet.update(n=>Math.max(0,n-1))}updateStats(n){this.totalAnimals.set(n.animals),this.totalHabitats.set(n.habitats),this.totalServices.set(n.services),this.totalEmploye.set(n.employe),this.totalVet.set(n.vet)}handleError(n){return console.error("Erreur lors de la r\xe9cup\xe9ration des statistiques:",n),(0,v.$)(()=>new Error("Erreur lors de la r\xe9cup\xe9ration des statistiques"))}static \u0275fac=function(g){return new(g||u)(l.KVO(E.Qq))};static \u0275prov=l.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()},5606:(f,_,r)=>{r.r(_),r.d(_,{UserOpinionManagementComponent:()=>U});var l=r(177),t=r(4438),h=r(8219),m=r(4091),v=r(6029),E=r(8893),d=r(9702),u=r(494);const s=(i,p)=>p.type;function n(i,p){if(1&i){const e=t.RV6();t.j41(0,"div",7)(1,"app-button",12),t.bIt("click",function(){const a=t.eBV(e).$implicit,c=t.XpG();return t.Njj(c.changeFilter(a.type))}),t.k0s(),t.j41(2,"span"),t.EFF(3),t.k0s()()}if(2&i){const e=p.$implicit,o=t.XpG();t.R7$(),t.Y8G("text",e.label)("type","button")("color",o.currentFilter()===e.type?"tertiary":"secondary")("rounded",!0)("customClass","font-semibold transition-all duration-300 min-w-[120px]"),t.R7$(),t.ZvI("absolute -top-2 -right-2 ",e.badgeColor," text-white text-xs font-bold px-2 py-1 rounded-full min-w-[20px] text-center shadow-md"),t.R7$(),t.SpI(" ",o.getCount(e.type)," ")}}function g(i,p){1&i&&(t.j41(0,"div",9),t.nrm(1,"div",13),t.k0s())}function x(i,p){1&i&&(t.j41(0,"div",10)(1,"p",14),t.EFF(2," Aucun avis trouv\xe9 pour ce filtre "),t.k0s()())}function C(i,p){if(1&i){const e=t.RV6();t.j41(0,"app-button",12),t.bIt("click",function(){t.eBV(e);const a=t.XpG().$implicit,c=t.XpG(2);return t.Njj(c.validateOpinion(a))}),t.k0s(),t.j41(1,"app-button",12),t.bIt("click",function(){let a;t.eBV(e);const c=t.XpG().$implicit,O=t.XpG(2);return t.Njj(O.rejectOpinion(null!==(a=c._id)&&void 0!==a?a:""))}),t.k0s()}2&i&&(t.Y8G("text","Valider")("type","button")("color","success")("rounded",!0)("customClass","text-sm px-4 py-2"),t.R7$(),t.Y8G("text","Rejeter")("type","button")("color","danger")("rounded",!0)("customClass","text-sm px-4 py-2"))}function M(i,p){if(1&i){const e=t.RV6();t.j41(0,"app-button",12),t.bIt("click",function(){let a;t.eBV(e);const c=t.XpG().$implicit,O=t.XpG(2);return t.Njj(O.deleteOpinion(null!==(a=c._id)&&void 0!==a?a:""))}),t.k0s()}2&i&&t.Y8G("text","Supprimer")("type","button")("color","danger")("rounded",!0)("customClass","text-sm px-4 py-2")}function y(i,p){if(1&i&&(t.j41(0,"article",15)(1,"div",16)(2,"div",17)(3,"div",18)(4,"span",19),t.EFF(5),t.k0s()(),t.j41(6,"div")(7,"h3",20),t.EFF(8),t.k0s(),t.j41(9,"p",21),t.EFF(10),t.nI1(11,"date"),t.k0s()()(),t.nrm(12,"app-rate",22),t.k0s(),t.j41(13,"p",23),t.EFF(14),t.k0s(),t.j41(15,"div",24),t.DNE(16,C,2,10)(17,M,1,5,"app-button",25),t.k0s()()),2&i){const e=p.$implicit,o=t.XpG(2);t.R7$(5),t.SpI(" ",e.name.charAt(0)," "),t.R7$(3),t.SpI(" ",e.name," "),t.R7$(2),t.SpI(" ",t.brH(11,7,e.date,"dd MMMM yyyy","fr-FR")," "),t.R7$(2),t.Y8G("rating",o.createRatingSignal(e.rating))("isReadOnly",o.readOnlySignal),t.R7$(2),t.SpI('"',e.message,'"'),t.R7$(2),t.vxM(e.validated||e.rejected?17:16)}}function b(i,p){if(1&i&&(t.j41(0,"div",11),t.Z7z(1,y,18,11,"article",15,t.Vm6),t.k0s()),2&i){const e=t.XpG();t.R7$(),t.Dyx(e.opinions())}}let U=(()=>{class i{userOpinionsService;toastService;router;route;allOpinions=(0,t.vPA)([]);readOnlySignal=(0,t.vPA)(!0);opinions=(0,t.EWP)(()=>{switch(this.currentFilter()){case"pending":return this.allOpinions().filter(e=>!e.validated&&!e.rejected);case"validated":return this.allOpinions().filter(e=>e.validated);case"rejected":return this.allOpinions().filter(e=>e.rejected);default:return this.allOpinions()}});isLoading=(0,t.vPA)(!0);currentFilter=(0,t.vPA)("pending");filters=[{type:"pending",label:"En attente",badgeColor:"bg-yellow-500"},{type:"validated",label:"Valid\xe9s",badgeColor:"bg-green-500"},{type:"rejected",label:"Rejet\xe9s",badgeColor:"bg-red-500"}];pendingCount=(0,t.EWP)(()=>this.allOpinions().filter(e=>!e.validated&&!e.rejected).length);validatedCount=(0,t.EWP)(()=>this.allOpinions().filter(e=>e.validated).length);rejectedCount=(0,t.EWP)(()=>this.allOpinions().filter(e=>e.rejected).length);constructor(e,o,a,c){this.userOpinionsService=e,this.toastService=o,this.router=a,this.route=c}ngOnInit(){this.loadAllOpinions(),this.initializeFilter()}initializeFilter(){const e=this.router.url.split("/").pop();e&&["pending","validated","rejected"].includes(e)&&this.currentFilter.set(e)}loadAllOpinions(){this.isLoading.set(!0),this.userOpinionsService.getAllUserOpinions().subscribe({next:e=>{this.allOpinions.set(e),this.isLoading.set(!1)},error:e=>{console.error("Erreur lors du chargement des avis:",e),this.toastService.showError("Erreur lors du chargement des avis"),this.isLoading.set(!1)}})}changeFilter(e){this.currentFilter.set(e),this.router.navigate([e],{relativeTo:this.route,replaceUrl:!0})}getCount(e){switch(e){case"pending":return this.pendingCount();case"validated":return this.validatedCount();case"rejected":return this.rejectedCount();default:return 0}}validateOpinion(e){e?._id&&this.userOpinionsService.validateUserOpinions(e._id).subscribe({next:()=>{this.loadAllOpinions(),this.toastService.showSuccess("Avis valid\xe9 avec succ\xe8s")},error:o=>{console.error("Erreur lors de la validation:",o),this.toastService.showError("Erreur lors de la validation")}})}rejectOpinion(e){this.userOpinionsService.rejectUserOpinions(e).subscribe({next:()=>{this.loadAllOpinions(),this.toastService.showSuccess("Avis rejet\xe9 avec succ\xe8s")},error:o=>{console.error("Erreur lors du rejet:",o),this.toastService.showError("Erreur lors du rejet")}})}deleteOpinion(e){confirm("\xcates-vous s\xfbr de vouloir supprimer cet avis ?")&&this.userOpinionsService.deleteUserOpinions(e).subscribe({next:()=>{this.loadAllOpinions(),this.toastService.showSuccess("Avis supprim\xe9 avec succ\xe8s")},error:o=>{console.error("Erreur lors de la suppression:",o),this.toastService.showError("Erreur lors de la suppression")}})}createRatingSignal(e){return(0,t.vPA)(e)}static \u0275fac=function(o){return new(o||i)(t.rXU(E.Y),t.rXU(d.f),t.rXU(u.Ix),t.rXU(u.nX))};static \u0275cmp=t.VBU({type:i,selectors:[["app-user-opinion-management"]],standalone:!0,features:[t.aNF],decls:16,vars:1,consts:[[1,"w-full","bg-gradient-to-b","from-secondary","to-primary","shadow-lg","py-8"],[1,"container","mx-auto","px-4"],[1,"text-center","space-y-4","mb-12"],[1,"text-3xl","md:text-5xl","lg:text-6xl","font-serif","font-bold","text-quinary"],[1,"text-lg","md:text-xl","text-tertiary","font-serif","italic","max-w-4xl","mx-auto"],[1,"flex","justify-center","mb-8"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-4","flex","gap-4"],[1,"relative"],[1,"space-y-4"],[1,"flex","justify-center","items-center","h-48"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-8","text-center"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[3,"click","text","type","color","rounded","customClass"],[1,"animate-spin","rounded-full","h-12","w-12","border-4","border-tertiary","border-t-transparent"],[1,"text-gray-600","font-medium","text-lg"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-6","transition-all","duration-300","hover:shadow-xl","hover:-translate-y-1"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","gap-4"],[1,"w-12","h-12","bg-gradient-to-br","from-secondary","to-tertiary","rounded-full","flex","items-center","justify-center","shadow-md"],[1,"text-white","text-xl","font-semibold"],[1,"font-semibold","text-lg","text-tertiary"],[1,"text-sm","text-gray-500"],[3,"rating","isReadOnly"],[1,"text-gray-700","mb-6","italic"],[1,"flex","justify-end","gap-3","pt-4","border-t","border-gray-200"],[3,"text","type","color","rounded","customClass"]],template:function(o,a){1&o&&(t.j41(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),t.EFF(4," Gestion des Avis Visiteurs "),t.k0s(),t.j41(5,"p",4),t.EFF(6," G\xe9rez les avis et commentaires des visiteurs "),t.k0s(),t.nrm(7,"app-toast"),t.k0s(),t.j41(8,"div",5)(9,"div",6),t.Z7z(10,n,4,9,"div",7,s),t.k0s()(),t.j41(12,"div",8),t.DNE(13,g,2,0,"div",9)(14,x,3,0,"div",10)(15,b,3,0,"div",11),t.k0s()()()),2&o&&(t.R7$(10),t.Dyx(a.filters),t.R7$(3),t.vxM(a.isLoading()?13:0===a.opinions().length?14:15))},dependencies:[l.MD,l.vh,h.Q,m.E,v.d],encapsulation:2})}return i})()}}]);