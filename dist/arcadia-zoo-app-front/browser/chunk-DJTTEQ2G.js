import{a as q}from"./chunk-TKFMAMM4.js";import"./chunk-2CBPXYGN.js";import{a as O}from"./chunk-TTATSR4U.js";import{Bb as D,Cb as A,Eb as P,Fa as M,Fb as c,H as C,Hc as N,Ic as z,Ka as r,Pa as h,Pb as f,Qb as d,Sb as l,T as R,Ub as U,Wa as T,Wc as g,Yb as k,a as x,b as E,cc as B,ec as F,ha as w,ia as I,lb as m,mb as p,nb as $,o as S,pb as L,qa as V,qb as j,u as y,vb as s,w as b,wb as a,xb as v}from"./chunk-JLM7LPRF.js";function G(n,t){n&1&&(s(0,"div",3),v(1,"div",7),a())}function H(n,t){if(n&1&&(s(0,"div",4),d(1),a()),n&2){let e=c();r(),l(" ",e.error," ")}}function J(n,t){n&1&&(s(0,"div",5),d(1," Aucun rapport v\xE9t\xE9rinaire disponible. "),a())}function K(n,t){if(n&1&&(s(0,"p",16)(1,"span",17),d(2,"D\xE9tails suppl\xE9mentaires:"),a(),d(3),a()),n&2){let e=c().$implicit;r(3),l(" ",e.additional_details," ")}}function Q(n,t){if(n&1){let e=D();s(0,"div",8)(1,"div",9)(2,"div",10),v(3,"img",11),s(4,"div",12)(5,"div")(6,"h3",13),d(7),a(),s(8,"p",14),d(9),B(10,"date"),a()(),s(11,"div",15)(12,"p",16)(13,"span",17),d(14,"Alimentation recommand\xE9e:"),a(),d(15),a(),m(16,K,4,1,"p",16),s(17,"p",14)(18,"span",17),d(19,"V\xE9t\xE9rinaire:"),a(),d(20),a()()()(),s(21,"div",18)(22,"span",19),v(23,"i"),d(24),a(),s(25,"button",20),P("click",function(){let u=w(e).$implicit,o=c(2);return I(o.toggleReportStatus(u))}),d(26),a()()()()}if(n&2){let e=t.$implicit,i=c(2);r(3),A("src",e.animal_photo,M)("alt",e.animal_name),r(4),l(" Animal: ",e.animal_name," "),r(2),l(" Date de visite: ",F(10,18,e.visit_date,"dd/MM/yyyy")," "),r(6),U(" ",e.recommended_food_quantity,"",e.food_unit," de ",e.recommended_food_type," "),r(),p(e.additional_details?16:-1),r(4),l(" ",e.user_name," "),r(2),f(i.getStateClass(e.animal_state)),r(),f(k("fas fa-",i.getStateIcon(e.animal_state))),r(),l(" ",e.animal_state," "),r(),f(e.is_processed?i.getProcessedButtonClass():i.getPendingButtonClass()),r(),l(" ",e.is_processed?"Trait\xE9":"Non trait\xE9"," ")}}function X(n,t){if(n&1&&(s(0,"div",6),L(1,Q,27,21,"div",8,$),a()),n&2){let e=c();r(),j(e.reports)}}var W=class n{constructor(t,e){this.veterinaryReportsService=t;this.toastService=e}reports=[];isLoading=!0;error=null;currentPage=1;pageSize=10;totalItems=0;latestVeterinaryReport=V(void 0);ngOnInit(){this.loadReports()}loadReports(t=1){this.isLoading=!0,this.veterinaryReportsService.getAllReports(t,this.pageSize).pipe(R(e=>{this.totalItems=e.total;let i=e.data.map(o=>E(x({},o),{id_veterinary_reports:o._id,is_processed:o.is_treated||!1})),u=[...new Set(i.map(o=>o.id_animal))];return S(u).pipe(b(o=>this.veterinaryReportsService.fetchAnimalDetails(o),3),y(o=>i.filter(_=>_.id_animal===o.id_animal).map(_=>E(x({},_),{animal_photo:this.formatImageUrl(o.images),animal_name:o.name}))),C(),y(o=>o.flat()))})).subscribe({next:e=>{this.reports=e,this.isLoading=!1,this.toastService.showSuccess("Rapports charg\xE9s avec succ\xE8s")},error:e=>{this.error="Erreur lors du chargement des rapports",this.isLoading=!1,console.error("Erreur:",e),this.toastService.showError("Erreur lors du chargement des rapports")}})}onPageChange(t){this.currentPage=t,this.loadReports(t)}formatImageUrl(t){return t?t.startsWith("http")?t.replace(`${g.apiUrl}/api/${g.apiUrl}/api/`,`${g.apiUrl}/api/`):`${g.apiUrl}/api/uploads/animals/${t}`:""}getStateClass(t){let e="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium whitespace-nowrap min-w-[140px] justify-center";switch(t.toLowerCase()){case"bonne sant\xE9":return`${e} bg-green-100 text-green-700`;case"malade":return`${e} bg-red-100 text-red-700`;case"en traitement":return`${e} bg-yellow-100 text-yellow-700`;case"en observation":return`${e} bg-blue-100 text-blue-700`;default:return`${e} bg-gray-100 text-gray-700`}}getStateIcon(t){switch(t.toLowerCase()){case"bonne sant\xE9":return"check-circle";case"malade":return"exclamation-circle";case"en traitement":return"clock";case"en observation":return"eye";default:return"information-circle"}}toggleReportStatus(t){let e=t._id??t.id_veterinary_reports;if(!e){this.toastService.showError("ID du rapport non d\xE9fini");return}let i=!t.is_processed;this.veterinaryReportsService.updateReportStatus(e,i).subscribe({next:()=>{t.is_processed=i,t.is_treated=i,this.toastService.showSuccess("Statut du rapport mis \xE0 jour avec succ\xE8s")},error:u=>{console.error("Erreur lors de la mise \xE0 jour du statut:",u),t.is_processed=!i,t.is_treated=!i,this.toastService.showError("Erreur lors de la mise \xE0 jour du statut")}})}getProcessedButtonClass(){return"bg-green-100 text-green-700 hover:bg-green-200"}getPendingButtonClass(){return"bg-yellow-100 text-yellow-700 hover:bg-yellow-200"}static \u0275fac=function(e){return new(e||n)(h(q),h(O))};static \u0275cmp=T({type:n,selectors:[["app-reports-veterinary-management"]],decls:8,vars:4,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"bg-white","rounded-lg","shadow-lg","p-6"],[1,"text-2xl","font-serif","text-tertiary","mb-6"],[1,"flex","justify-center","items-center","py-8"],[1,"bg-red-100","text-red-700","p-4","rounded-lg","mb-6"],[1,"text-center","py-8","text-gray-600"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-tertiary"],[1,"bg-gray-50","rounded-lg","p-6","shadow-sm"],[1,"flex","justify-between","items-start"],[1,"flex","items-start","gap-4","w-full"],[1,"w-16","h-16","rounded-full","object-cover",3,"src","alt"],[1,"space-y-4","flex-grow"],[1,"text-lg","font-medium","text-tertiary"],[1,"text-sm","text-gray-600"],[1,"space-y-2"],[1,"text-sm"],[1,"font-medium"],[1,"flex","flex-col","items-end","gap-2"],[1,"ml-2"],[1,"px-3","py-1","rounded-full","text-sm","font-medium","transition-colors",3,"click"]],template:function(e,i){e&1&&(s(0,"div",0)(1,"div",1)(2,"h1",2),d(3," Rapports V\xE9t\xE9rinaires "),a(),m(4,G,2,0,"div",3),m(5,H,2,1,"div",4),m(6,J,2,0,"div",5),m(7,X,3,0,"div",6),a()()),e&2&&(r(4),p(i.isLoading?4:-1),r(),p(i.error?5:-1),r(),p(!i.isLoading&&!i.error&&i.reports.length===0?6:-1),r(),p(!i.isLoading&&i.reports.length>0?7:-1))},dependencies:[z,N],encapsulation:2})};export{W as ReportsVeterinaryManagement};
