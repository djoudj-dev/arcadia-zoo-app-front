"use strict";(self.webpackChunkarcadia_zoo_app_front=self.webpackChunkarcadia_zoo_app_front||[]).push([[40],{4040:(y,d,l)=>{l.r(d),l.d(d,{AccountManagementComponent:()=>C});var e=l(4438),a=l(9417),m=l(6029),p=l(8219),_=l(494),g=l(9172),f=l(1593),h=l(9702);const u=(i,c)=>c.id;function b(i,c){if(1&i&&(e.j41(0,"option",16),e.EFF(1),e.k0s()),2&i){const n=c.$implicit;e.Y8G("ngValue",n),e.R7$(),e.JRh(n.name)}}function E(i,c){if(1&i){const n=e.RV6();e.j41(0,"div",24)(1,"p",37),e.EFF(2," \xcates-vous s\xfbr de vouloir supprimer ce compte ? "),e.k0s(),e.j41(3,"div",38)(4,"button",39),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.deleteAccount(t.accountToDelete))}),e.EFF(5," Confirmer "),e.k0s(),e.j41(6,"button",40),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.accountToDelete=null)}),e.EFF(7," Annuler "),e.k0s()()()}}function v(i,c){if(1&i){const n=e.RV6();e.j41(0,"div",26)(1,"h4",41),e.EFF(2),e.k0s(),e.j41(3,"p",42)(4,"span",43),e.EFF(5,"Email :"),e.k0s(),e.EFF(6),e.k0s(),e.j41(7,"p",44)(8,"span",43),e.EFF(9,"R\xf4le :"),e.k0s(),e.EFF(10),e.k0s(),e.j41(11,"div",45)(12,"app-button",46),e.bIt("click",function(){const t=e.eBV(n).$implicit,s=e.XpG();return e.Njj(s.editUser(t))}),e.k0s(),e.j41(13,"app-button",46),e.bIt("click",function(){const t=e.eBV(n).$implicit,s=e.XpG();return e.Njj(s.confirmDeleteAccount(t.id))}),e.k0s()()()}if(2&i){const n=c.$implicit;e.R7$(2),e.SpI(" ",n.name," "),e.R7$(4),e.SpI(" ",n.email," "),e.R7$(4),e.SpI(" ",n.role?n.role.name:"Non d\xe9fini"," "),e.R7$(2),e.Y8G("text","Modifier")("type","button")("color","secondary")("rounded",!0)("customClass","text-xs px-2 py-1"),e.R7$(),e.Y8G("text","Supprimer")("type","button")("color","red")("rounded",!0)("customClass","text-xs px-2 py-1")}}function M(i,c){if(1&i&&(e.j41(0,"option",16),e.EFF(1),e.k0s()),2&i){const n=c.$implicit;e.Y8G("ngValue",n),e.R7$(),e.JRh(n.name)}}let C=(()=>{class i{router;accountService;countResourceService;toastService;users=(0,e.vPA)([]);roles=(0,e.vPA)([]);newUser=(0,e.vPA)({});accountToDelete=null;constructor(n,r,t,s){this.router=n,this.accountService=r,this.countResourceService=t,this.toastService=s}ngOnInit(){this.loadUsers(),this.loadRoles()}loadUsers(){this.accountService.getAllUsers().subscribe({next:n=>this.users.set(n||[]),error:n=>{console.error("Erreur de chargement des utilisateurs :",n),this.toastService.showError("Erreur lors du chargement des utilisateurs")}})}loadRoles(){this.accountService.getRoles().subscribe({next:n=>this.roles.set(n||[]),error:n=>{console.error("Erreur de chargement des r\xf4les :",n),this.toastService.showError("Erreur lors du chargement des r\xf4les")}})}createAccount(){const{name:n,email:r,role:t}=this.newUser();n&&r&&t?.id?this.accountService.createUser({name:n,email:r,role_id:t.id}).subscribe({next:o=>{this.users.update(k=>[...k,o]),this.newUser.set({}),this.countResourceService.incrementTotalEmploye(),this.toastService.showSuccess("Compte cr\xe9\xe9 avec succ\xe8s ! Un email a \xe9t\xe9 envoy\xe9 avec les identifiants.")},error:o=>{console.error("Erreur de cr\xe9ation d'utilisateur :",o),this.toastService.showError("Une erreur est survenue lors de la cr\xe9ation du compte")}}):this.toastService.showError("Veuillez remplir tous les champs requis")}updateAccount(){const{name:n,role:r}=this.newUser();if(!n||!r?.id)return void this.toastService.showError("Informations de mise \xe0 jour incompl\xe8tes");const t={...this.newUser()};r&&(t.role_id=r.id),this.accountService.updateUser(t).subscribe({next:()=>{this.loadUsers(),this.newUser.set({}),this.toastService.showSuccess("Compte mis \xe0 jour avec succ\xe8s")},error:s=>{console.error("Erreur de mise \xe0 jour d'utilisateur :",s),this.toastService.showError("Une erreur est survenue lors de la mise \xe0 jour du compte")}})}editUser(n){this.newUser.set({...n,password:""})}confirmDeleteAccount(n){this.accountToDelete=n}deleteAccount(n){this.accountService.deleteUser(n).subscribe({next:()=>{this.users.update(r=>r.filter(t=>t.id!==n)),this.toastService.showSuccess("Compte supprim\xe9 avec succ\xe8s"),this.accountToDelete=null},error:r=>{console.error("Erreur de suppression d'utilisateur :",r),this.toastService.showError("Erreur lors de la suppression du compte"),this.accountToDelete=null}})}cancel(){this.newUser.set({})}goBack(){this.router.navigate(["/admin"])}static \u0275fac=function(r){return new(r||i)(e.rXU(_.Ix),e.rXU(g.U),e.rXU(f.v),e.rXU(h.f))};static \u0275cmp=e.VBU({type:i,selectors:[["app-account-management"]],standalone:!0,features:[e.aNF],decls:68,vars:25,consts:[[1,"w-full","bg-gradient-to-b","from-secondary","to-primary","shadow-lg","py-8"],[1,"container","mx-auto","px-4"],[1,"text-center","space-y-4","mb-12"],[1,"text-3xl","md:text-5xl","lg:text-6xl","font-serif","font-bold","text-quinary"],[1,"text-lg","md:text-xl","text-tertiary","font-serif","italic","max-w-4xl","mx-auto"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8","max-w-7xl","mx-auto","mb-12"],[1,"bg-white","rounded-2xl","shadow-lg","p-6","space-y-6"],[1,"text-2xl","font-serif","font-semibold","text-tertiary","mb-6"],[1,"space-y-6"],["for","name",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["type","text","id","name","name","name","required","",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent",3,"ngModelChange","ngModel"],["for","email",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["type","email","id","email","name","email","required","",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent",3,"ngModelChange","ngModel"],["for","role",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["id","role","name","role","required","",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent",3,"ngModelChange","ngModel"],["value",""],[3,"ngValue"],[1,"p-4","bg-blue-50","rounded-lg"],[1,"text-sm","text-tertiary"],[1,"flex","gap-4"],[1,"w-1/2",3,"click","text","type","color","rounded"],[1,"bg-white","rounded-2xl","shadow-lg","p-6"],[1,"relative"],[3,"customClass"],[1,"mb-6","p-4","bg-yellow-50","border-l-4","border-yellow-400","rounded-lg"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"bg-gray-50","rounded-xl","p-4","shadow-md","hover:shadow-lg","transition-all","duration-300"],[1,"flex","justify-center"],[1,"w-full","sm:w-1/3","lg:w-1/4","font-bold","shadow-md","hover:shadow-lg","transition-all","duration-300",3,"click","text","type","color","rounded"],["for","name",1,"block","text-lg","font-medium"],["type","text","id","name","name","name","required","",1,"w-full","p-3","border","rounded-lg","focus:ring-2","focus:ring-tertiary",3,"ngModelChange","ngModel"],["for","email",1,"block","text-lg","font-medium"],["type","email","id","email","name","email","required","",1,"w-full","p-3","border","rounded-lg","focus:ring-2","focus:ring-tertiary",3,"ngModelChange","ngModel"],["for","role",1,"block","text-lg","font-medium"],["id","role","name","role","required","",1,"w-full","p-3","border","rounded-lg","focus:ring-2","focus:ring-tertiary",3,"ngModelChange","ngModel"],[1,"p-4","bg-blue-50","rounded-lg","text-sm"],[1,"w-1/2",3,"click","text","type"],[1,"text-yellow-800"],[1,"mt-4","flex","gap-2","justify-end"],[1,"px-4","py-2","bg-red-500","text-white","rounded","hover:bg-red-600",3,"click"],[1,"px-4","py-2","bg-gray-300","text-gray-700","rounded","hover:bg-gray-400",3,"click"],[1,"text-lg","font-bold","text-tertiary","mb-2"],[1,"text-sm","text-gray-600","mb-1"],[1,"font-semibold"],[1,"text-sm","text-gray-600","mb-3"],[1,"flex","gap-2"],[3,"click","text","type","color","rounded","customClass"]],template:function(r,t){1&r&&(e.j41(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),e.EFF(4," Gestion des Comptes "),e.k0s(),e.j41(5,"p",4),e.EFF(6," Cr\xe9ez et g\xe9rez les comptes utilisateurs "),e.k0s(),e.nrm(7,"app-toast"),e.k0s(),e.j41(8,"div",5)(9,"div",6)(10,"h3",7),e.EFF(11),e.k0s(),e.j41(12,"form",8)(13,"div")(14,"label",9),e.EFF(15," Nom d'utilisateur "),e.k0s(),e.j41(16,"input",10),e.mxI("ngModelChange",function(o){return e.DH7(t.newUser().name,o)||(t.newUser().name=o),o}),e.k0s()(),e.j41(17,"div")(18,"label",11),e.EFF(19," Email "),e.k0s(),e.j41(20,"input",12),e.mxI("ngModelChange",function(o){return e.DH7(t.newUser().email,o)||(t.newUser().email=o),o}),e.k0s()(),e.j41(21,"div")(22,"label",13),e.EFF(23," R\xf4le "),e.k0s(),e.j41(24,"select",14),e.mxI("ngModelChange",function(o){return e.DH7(t.newUser().role,o)||(t.newUser().role=o),o}),e.j41(25,"option",15),e.EFF(26,"- Choisir un r\xf4le -"),e.k0s(),e.Z7z(27,b,2,2,"option",16,u),e.k0s()(),e.j41(29,"div",17)(30,"p",18),e.EFF(31," Un email contenant les identifiants sera envoy\xe9 automatiquement. "),e.k0s()(),e.j41(32,"div",19)(33,"app-button",20),e.bIt("click",function(){return t.newUser().id?t.updateAccount():t.createAccount()}),e.k0s(),e.j41(34,"app-button",20),e.bIt("click",function(){return t.cancel()}),e.k0s()()()(),e.j41(35,"div",21)(36,"h3",7),e.EFF(37," Liste des comptes "),e.k0s(),e.j41(38,"div",22),e.nrm(39,"app-toast",23),e.k0s(),e.DNE(40,E,8,0,"div",24),e.j41(41,"div",25),e.Z7z(42,v,14,13,"div",26,u),e.k0s()()(),e.j41(44,"div",27)(45,"app-button",28),e.bIt("click",function(){return t.goBack()}),e.k0s()()()(),e.j41(46,"form",8)(47,"div")(48,"label",29),e.EFF(49,"Nom"),e.k0s(),e.j41(50,"input",30),e.mxI("ngModelChange",function(o){return e.DH7(t.newUser().name,o)||(t.newUser().name=o),o}),e.k0s()(),e.j41(51,"div")(52,"label",31),e.EFF(53,"Email"),e.k0s(),e.j41(54,"input",32),e.mxI("ngModelChange",function(o){return e.DH7(t.newUser().email,o)||(t.newUser().email=o),o}),e.k0s()(),e.j41(55,"div")(56,"label",33),e.EFF(57,"R\xf4le"),e.k0s(),e.j41(58,"select",34),e.mxI("ngModelChange",function(o){return e.DH7(t.newUser().role,o)||(t.newUser().role=o),o}),e.j41(59,"option",15),e.EFF(60,"- Choisir un r\xf4le -"),e.k0s(),e.Z7z(61,M,2,2,"option",16,u),e.k0s()(),e.j41(63,"div",35),e.EFF(64," Un email contenant les identifiants sera envoy\xe9 automatiquement. "),e.k0s(),e.j41(65,"div",19)(66,"app-button",36),e.bIt("click",function(){return t.newUser().id?t.updateAccount():t.createAccount()}),e.k0s(),e.j41(67,"app-button",36),e.bIt("click",function(){return t.cancel()}),e.k0s()()()),2&r&&(e.R7$(11),e.SpI(" ",t.newUser().id?"Modifier le compte":"Cr\xe9er un compte"," "),e.R7$(5),e.R50("ngModel",t.newUser().name),e.R7$(4),e.R50("ngModel",t.newUser().email),e.R7$(4),e.R50("ngModel",t.newUser().role),e.R7$(3),e.Dyx(t.roles()),e.R7$(6),e.Y8G("text",t.newUser().id?"Modifier":"Cr\xe9er")("type","button")("color","tertiary")("rounded",!0),e.R7$(),e.Y8G("text","Annuler")("type","button")("color","secondary")("rounded",!0),e.R7$(5),e.Y8G("customClass","relative"),e.R7$(),e.vxM(null!=t.accountToDelete?40:-1),e.R7$(2),e.Dyx(t.users()),e.R7$(3),e.Y8G("text","Retour")("type","button")("color","tertiary")("rounded",!0),e.R7$(5),e.R50("ngModel",t.newUser().name),e.R7$(4),e.R50("ngModel",t.newUser().email),e.R7$(4),e.R50("ngModel",t.newUser().role),e.R7$(3),e.Dyx(t.roles()),e.R7$(5),e.Y8G("text",t.newUser().id?"Modifier":"Cr\xe9er")("type","button"),e.R7$(),e.Y8G("text","Annuler")("type","button"))},dependencies:[a.X1,a.qT,a.xH,a.y7,a.me,a.wz,a.BC,a.cb,a.YS,a.YN,a.vS,a.cV,m.d,p.Q],encapsulation:2})}return i})()}}]);