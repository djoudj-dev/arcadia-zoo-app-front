"use strict";(self.webpackChunkarcadia_zoo_app_front=self.webpackChunkarcadia_zoo_app_front||[]).push([[384],{1384:(x,l,n)=>{n.r(l),n.d(l,{ReportsVeterinaryManagement:()=>h});var d=n(177),p=n(7468),c=n(6354),u=n(5558),e=n(4438),_=n(7472),m=n(9702);function g(a,i){1&a&&(e.j41(0,"div",3),e.nrm(1,"div",7),e.k0s())}function v(a,i){if(1&a&&(e.j41(0,"div",4),e.EFF(1),e.k0s()),2&a){const r=e.XpG();e.R7$(),e.SpI(" ",r.error," ")}}function f(a,i){1&a&&(e.j41(0,"div",5),e.EFF(1," Aucun rapport v\xe9t\xe9rinaire disponible. "),e.k0s())}function E(a,i){if(1&a&&(e.j41(0,"p",16)(1,"span",17),e.EFF(2,"D\xe9tails suppl\xe9mentaires:"),e.k0s(),e.EFF(3),e.k0s()),2&a){const r=e.XpG().$implicit;e.R7$(3),e.SpI(" ",r.additional_details," ")}}function y(a,i){if(1&a){const r=e.RV6();e.j41(0,"div",8)(1,"div",9)(2,"div",10),e.nrm(3,"img",11),e.j41(4,"div",12)(5,"div")(6,"h3",13),e.EFF(7),e.k0s(),e.j41(8,"p",14),e.EFF(9),e.nI1(10,"date"),e.k0s()(),e.j41(11,"div",15)(12,"p",16)(13,"span",17),e.EFF(14,"Alimentation recommand\xe9e:"),e.k0s(),e.EFF(15),e.k0s(),e.DNE(16,E,4,1,"p",16),e.j41(17,"p",14)(18,"span",17),e.EFF(19,"V\xe9t\xe9rinaire:"),e.k0s(),e.EFF(20),e.k0s()()()(),e.j41(21,"div",18)(22,"span",19),e.nrm(23,"i"),e.EFF(24),e.k0s(),e.j41(25,"button",20),e.bIt("click",function(){const s=e.eBV(r).$implicit,o=e.XpG(2);return e.Njj(o.toggleReportStatus(s))}),e.EFF(26),e.k0s()()()()}if(2&a){let r;const t=i.$implicit,s=e.XpG(2);e.R7$(3),e.Y8G("src",t.animal_photo,e.B4B)("alt",t.animal_name),e.R7$(4),e.SpI(" Animal: ",t.animal_name," "),e.R7$(2),e.SpI(" Date de visite: ",e.i5U(10,18,t.visit_date,"dd/MM/yyyy")," "),e.R7$(6),e.E5c(" ",t.recommended_food_quantity,"",t.food_unit," de ",t.recommended_food_type," "),e.R7$(),e.vxM(t.additional_details?16:-1),e.R7$(4),e.SpI(" ",t.user_name," "),e.R7$(2),e.HbH(s.getStateClass(t.animal_state)),e.R7$(),e.ZvI("fas fa-",s.getStateIcon(t.animal_state),""),e.R7$(),e.SpI(" ",t.animal_state," "),e.R7$(),e.HbH(s.getStatusButtonClass(null!==(r=t.is_processed)&&void 0!==r&&r)),e.R7$(),e.SpI(" ",t.is_processed?"Trait\xe9":"Non trait\xe9"," ")}}function R(a,i){if(1&a&&(e.j41(0,"div",6),e.Z7z(1,y,27,21,"div",8,e.Vm6),e.k0s()),2&a){const r=e.XpG();e.R7$(),e.Dyx(r.reports)}}let h=(()=>{class a{veterinaryReportsService;toastService;reports=[];isLoading=!0;error=null;constructor(r,t){this.veterinaryReportsService=r,this.toastService=t}ngOnInit(){this.loadReports()}loadReports(){this.isLoading=!0,this.veterinaryReportsService.getAllReports().pipe((0,c.T)(r=>r.map(t=>({...t,id_veterinary_reports:t._id,is_processed:t.is_treated||!1}))),(0,u.n)(r=>(0,p.p)(r.map(t=>this.veterinaryReportsService.fetchAnimalDetails(t.id_animal).pipe((0,c.T)(s=>({...t,animal_photo:s.images||"",animal_name:s.name}))))))).subscribe({next:r=>{this.reports=r,this.isLoading=!1,this.toastService.showSuccess("Rapports charg\xe9s avec succ\xe8s")},error:r=>{this.error="Erreur lors du chargement des rapports",this.isLoading=!1,console.error("Erreur:",r),this.toastService.showError("Erreur lors du chargement des rapports")}})}getStateClass(r){const t="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium whitespace-nowrap min-w-[140px] justify-center";switch(r.toLowerCase()){case"bonne sant\xe9":return`${t} bg-green-100 text-green-700`;case"malade":return`${t} bg-red-100 text-red-700`;case"en traitement":return`${t} bg-yellow-100 text-yellow-700`;case"en observation":return`${t} bg-blue-100 text-blue-700`;default:return`${t} bg-gray-100 text-gray-700`}}getStateIcon(r){switch(r.toLowerCase()){case"bonne sant\xe9":return"check-circle";case"malade":return"exclamation-circle";case"en traitement":return"clock";case"en observation":return"eye";default:return"information-circle"}}toggleReportStatus(r){const t=r._id||r.id_veterinary_reports;if(!t)return void this.toastService.showError("ID du rapport non d\xe9fini");const s=!r.is_processed;this.veterinaryReportsService.updateReportStatus(t,s).subscribe({next:()=>{r.is_processed=s,r.is_treated=s,this.toastService.showSuccess("Statut du rapport mis \xe0 jour avec succ\xe8s")},error:o=>{console.error("Erreur lors de la mise \xe0 jour du statut:",o),r.is_processed=!s,r.is_treated=!s,this.toastService.showError("Erreur lors de la mise \xe0 jour du statut")}})}getStatusButtonClass(r){return r?"bg-green-100 text-green-700 hover:bg-green-200":"bg-yellow-100 text-yellow-700 hover:bg-yellow-200"}static \u0275fac=function(t){return new(t||a)(e.rXU(_.e),e.rXU(m.f))};static \u0275cmp=e.VBU({type:a,selectors:[["app-reports-veterinary-management"]],standalone:!0,features:[e.aNF],decls:8,vars:4,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"bg-white","rounded-lg","shadow-lg","p-6"],[1,"text-2xl","font-serif","text-tertiary","mb-6"],[1,"flex","justify-center","items-center","py-8"],[1,"bg-red-100","text-red-700","p-4","rounded-lg","mb-6"],[1,"text-center","py-8","text-gray-600"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-tertiary"],[1,"bg-gray-50","rounded-lg","p-6","shadow-sm"],[1,"flex","justify-between","items-start"],[1,"flex","items-start","gap-4","w-full"],[1,"w-16","h-16","rounded-full","object-cover",3,"src","alt"],[1,"space-y-4","flex-grow"],[1,"text-lg","font-medium","text-tertiary"],[1,"text-sm","text-gray-600"],[1,"space-y-2"],[1,"text-sm"],[1,"font-medium"],[1,"flex","flex-col","items-end","gap-2"],[1,"ml-2"],[1,"px-3","py-1","rounded-full","text-sm","font-medium","transition-colors",3,"click"]],template:function(t,s){1&t&&(e.j41(0,"div",0)(1,"div",1)(2,"h1",2),e.EFF(3," Rapports V\xe9t\xe9rinaires "),e.k0s(),e.DNE(4,g,2,0,"div",3)(5,v,2,1,"div",4)(6,f,2,0,"div",5)(7,R,3,0,"div",6),e.k0s()()),2&t&&(e.R7$(4),e.vxM(s.isLoading?4:-1),e.R7$(),e.vxM(s.error?5:-1),e.R7$(),e.vxM(s.isLoading||s.error||0!==s.reports.length?-1:6),e.R7$(),e.vxM(!s.isLoading&&s.reports.length>0?7:-1))},dependencies:[d.MD,d.vh],encapsulation:2})}return a})()}}]);