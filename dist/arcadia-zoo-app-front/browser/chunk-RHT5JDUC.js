import{a as J}from"./chunk-RHSJBZGP.js";import{a as H}from"./chunk-MR4UGKWL.js";import{a as D}from"./chunk-VV7GXU3B.js";import{e as R}from"./chunk-OTF63C3I.js";import{a as $}from"./chunk-M6XTAS6A.js";import{c as F,e as I,f as N,h as j,j as W,k as B,o as q,p as P,q as O,s as L,u as z,v as G}from"./chunk-IVPOVWWL.js";import{Hb as s,Ib as T,Jb as y,Mb as w,Nb as x,Ob as b,Qb as V,Sa as l,Ta as f,_a as v,a as h,b as M,db as k,hb as p,ia as U,mb as A,pb as C,qb as S,rb as a,sa as d,sb as o,ta as m,xb as E,yb as u,zb as g}from"./chunk-RMHEMJYH.js";var K=(c,n)=>n.id;function X(c,n){if(c&1&&(a(0,"option",16),s(1),o()),c&2){let t=n.$implicit;p("ngValue",t),l(),T(t.name)}}function Y(c,n){if(c&1){let t=E();a(0,"div",22)(1,"p",27),s(2," \xCAtes-vous s\xFBr de vouloir supprimer ce compte ? "),o(),a(3,"div",28)(4,"button",29),u("click",function(){d(t);let i=g();return m(i.deleteAccount(i.accountToDelete))}),s(5," Confirmer "),o(),a(6,"button",30),u("click",function(){d(t);let i=g();return m(i.accountToDelete=null)}),s(7," Annuler "),o()()()}}function Z(c,n){if(c&1){let t=E();a(0,"div",24)(1,"h4",31),s(2),o(),a(3,"p",32)(4,"span",33),s(5,"Email :"),o(),s(6),o(),a(7,"p",34)(8,"span",33),s(9,"R\xF4le :"),o(),s(10),o(),a(11,"div",35)(12,"app-button",36),u("click",function(){let i=d(t).$implicit,r=g();return m(r.editUser(i))})("keydown",function(i){let r=d(t).$implicit,_=g();return m(i.key==="Enter"&&_.editUser(r))}),o(),a(13,"app-button",36),u("click",function(){let i=d(t).$implicit,r=g();return m(r.confirmDeleteAccount(i.id))})("keydown",function(i){let r=d(t).$implicit,_=g();return m(i.key==="Enter"&&_.confirmDeleteAccount(r.id))}),o()()()}if(c&2){let t=n.$implicit;l(2),y(" ",t.name," "),l(4),y(" ",t.email," "),l(4),y(" ",t.role?t.role.name:"Non d\xE9fini"," "),l(2),p("text","Modifier")("type","button")("color","secondary")("rounded",!0)("customClass","text-xs px-2 py-1"),l(),p("text","Supprimer")("type","button")("color","red")("rounded",!0)("customClass","text-xs px-2 py-1")}}var Q=class c{constructor(n,t,e,i){this.router=n;this.accountService=t;this.countResourceService=e;this.toastService=i}users=v([]);roles=v([]);newUser=v({});accountToDelete=null;ngOnInit(){this.loadUsers(),this.loadRoles()}loadUsers(){this.accountService.getAllUsers().subscribe({next:n=>this.users.set(n||[]),error:n=>{console.error("Erreur de chargement des utilisateurs :",n),this.toastService.showError("Erreur lors du chargement des utilisateurs")}})}loadRoles(){this.accountService.getRoles().subscribe({next:n=>this.roles.set(n||[]),error:n=>{console.error("Erreur de chargement des r\xF4les :",n),this.toastService.showError("Erreur lors du chargement des r\xF4les")}})}createAccount(){let{name:n,email:t,role:e}=this.newUser();if(!n||!t||!e?.id){this.toastService.showError("Veuillez remplir tous les champs requis");return}let i={name:n,email:t,role_id:e.id};this.accountService.createUser(i).subscribe({next:r=>{this.users.update(_=>[..._,r]),this.newUser.set({}),this.countResourceService.incrementTotalEmploye(),this.toastService.showSuccess("Compte cr\xE9\xE9 avec succ\xE8s ! Un email a \xE9t\xE9 envoy\xE9 avec les identifiants.")},error:r=>{console.error("Erreur de cr\xE9ation d'utilisateur :",r),this.toastService.showError("Une erreur est survenue lors de la cr\xE9ation du compte")}})}updateAccount(){let{name:n,role:t}=this.newUser();if(!n||!t?.id){this.toastService.showError("Informations de mise \xE0 jour incompl\xE8tes");return}let e=h({},this.newUser());t&&(e.role_id=t.id),this.accountService.updateUser(e).subscribe({next:()=>{this.loadUsers(),this.newUser.set({}),this.toastService.showSuccess("Compte mis \xE0 jour avec succ\xE8s")},error:i=>{console.error("Erreur de mise \xE0 jour d'utilisateur :",i),this.toastService.showError("Une erreur est survenue lors de la mise \xE0 jour du compte")}})}editUser(n){this.newUser.set(M(h({},n),{password:""}))}confirmDeleteAccount(n){this.accountToDelete=n}deleteAccount(n){this.accountService.deleteUser(n).subscribe({next:()=>{this.users.update(t=>t.filter(e=>e.id!==n)),this.toastService.showSuccess("Compte supprim\xE9 avec succ\xE8s"),this.accountToDelete=null},error:t=>{console.error("Erreur de suppression d'utilisateur :",t),this.toastService.showError("Erreur lors de la suppression du compte"),this.accountToDelete=null}})}cancel(){this.newUser.set({})}goBack(){this.router.navigate(["/admin"])}static \u0275fac=function(t){return new(t||c)(f(R),f(J),f(H),f(D))};static \u0275cmp=U({type:c,selectors:[["app-account-management"]],standalone:!0,features:[V],decls:43,vars:17,consts:[[1,"w-full","bg-gradient-to-b","from-secondary","to-primary","shadow-lg","py-8"],[1,"container","mx-auto","px-4"],[1,"text-center","space-y-4","mb-12"],[1,"text-3xl","md:text-5xl","lg:text-6xl","font-serif","font-bold","text-quinary"],[1,"text-lg","md:text-xl","text-tertiary","font-serif","italic","max-w-4xl","mx-auto"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8","max-w-7xl","mx-auto","mb-12"],[1,"bg-white","rounded-2xl","shadow-lg","p-6","space-y-6"],[1,"text-2xl","font-serif","font-semibold","text-tertiary","mb-6"],[1,"space-y-6"],["for","name",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["type","text","id","name","name","name","required","",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent",3,"ngModelChange","ngModel"],["for","email",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["type","email","id","email","name","email","required","",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent",3,"ngModelChange","ngModel"],["for","role",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["id","role","name","role","required","",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent",3,"ngModelChange","ngModel"],["value",""],[3,"ngValue"],[1,"p-4","bg-blue-50","rounded-lg"],[1,"text-sm","text-tertiary"],[1,"flex","gap-4"],[1,"w-1/2",3,"click","keydown","text","type","color","rounded"],[1,"bg-white","rounded-2xl","shadow-lg","p-6"],[1,"mb-6","p-4","bg-yellow-50","border-l-4","border-yellow-400","rounded-lg"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"bg-gray-50","rounded-xl","p-4","shadow-md","hover:shadow-lg","transition-all","duration-300"],[1,"flex","justify-center"],[1,"w-full","sm:w-1/3","lg:w-1/4","font-bold","shadow-md","hover:shadow-lg","transition-all","duration-300",3,"click","keydown","text","type","color","rounded"],[1,"text-yellow-800"],[1,"mt-4","flex","gap-2","justify-end"],[1,"px-4","py-2","bg-red-500","text-white","rounded","hover:bg-red-600",3,"click"],[1,"px-4","py-2","bg-gray-300","text-gray-700","rounded","hover:bg-gray-400",3,"click"],[1,"text-lg","font-bold","text-tertiary","mb-2"],[1,"text-sm","text-gray-600","mb-1"],[1,"font-semibold"],[1,"text-sm","text-gray-600","mb-3"],[1,"flex","gap-2"],[3,"click","keydown","text","type","color","rounded","customClass"]],template:function(t,e){t&1&&(a(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),s(4," Gestion des Comptes "),o(),a(5,"p",4),s(6," Cr\xE9ez et g\xE9rez les comptes utilisateurs "),o()(),a(7,"div",5)(8,"div",6)(9,"h3",7),s(10),o(),a(11,"form",8)(12,"div")(13,"label",9),s(14," Nom d'utilisateur "),o(),a(15,"input",10),b("ngModelChange",function(r){return x(e.newUser().name,r)||(e.newUser().name=r),r}),o()(),a(16,"div")(17,"label",11),s(18," Email "),o(),a(19,"input",12),b("ngModelChange",function(r){return x(e.newUser().email,r)||(e.newUser().email=r),r}),o()(),a(20,"div")(21,"label",13),s(22," R\xF4le "),o(),a(23,"select",14),b("ngModelChange",function(r){return x(e.newUser().role,r)||(e.newUser().role=r),r}),a(24,"option",15),s(25,"- Choisir un r\xF4le -"),o(),C(26,X,2,2,"option",16,K),o()(),a(28,"div",17)(29,"p",18),s(30," Un email contenant les identifiants sera envoy\xE9 automatiquement. "),o()(),a(31,"div",19)(32,"app-button",20),u("click",function(){return e.newUser().id?e.updateAccount():e.createAccount()})("keydown",function(r){return r.key==="Enter"&&(e.newUser().id?e.updateAccount():e.createAccount())}),o(),a(33,"app-button",20),u("click",function(){return e.cancel()})("keydown",function(r){return r.key==="Enter"&&e.cancel()}),o()()()(),a(34,"div",21)(35,"h3",7),s(36," Liste des comptes "),o(),k(37,Y,8,0,"div",22),a(38,"div",23),C(39,Z,14,13,"div",24,K),o()()(),a(41,"div",25)(42,"app-button",26),u("click",function(){return e.goBack()})("keydown",function(r){return r.key==="Enter"&&e.goBack()}),o()()()()),t&2&&(l(10),y(" ",e.newUser().id?"Modifier le compte":"Cr\xE9er un compte"," "),l(5),w("ngModel",e.newUser().name),l(4),w("ngModel",e.newUser().email),l(4),w("ngModel",e.newUser().role),l(3),S(e.roles()),l(6),p("text",e.newUser().id?"Modifier":"Cr\xE9er")("type","button")("color","tertiary")("rounded",!0),l(),p("text","Annuler")("type","button")("color","secondary")("rounded",!0),l(4),A(e.accountToDelete!=null?37:-1),l(2),S(e.users()),l(3),p("text","Retour")("type","button")("color","tertiary")("rounded",!0))},dependencies:[G,B,P,O,F,q,I,N,L,z,W,j,$],encapsulation:2})};export{Q as AccountManagementComponent};
