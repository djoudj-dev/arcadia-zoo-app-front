import{a as ct}from"./chunk-Q36X3LJI.js";import{a as ot}from"./chunk-5VXZOEXZ.js";import{a as X}from"./chunk-3PZTUIRH.js";import{a as st}from"./chunk-4RXGQP6I.js";import{c as K,e as Q,f as Y,g as Z,h as tt,i as et,r as it,t as at,u as nt}from"./chunk-Y3J432DS.js";import{a as lt}from"./chunk-JTG5FMLG.js";import{d as J}from"./chunk-63Q2HYMA.js";import{a as rt}from"./chunk-D7JCWFOM.js";import{Db as W,E as H,Ea as M,Gb as L,Ja as c,Ka as f,Pa as F,S as y,Ua as _,V as R,Ya as b,_ as D,a as h,ab as x,b as g,ba as U,c as V,db as z,eb as A,ec as q,fb as r,gb as s,hb as v,ib as k,jb as d,kb as m,kc as G,la as p,lc as P,ma as u,na as B,o as $,oa as N,oc as C,qb as l,sb as S,vb as T,wb as j,xb as I,zb as O}from"./chunk-OS3QXM5S.js";var E=class o{constructor(i,t){this.http=i;this.habitatService=t}apiUrl=`${C.apiUrl}/api/admin/habitat-management`;getAllHabitats(){return this.http.get(this.apiUrl).pipe(y(i=>console.log("Habitats re\xE7us:",i)),H(i=>this.handleError("chargement des habitats",i)))}createHabitat(i){return this.http.post(this.apiUrl,i).pipe(y(t=>{console.log("R\xE9ponse du serveur (cr\xE9ation):",t),this.habitatService.clearCache()}),H(t=>(console.error("Erreur d\xE9taill\xE9e (cr\xE9ation):",t),this.handleError("cr\xE9ation de l'habitat",t))))}updateHabitat(i,t){let e=new G({Accept:"application/json"}),n={};return t.forEach((a,w)=>{n[w]=a}),console.log("Donn\xE9es envoy\xE9es pour mise \xE0 jour:",{id:i,data:n}),this.http.put(`${this.apiUrl}/${i}`,n,{headers:e}).pipe(y(a=>{console.log("R\xE9ponse du serveur (mise \xE0 jour):",a),this.habitatService.clearCache()}),H(a=>(console.error("Erreur d\xE9taill\xE9e (mise \xE0 jour):",a),a.error instanceof ErrorEvent?console.error("Erreur client:",a.error.message):console.error("Erreur serveur:",{status:a.status,message:a.message,error:a.error}),this.handleError("mise \xE0 jour de l'habitat",a))))}deleteHabitat(i){return this.http.delete(`${this.apiUrl}/${i}`).pipe(y(()=>{console.log("Habitat supprim\xE9 avec succ\xE8s:",i),this.habitatService.clearCache()}),H(t=>(console.error("Erreur lors de la suppression:",t),this.handleError("suppression de l'habitat",t))))}handleError(i,t){let e=`Erreur lors de ${i}. `;return t.error instanceof ErrorEvent?e+=`Message d'erreur: ${t.error.message}`:(e+=`Code d'erreur: ${t.status}, `,e+=`Message: ${t.error?.message||t.message}`),console.error(e),console.error("D\xE9tails complets de l'erreur:",t),$(()=>new Error(e))}static \u0275fac=function(t){return new(t||o)(D(P),D(st))};static \u0275prov=R({token:o,factory:o.\u0275fac,providedIn:"root"})};var ut=(o,i)=>i.id_habitat;function bt(o,i){o&1&&(r(0,"div",17),B(),r(1,"svg",30),v(2,"path",31),s(),N(),r(3,"p",32)(4,"span",33),l(5,"Cliquez pour t\xE9l\xE9charger"),s(),l(6," ou glissez-d\xE9posez "),s(),r(7,"p",34),l(8," PNG, JPG ou WEBP (MAX. 5MB) "),s()())}function ht(o,i){if(o&1&&v(0,"img",18),o&2){let t=m();b("src",t.newHabitatData.images,M)}}function gt(o,i){if(o&1){let t=k();r(0,"div",35)(1,"p",44),l(2,"Confirmer la suppression ?"),s(),r(3,"div",45)(4,"button",46),d("click",function(){p(t);let n=m().$implicit,a=m();return u(a.deleteHabitat(n.id_habitat))}),l(5," Supprimer "),s(),r(6,"button",47),d("click",function(){p(t);let n=m().$implicit,a=m();return u(a.cancelDeleteHabitat(n.id_habitat))}),l(7," Annuler "),s()()()}}function ft(o,i){if(o&1&&(l(0),W(1,"slice")),o&2){let t=m().$implicit;S(" ",L(1,1,t.description,0,100),"... ")}}function _t(o,i){if(o&1&&l(0),o&2){let t=m().$implicit;S(" ",t.description," ")}}function xt(o,i){o&1&&l(0," Lire la suite ")}function vt(o,i){o&1&&l(0," Voir moins ")}function wt(o,i){if(o&1){let t=k();_(0,gt,8,0,"div",35),r(1,"div",26)(2,"div",36),v(3,"img",37),r(4,"div",38)(5,"h4",39),l(6),s(),r(7,"p",40)(8,"span",33),l(9,"Description:"),s(),r(10,"span"),_(11,ft,2,5)(12,_t,1,1),s(),r(13,"button",41),d("click",function(){let n=p(t).$implicit,a=m();return u(a.toggleDescription(n.id_habitat))}),_(14,xt,1,0)(15,vt,1,0),s()()(),r(16,"div",42)(17,"app-button",43),d("click",function(){let n=p(t).$implicit,a=m();return u(a.editHabitat(n.id_habitat))})("keydown.enter",function(){let n=p(t).$implicit,a=m();return u(a.editHabitat(n.id_habitat))}),s(),r(18,"app-button",43),d("click",function(){let n=p(t).$implicit,a=m();return u(a.confirmDeleteHabitat(n.id_habitat))})("keydown.enter",function(){let n=p(t).$implicit,a=m();return u(a.confirmDeleteHabitat(n.id_habitat))}),s()()()()}if(o&2){let t=i.$implicit;x(t.showDeleteConfirmation?0:-1),c(3),b("src",t.images,M)("alt",t.name),c(3),S(" ",t.name," "),c(5),x(t.showDescription?12:11),c(3),x(t.showDescription?15:14),c(3),b("text","Modifier")("type","button")("color","secondary")("rounded",!0)("customClass","text-xs px-2 py-1"),c(),b("text","Supprimer")("type","button")("color","red")("rounded",!0)("customClass","text-xs px-2 py-1")}}function Ht(o,i){o&1&&(r(0,"p",27),l(1," Aucun habitat n'a \xE9t\xE9 cr\xE9\xE9 "),s())}var mt=class o{constructor(i,t,e,n,a){this.router=i;this.habitatManagement=t;this.countResourceService=e;this.toastService=n;this.fileSecurityService=a}habitats=F([]);selectedFile=F(null);newHabitatData={};imageBaseUrl=`${C.apiUrl}/api`;ngOnInit(){this.loadHabitats()}loadHabitats(){this.habitatManagement.getAllHabitats().subscribe({next:i=>{let t=e=>e?e.startsWith("http")?e:`${this.imageBaseUrl}/${e.replace(/^\/+/,"")}`:null;this.habitats.set(i.map(e=>g(h({},e),{showDescription:!1,showDeleteConfirmation:!1,images:t(e.images)})))},error:i=>{console.error("Erreur lors de la r\xE9cup\xE9ration des habitats:",i),this.toastService.showError("Erreur lors du chargement des habitats")}})}onFileSelected(i){return V(this,null,function*(){let t=i.target.files?.[0];if(t){this.selectedFile.set(t);let e=new FileReader;e.onload=()=>{this.newHabitatData.images=e.result},e.readAsDataURL(t)}})}createHabitat(){if(this.validateHabitatData()){let i=this.buildFormData();this.habitatManagement.createHabitat(i).subscribe({next:()=>{this.resetForm(),this.loadHabitats(),this.countResourceService.incrementTotalHabitats(),this.toastService.showSuccess("Habitat cr\xE9\xE9 avec succ\xE8s")},error:t=>{console.error("Erreur lors de la cr\xE9ation de l'habitat :",t),this.toastService.showError("Erreur lors de la cr\xE9ation de l'habitat")}})}else this.toastService.showError("Veuillez remplir tous les champs requis")}updateHabitat(){if(this.validateHabitatData(!0)){let i=this.buildFormData();this.habitatManagement.updateHabitat(this.newHabitatData.id_habitat.toString(),i).subscribe({next:t=>{let n=(a=>a?a.startsWith("http")?a:`${this.imageBaseUrl}/${a.replace(/^\/+/,"")}`:"")(t.images);this.habitats.update(a=>a.map(w=>w.id_habitat===t.id_habitat?g(h({},t),{showDescription:w.showDescription,images:n}):w)),this.resetForm(),this.toastService.showSuccess("Habitat mis \xE0 jour avec succ\xE8s"),this.loadHabitats()},error:t=>{console.error("Erreur lors de la mise \xE0 jour de l'habitat :",t),this.toastService.showError("Erreur lors de la mise \xE0 jour de l'habitat")}})}else this.toastService.showError("Veuillez remplir tous les champs requis")}editHabitat(i){let t=this.habitats().find(e=>e.id_habitat===i);t&&(this.newHabitatData=h({},t),this.toastService.showSuccess("Habitat s\xE9lectionn\xE9 pour modification"))}confirmDeleteHabitat(i){this.habitats.update(t=>t.map(e=>e.id_habitat===i?g(h({},e),{showDeleteConfirmation:!0}):e))}cancelDeleteHabitat(i){this.habitats.update(t=>t.map(e=>e.id_habitat===i?g(h({},e),{showDeleteConfirmation:!1}):e))}deleteHabitat(i){if(!i){this.toastService.showError("ID d'habitat invalide");return}this.habitatManagement.deleteHabitat(i.toString()).subscribe({next:()=>{this.habitats.update(t=>t.filter(e=>e.id_habitat!==i)),this.countResourceService.decrementTotalHabitats(),this.loadHabitats(),this.resetForm(),this.toastService.showSuccess("Habitat supprim\xE9 avec succ\xE8s")},error:t=>{console.error("Erreur lors de la suppression de l'habitat:",t),this.toastService.showError("Erreur lors de la suppression de l'habitat")}})}resetForm(){this.newHabitatData={},this.selectedFile.set(null)}cancel(){this.resetForm(),this.toastService.showSuccess("Formulaire r\xE9initialis\xE9")}toggleDescription(i){this.habitats.update(t=>t.map(e=>e.id_habitat===i?g(h({},e),{showDescription:!e.showDescription}):e))}goBack(){this.router.navigate(["/admin"])}validateHabitatData(i=!1){let{name:t,description:e}=this.newHabitatData,n=i||this.newHabitatData.images||this.selectedFile();return console.log("Validation des donn\xE9es:",{name:t,description:e,hasImage:n,newHabitatData:this.newHabitatData,selectedFile:this.selectedFile()}),!!(t&&e&&n)}buildFormData(){let i=new FormData,t=this.newHabitatData;Object.entries(t).forEach(([n,a])=>{a!=null&&i.append(n,a.toString())});let e=this.selectedFile();if(e){let n=this.fileSecurityService.sanitizeFileName(e.name);i.append("images",e,n)}return i}static \u0275fac=function(t){return new(t||o)(f(J),f(E),f(lt),f(X),f(ct))};static \u0275cmp=U({type:o,selectors:[["app-habitat-management"]],standalone:!0,features:[O],decls:42,vars:17,consts:[[1,"w-full","bg-gradient-to-b","from-secondary","to-primary","shadow-lg","py-8"],[1,"container","mx-auto","px-4"],[1,"text-center","space-y-4","mb-12"],[1,"text-3xl","md:text-5xl","lg:text-6xl","font-serif","font-bold","text-quinary"],[1,"text-lg","md:text-xl","text-tertiary","font-serif","italic","max-w-4xl","mx-auto"],[1,"flex","flex-col","lg:flex-row","gap-8"],[1,"w-full","lg:w-1/2","bg-white","rounded-2xl","shadow-lg","p-6","space-y-6"],[1,"text-2xl","font-serif","font-semibold","text-tertiary","mb-6"],["enctype","multipart/form-data",1,"space-y-6",3,"ngSubmit"],["for","name",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["type","text","id","name","name","name","required","","placeholder","Nom de l'habitat",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent",3,"ngModelChange","ngModel"],["for","description",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["id","description","name","description","required","","rows","4","placeholder","Description de l'habitat",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"mb-4"],["for","habitatImage",1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"flex","items-center","justify-center","w-full"],[1,"flex","flex-col","items-center","justify-center","w-full","h-64","border-2","border-gray-300","border-dashed","rounded-lg","cursor-pointer","bg-gray-50","hover:bg-gray-100","transition-all","duration-300"],[1,"flex","flex-col","items-center","justify-center","pt-5","pb-6"],["alt","Aper\xE7u",1,"w-full","h-full","object-cover","rounded-lg",3,"src"],["id","habitatImage","type","file","accept","image/*",1,"hidden",3,"change"],[1,"flex","gap-4","pt-4"],[1,"w-1/2",3,"text","type","color","rounded"],[1,"w-1/2",3,"click","keydown.enter","text","type","color","rounded"],[1,"w-full","lg:w-1/2","space-y-8"],[1,"bg-white","rounded-2xl","shadow-lg","p-6"],[1,"space-y-4"],[1,"bg-gray-50","rounded-xl","p-4","shadow-md","hover:shadow-lg","transition-all","duration-300"],[1,"text-center","text-gray-500","italic"],[1,"flex","justify-center","pt-8"],[1,"w-full","sm:w-1/3","lg:w-1/4","font-bold","shadow-md","hover:shadow-lg","transition-all","duration-300",3,"click","keydown.enter","text","type","color","rounded"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 20 16",1,"w-8","h-8","mb-4","text-gray-500"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"],[1,"mb-2","text-sm","text-gray-500"],[1,"font-semibold"],[1,"text-xs","text-gray-500"],[1,"mt-4"],[1,"flex","flex-col","sm:flex-row","items-center","gap-4"],[1,"w-32","h-32","object-cover","rounded-lg","shadow-md",3,"src","alt"],[1,"flex-1","space-y-2"],[1,"text-lg","font-bold","text-tertiary"],[1,"text-sm","text-gray-600"],[1,"text-tertiary","hover:text-tertiary/80","ml-2","underline",3,"click"],[1,"flex","gap-2"],[3,"click","keydown.enter","text","type","color","rounded","customClass"],[1,"text-gray-800"],[1,"flex","justify-end","gap-2","mt-2"],[1,"px-4","py-2","bg-red-500","text-white","rounded","hover:bg-red-600",3,"click"],[1,"px-4","py-2","bg-gray-300","text-gray-700","rounded","hover:bg-gray-400",3,"click"]],template:function(t,e){t&1&&(r(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),l(4," Gestion des Habitats "),s(),r(5,"p",4),l(6," Cr\xE9ez et g\xE9rez les habitats du zoo "),s()(),r(7,"div",5)(8,"div",6)(9,"h3",7),l(10),s(),r(11,"form",8),d("ngSubmit",function(){return e.newHabitatData.id_habitat?e.updateHabitat():e.createHabitat()}),r(12,"div")(13,"label",9),l(14," Nom de l'habitat "),s(),r(15,"input",10),I("ngModelChange",function(a){return j(e.newHabitatData.name,a)||(e.newHabitatData.name=a),a}),s()(),r(16,"div")(17,"label",11),l(18," Description "),s(),r(19,"textarea",12),I("ngModelChange",function(a){return j(e.newHabitatData.description,a)||(e.newHabitatData.description=a),a}),s()(),r(20,"div",13)(21,"label",14),l(22," Image de l'habitat "),s(),r(23,"div",15)(24,"label",16),_(25,bt,9,0,"div",17)(26,ht,1,1,"img",18),r(27,"input",19),d("change",function(a){return e.onFileSelected(a)}),s()()()(),r(28,"div",20),v(29,"app-button",21),r(30,"app-button",22),d("click",function(){return e.cancel()})("keydown.enter",function(){return e.cancel()}),s()()()(),r(31,"div",23)(32,"div",24)(33,"h3",7),l(34," Liste des habitats "),s(),r(35,"div",25),v(36,"app-toast"),z(37,wt,19,16,"div",26,ut),_(39,Ht,2,0,"p",27),s()()()(),r(40,"div",28)(41,"app-button",29),d("click",function(){return e.goBack()})("keydown.enter",function(){return e.goBack()}),s()()()()),t&2&&(c(10),S(" ",e.newHabitatData.id_habitat?"Modifier l'habitat":"Cr\xE9er un habitat"," "),c(5),T("ngModel",e.newHabitatData.name),c(4),T("ngModel",e.newHabitatData.description),c(6),x(e.newHabitatData.images?26:25),c(4),b("text",e.newHabitatData.id_habitat?"Modifier":"Cr\xE9er")("type","submit")("color","tertiary")("rounded",!0),c(),b("text","Annuler")("type","button")("color","secondary")("rounded",!0),c(7),A(e.habitats()),c(2),x(e.habitats().length?-1:39),c(2),b("text","Retour")("type","button")("color","tertiary")("rounded",!0))},dependencies:[nt,et,K,Q,Y,it,at,tt,Z,q,ot,rt],encapsulation:2})};export{mt as HabitatManagementComponent};
