import{a as le}from"./chunk-3GWMFATD.js";import{a as me}from"./chunk-PXFAUB5N.js";import{b as se}from"./chunk-JN7JVIU6.js";import{a as ce}from"./chunk-7EALMZ3I.js";import{a as Q}from"./chunk-YQ5HTG6F.js";import{c as Y,e as Z,f as ee,g as te,h as re,i as ie,r as ne,t as oe}from"./chunk-3GFJ5VFU.js";import{d as K}from"./chunk-P5Z6PEHU.js";import{a as ae}from"./chunk-SHRURUTQ.js";import{$ as L,Ab as R,E as h,Eb as G,Fa as j,Hb as W,Ka as c,La as f,Qa as k,T as x,Va as b,W as B,Za as v,_a as P,a as C,b as E,bb as y,c as F,ca as H,eb as I,fb as O,fc as J,gb as n,hb as a,ib as g,jb as _,kb as d,lb as m,ma as u,na as p,nc as X,o as q,oa as M,pa as D,qc as T,r as A,rb as l,sb as $,tb as S,wb as N,xb as z,yb as U}from"./chunk-TKCV3HAR.js";var V=class s{constructor(t){this.http=t}apiUrl=`${T.apiUrl}/api/admin/service-management`;getAllServices(){return this.http.get(this.apiUrl).pipe(h(this.handleError("r\xE9cup\xE9ration des services")))}getAllFeatures(){return this.http.get(`${this.apiUrl}/features`).pipe(h(this.handleError("r\xE9cup\xE9ration des caract\xE9ristiques")))}createService(t){return console.log("Donn\xE9es envoy\xE9es au serveur:",t),this.http.post(`${this.apiUrl}`,t).pipe(x(()=>console.log("Service cr\xE9\xE9 avec succ\xE8s")),h(e=>(console.log("Erreur d\xE9taill\xE9e:",e.error),this.handleError("cr\xE9ation du service")(e))))}createFeature(t){return this.http.post(`${this.apiUrl}/features`,t).pipe(x(e=>console.log("Caract\xE9ristique cr\xE9\xE9e avec succ\xE8s:",e)),h(this.handleError("cr\xE9ation de la caract\xE9ristique")))}updateService(t,e){return this.http.put(`${this.apiUrl}/${t}`,e).pipe(x(r=>console.log("Service mis \xE0 jour avec succ\xE8s:",r)),h(this.handleError("mise \xE0 jour du service")))}deleteService(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(x(()=>console.log("Service supprim\xE9 avec succ\xE8s")),h(this.handleError("suppression du service")))}clearCache(){console.log("Cache des services effac\xE9")}handleError(t){return e=>(console.error(`Erreur lors de la ${t}:`,e),q(()=>new Error(`Erreur lors de la ${t}`)))}static \u0275fac=function(e){return new(e||s)(L(X))};static \u0275prov=B({token:s,factory:s.\u0275fac,providedIn:"root"})};var ve=(s,t)=>t.id_service,ge=(s,t)=>t.id_feature;function he(s,t){if(s&1){let e=_();l(0),G(1,"slice"),n(2,"button",49),d("click",function(){u(e);let i=m().$implicit,o=m();return p(o.toggleDescription(i.id_service))}),l(3," Lire la suite "),a()}if(s&2){let e=m().$implicit;S(" ",W(1,1,e.description,0,100),"... ")}}function fe(s,t){if(s&1){let e=_();l(0),n(1,"button",49),d("click",function(){u(e);let i=m().$implicit,o=m();return p(o.toggleDescription(i.id_service))}),l(2," Voir moins "),a()}if(s&2){let e=m().$implicit;S(" ",e.description," ")}}function _e(s,t){if(s&1){let e=_();n(0,"div",48)(1,"p",50),l(2),a(),n(3,"div",51)(4,"button",52),d("click",function(){u(e);let i=m(2);return p(i.deleteServiceConfirmed())}),l(5," Confirmer "),a(),n(6,"button",53),d("click",function(){u(e);let i=m(2);return p(i.cancelDelete())}),l(7," Annuler "),a()()()}if(s&2){let e=m().$implicit;c(2),S(' \xCAtes-vous s\xFBr de vouloir supprimer le service "',e.name,'" ? ')}}function Se(s,t){if(s&1){let e=_();n(0,"div",7)(1,"div",40),g(2,"img",41),n(3,"div",42)(4,"h4",43),l(5),a()()(),n(6,"div",44)(7,"div",30)(8,"p",45),b(9,he,4,5,"button",46)(10,fe,3,1,"button",46),a()(),n(11,"div",47)(12,"app-button",3),d("click",function(){let i=u(e).$implicit,o=m();return p(o.editService(i.id_service))})("keydown",function(i){let o=u(e).$implicit,w=m();return p(i.key==="Enter"&&w.editService(o.id_service))}),a(),n(13,"app-button",3),d("click",function(){let i=u(e).$implicit,o=m();return p(o.confirmDeleteService(i.id_service))})("keydown",function(i){let o=u(e).$implicit,w=m();return p(i.key==="Enter"&&w.confirmDeleteService(o.id_service))}),a()(),b(14,_e,8,1,"div",48),a()()}if(s&2){let e=t.$implicit,r=m();c(2),v("src",e.images||"/public/images/img_services/restaurant.webp",j)("alt","Service "+e.name),c(3),$(e.name),c(4),y(e.showFullDescription?10:9),c(3),v("text","Modifier")("type","button")("color","secondary")("rounded",!0)("customClass","px-4 py-2 hover:shadow-lg transition-all duration-300"),c(),v("text","Supprimer")("type","button")("color","red")("rounded",!0)("customClass","px-4 py-2 hover:shadow-lg transition-all duration-300"),c(),y(r.serviceToDelete===e.id_service?14:-1)}}function we(s,t){if(s&1){let e=_();n(0,"div",54)(1,"label",55)(2,"input",56),d("change",function(i){let o=u(e).$implicit,w=m(2);return p(w.onFeatureChange(o,i))}),a(),n(3,"span",25),l(4),a()()()}if(s&2){let e=t.$implicit,r=m(2);c(2),v("value",e.id_feature)("checked",r.isFeatureSelected(e)),c(2),$(e.name)}}function xe(s,t){if(s&1&&(n(0,"div",29),I(1,we,5,3,"div",54,ge),a()),s&2){let e=m();c(),O(e.allFeatures())}}function be(s,t){s&1&&(n(0,"div",34),M(),n(1,"svg",57),g(2,"path",58),a(),D(),n(3,"p",59)(4,"span",60),l(5,"Cliquez pour t\xE9l\xE9charger"),a(),l(6," ou glissez-d\xE9posez "),a(),n(7,"p",61),l(8," PNG, JPG ou WEBP (MAX. 5MB) "),a()())}function ye(s,t){if(s&1&&g(0,"img",35),s&2){let e=m();v("src",e.newServiceData.images,j)}}var de=class s{constructor(t,e,r,i,o){this.router=t;this.serviceManagement=e;this.toastService=r;this.imageOptimizer=i;this.fileSecurityService=o}services=k([]);allFeatures=k([]);selectedFile=k(null);serviceToDelete=null;newServiceData={};imageBaseUrl=`${T.apiUrl}/api`;showModal=!1;isFeatureDropdownOpen=!1;ngOnInit(){this.loadServices(),this.loadFeatures()}loadServices(){this.serviceManagement.getAllServices().subscribe({next:t=>{this.services.set(t.map(e=>E(C({},e),{showFullDescription:!1,images:`${this.imageBaseUrl}/${e.images}`})))},error:t=>{console.error("Erreur lors de la r\xE9cup\xE9ration des services:",t),this.toastService.showError("Erreur lors du chargement des services")}})}loadFeatures(){this.serviceManagement.getAllFeatures().subscribe({next:t=>{this.allFeatures.set(t)},error:t=>{console.error("Erreur lors de la r\xE9cup\xE9ration des caract\xE9ristiques:",t),this.toastService.showError("Erreur lors du chargement des caract\xE9ristiques")}})}onFileSelected(t){return F(this,null,function*(){try{let e=yield this.fileSecurityService.scan(t);if(!e.isSafe){this.toastService.showError(e.threats.join(`
`));return}this.selectedFile.set(t);let r=new FileReader;r.onload=()=>{this.newServiceData.images=r.result,this.toastService.showSuccess("Image s\xE9lectionn\xE9e avec succ\xE8s")},r.readAsDataURL(t)}catch(e){console.error("Erreur lors du traitement du fichier:",e),this.toastService.showError("Erreur lors du traitement du fichier")}})}onFileChange(t){return F(this,null,function*(){let e=t.target.files?.[0];if(e)try{let r=yield this.fileSecurityService.scan(e);if(!r.isSafe){this.toastService.showError(r.threats.join(`
`));return}this.selectedFile.set(e);let i=new FileReader;i.onload=()=>{this.newServiceData.images=i.result},i.readAsDataURL(e),this.toastService.showSuccess("Image s\xE9lectionn\xE9e avec succ\xE8s")}catch(r){console.error("Erreur lors du traitement du fichier:",r),this.toastService.showError("Erreur lors du traitement du fichier")}})}createService(){return F(this,null,function*(){try{let t=this.buildFormData();yield A(this.serviceManagement.createService(t)),this.toastService.showSuccess("Service cr\xE9\xE9 avec succ\xE8s !"),this.toggleModal(),this.resetForm(),this.loadServices()}catch{this.toastService.showError("Erreur lors de la cr\xE9ation du service")}})}updateService(){if(!this.validateServiceData(!0)){this.toastService.showError("Veuillez remplir tous les champs requis");return}let t=this.buildFormData();this.serviceManagement.updateService(this.newServiceData.id_service,t).subscribe({next:()=>{this.loadServices(),this.resetForm(),this.toastService.showSuccess("Service mis \xE0 jour avec succ\xE8s")},error:e=>{console.error("Erreur lors de la mise \xE0 jour du service:",e),this.toastService.showError("Erreur lors de la mise \xE0 jour du service")}})}editService(t){let e=this.services().find(r=>r.id_service===t);e&&(this.newServiceData=E(C({},e),{features:e.features||[]}),this.showModal=!0,this.toastService.showSuccess("Service s\xE9lectionn\xE9 pour modification"))}deleteService(t){if(!t){this.toastService.showError("ID de service invalide");return}this.serviceManagement.deleteService(t).subscribe({next:()=>{this.services.update(e=>e.filter(r=>r.id_service!==t)),this.toastService.showSuccess("Service supprim\xE9 avec succ\xE8s")},error:e=>{console.error("Erreur lors de la suppression du service:",e),this.toastService.showError("Erreur lors de la suppression du service")}})}resetForm(){this.newServiceData={name:"",description:"",features:[],images:""},this.selectedFile.set(null)}toggleDescription(t){this.services.update(e=>e.map(r=>r.id_service===t?E(C({},r),{showFullDescription:!r.showFullDescription}):r))}isFeatureSelected(t){return!!this.newServiceData.features?.some(e=>e.id_feature===t.id_feature)}onFeatureChange(t,e){let r=e.target.checked;this.newServiceData.features=r?[...this.newServiceData.features||[],t]:this.newServiceData.features?.filter(i=>i.id_feature!==t.id_feature)}goBack(){this.router.navigate(["/admin"])}openNewServiceModal(){this.resetForm(),this.showModal=!0}toggleModal(){this.showModal=!this.showModal,this.showModal||this.resetForm()}toggleFeatureDropdown(){this.isFeatureDropdownOpen=!this.isFeatureDropdownOpen}validateServiceData(t=!1){let{name:e,description:r,features:i}=this.newServiceData,o=this.selectedFile()||t||this.newServiceData.images;return!!(e&&r&&i&&o)}buildFormData(){let t=new FormData,e=this.newServiceData;Object.entries(e).forEach(([i,o])=>{o!=null&&(i==="features"?t.append(i,JSON.stringify(o)):t.append(i,o.toString()))});let r=this.selectedFile();if(r){let i=this.imageOptimizer.sanitizeFileName(r.name);t.append("image",r,i)}return t}confirmDeleteService(t){this.serviceToDelete=t}cancelDelete(){this.serviceToDelete=null}deleteServiceConfirmed(){this.serviceToDelete!==null&&(this.deleteService(this.serviceToDelete),this.serviceToDelete=null)}static \u0275fac=function(e){return new(e||s)(f(K),f(V),f(Q),f(le),f(me))};static \u0275cmp=H({type:s,selectors:[["app-service-management"]],standalone:!0,features:[R],decls:52,vars:22,consts:[["aria-labelledby","serviceManagementTitle",1,"service-management","mb-8","sm:mb-12","px-4","sm:px-6","py-6","bg-secondary","rounded-lg","shadow-xl","shadow-tertiary"],["id","serviceManagementTitle",1,"text-xl","sm:text-2xl","font-semibold","mb-6","sm:mb-8","text-center"],[1,"flex","justify-end","mb-4"],[3,"click","keydown","text","type","color","rounded","customClass"],[1,"bg-gray-100","p-4","sm:p-6","rounded-lg","shadow-sm"],[1,"text-lg","sm:text-xl","font-semibold","mb-6","text-center","text-gray-800"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[1,"bg-white","rounded-xl","shadow-lg","overflow-hidden","transform","transition-all","duration-300","hover:shadow-2xl","hover:-translate-y-1","relative"],[3,"close","isOpen"],[1,"bg-tertiary","px-6","py-4","rounded-t-lg"],[1,"flex","items-center","justify-between"],[1,"text-xl","font-semibold","text-white"],[1,"text-white","hover:text-gray-200","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"p-6","bg-white","rounded-b-lg"],["enctype","multipart/form-data",3,"ngSubmit"],[1,"space-y-6"],["for","serviceName",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","serviceName","type","text","name","name","required","","placeholder","Entrez le nom du service",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent","transition-all","duration-200",3,"ngModelChange","ngModel"],["for","serviceDescription",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","serviceDescription","name","description","required","","rows","4","placeholder","D\xE9crivez le service",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent","transition-all","duration-200","resize-none",3,"ngModelChange","ngModel"],[1,"relative"],["for","serviceFeatures",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","serviceFeatures","type","button",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","bg-white","text-left","flex","justify-between","items-center","hover:border-tertiary","transition-colors","duration-200",3,"click"],[1,"text-gray-700"],[1,"transform","transition-transform","duration-200"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-gray-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"absolute","z-20","w-full","mt-2","bg-white","border","border-gray-200","rounded-lg","shadow-lg","max-h-60","overflow-y-auto"],[1,"mb-4"],["for","serviceImage",1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"flex","items-center","justify-center","w-full"],[1,"flex","flex-col","items-center","justify-center","w-full","h-64","border-2","border-gray-300","border-dashed","rounded-lg","cursor-pointer","bg-gray-50","hover:bg-gray-100","transition-all","duration-300"],[1,"flex","flex-col","items-center","justify-center","pt-5","pb-6"],["alt","Aper\xE7u",1,"w-full","h-full","object-cover","rounded-lg",3,"src"],["id","serviceImage","type","file","accept","image/*",1,"hidden",3,"change"],[1,"flex","space-x-3","mt-8"],[1,"flex-1",3,"text","type","color","rounded"],[1,"flex-1",3,"click","keydown","text","type","color","rounded"],[1,"relative","h-48","overflow-hidden"],[1,"w-full","h-full","object-cover",3,"src","alt"],[1,"absolute","bottom-0","left-0","right-0","bg-gradient-to-t","from-black/70","to-transparent","p-4"],[1,"text-lg","font-semibold","text-white"],[1,"p-4"],[1,"text-sm","text-gray-600"],[1,"text-tertiary","hover:text-quaternary","font-medium","ml-1"],[1,"flex","justify-end","space-x-2","mt-4"],[1,"mt-4","bg-red-50","border","border-red-200","rounded-lg","p-4","shadow-sm"],[1,"text-tertiary","hover:text-quaternary","font-medium","ml-1",3,"click"],[1,"text-red-700","mb-3"],[1,"flex","justify-end","gap-3"],[1,"px-4","py-2","bg-red-600","text-white","rounded-lg","hover:bg-red-700","transition-colors","duration-300",3,"click"],[1,"px-4","py-2","bg-gray-100","text-gray-700","rounded-lg","hover:bg-gray-200","transition-colors","duration-300",3,"click"],[1,"p-3","hover:bg-gray-50","transition-colors","duration-150"],[1,"flex","items-center","space-x-3","cursor-pointer"],["type","checkbox",1,"w-4","h-4","text-tertiary","border-gray-300","rounded","focus:ring-tertiary",3,"change","value","checked"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 20 16",1,"w-8","h-8","mb-4","text-gray-500"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"],[1,"mb-2","text-sm","text-gray-500"],[1,"font-semibold"],[1,"text-xs","text-gray-500"]],template:function(e,r){e&1&&(n(0,"main",0)(1,"h2",1),l(2," Gestion des services "),a(),g(3,"app-toast"),n(4,"div",2)(5,"app-button",3),d("click",function(){return r.openNewServiceModal()})("keydown",function(o){return o.key==="Enter"&&r.openNewServiceModal()}),a()(),n(6,"div",4)(7,"h3",5),l(8," Liste des services "),a(),n(9,"div",6),I(10,Se,15,15,"div",7,ve),a()(),n(12,"app-modal",8),d("close",function(){return r.toggleModal()}),n(13,"div",9)(14,"div",10)(15,"h3",11),l(16),a(),n(17,"button",12),d("click",function(){return r.toggleModal()}),M(),n(18,"svg",13),g(19,"path",14),a()()()(),D(),n(20,"div",15)(21,"form",16),d("ngSubmit",function(){return r.newServiceData.id_service?r.updateService():r.createService()}),n(22,"div",17)(23,"div")(24,"label",18),l(25," Nom du service "),a(),n(26,"input",19),U("ngModelChange",function(o){return z(r.newServiceData.name,o)||(r.newServiceData.name=o),o}),a()(),n(27,"div")(28,"label",20),l(29," Description "),a(),n(30,"textarea",21),U("ngModelChange",function(o){return z(r.newServiceData.description,o)||(r.newServiceData.description=o),o}),a()(),n(31,"div",22)(32,"label",23),l(33," Caract\xE9ristiques "),a(),n(34,"button",24),d("click",function(){return r.toggleFeatureDropdown()}),n(35,"span",25),l(36),a(),n(37,"span",26),M(),n(38,"svg",27),g(39,"path",28),a()()(),b(40,xe,3,0,"div",29),a(),D(),n(41,"div",30)(42,"label",31),l(43," Image du service "),a(),n(44,"div",32)(45,"label",33),b(46,be,9,0,"div",34)(47,ye,1,1,"img",35),n(48,"input",36),d("change",function(o){return r.onFileChange(o)}),a()()()()(),n(49,"div",37),g(50,"app-button",38),n(51,"app-button",39),d("click",function(){return r.toggleModal()})("keydown",function(o){return o.key==="Enter"&&r.toggleModal()}),a()()()()()()),e&2&&(c(5),v("text","Ajouter un service")("type","button")("color","tertiary")("rounded",!0)("customClass","px-4 py-2 hover:shadow-lg transition-all duration-300"),c(5),O(r.services()),c(2),v("isOpen",r.showModal),c(4),S(" ",r.newServiceData.id_service?"Modifier le service":"Cr\xE9er un service"," "),c(10),N("ngModel",r.newServiceData.name),c(4),N("ngModel",r.newServiceData.description),c(6),S(" ",r.isFeatureDropdownOpen?"Fermer la s\xE9lection":"S\xE9lectionner les caract\xE9ristiques"," "),c(),P("rotate-180",r.isFeatureDropdownOpen),c(3),y(r.isFeatureDropdownOpen?40:-1),c(6),y(r.newServiceData.images?47:46),c(4),v("text",r.newServiceData.id_service?"Modifier":"Cr\xE9er")("type","submit")("color","tertiary")("rounded",!0),c(),v("text","Annuler")("type","button")("color","secondary")("rounded",!0))},dependencies:[oe,ie,Y,Z,ee,ne,re,te,J,se,ae,ce],encapsulation:2})};export{de as a};
