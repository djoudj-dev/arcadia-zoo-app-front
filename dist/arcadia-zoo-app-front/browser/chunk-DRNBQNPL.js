import{Nc as l,Qc as h,_ as c,d as r,da as m,t as o}from"./chunk-RMHEMJYH.js";var s=class extends Error{constructor(e){super(e),this.name="FileValidationError"}},S=class n{constructor(e){this.http=e}config={MIME_TYPES:["image/jpeg","image/png","image/webp","image/gif"],MAX_FILE_SIZE:5*1024*1024,MAX_DIMENSIONS:{width:4096,height:4096},THREAT_PATTERNS:{SIGNATURES:new Set(["4D5A","FFD8FF","526172"]),DANGEROUS_EXTENSIONS:new Set([".exe",".bat",".cmd",".sh",".php"])}};scan(e){return r(this,null,function*(){try{if(!this.config.MIME_TYPES.includes(e.type))throw new s("Type de fichier non autoris\xE9");let i=new FormData;return i.append("file",e),yield o(this.http.post(`${h.apiUrl}/security/scan`,i))}catch(i){return i instanceof s?{isSafe:!1,threats:[i.message]}:(console.warn("Scan antivirus non disponible:",i),{isSafe:!0,threats:[]})}})}isImage(e){return e.type.startsWith("image/")}validateImageContent(e,i){return r(this,null,function*(){if(this.isImage(e)){let[a,t]=yield Promise.all([this.checkFileHeader(e),this.validateDimensions(e)]);a.isValid||i.push("Contenu d'image invalide ou corrompu"),t.isValid||i.push("Dimensions de l'image non autoris\xE9es")}})}checkFileHeader(e){return r(this,null,function*(){try{let i=yield e.slice(0,8).arrayBuffer(),a=Array.from(new Uint8Array(i)).map(u=>u.toString(16).padStart(2,"0")).join("").toUpperCase();return{isValid:!this.config.THREAT_PATTERNS.SIGNATURES.has(a)}}catch{return{isValid:!1}}})}validateDimensions(e){return r(this,null,function*(){if(!this.isImage(e))return{isValid:!0};try{let i=yield this.loadImage(e);return{isValid:i.width<=this.config.MAX_DIMENSIONS.width&&i.height<=this.config.MAX_DIMENSIONS.height}}catch{return{isValid:!1}}})}loadImage(e){return new Promise((i,a)=>{let t=new Image;t.onload=()=>i(t),t.onerror=()=>a(new Error("Chargement de l'image \xE9chou\xE9")),t.src=URL.createObjectURL(e)})}static \u0275fac=function(i){return new(i||n)(m(l))};static \u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})};export{S as a};
