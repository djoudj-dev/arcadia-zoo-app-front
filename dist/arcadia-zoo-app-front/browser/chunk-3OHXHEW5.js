import{a as O}from"./chunk-WQT2M6SU.js";import{a as L}from"./chunk-VV7GXU3B.js";import{a as B}from"./chunk-M6XTAS6A.js";import{Dc as R,Hb as o,Ib as y,Jb as k,Nc as A,Qb as q,Qc as j,Sa as a,Vb as V,X as b,Xb as T,_ as F,d as S,db as h,ea as p,hb as E,ia as I,jb as $,mb as C,pb as D,qb as z,rb as t,sa as v,sb as n,t as w,ta as x,tb as u,ua as _,va as f,xb as H,yb as M,zb as s}from"./chunk-RMHEMJYH.js";var g=class r{apiUrl=`${j.apiUrl}/api/veterinary/habitat-comments`;http=p(A);commentStatusService=p(O);constructor(){}getHabitatCommentHistory(){return this.http.get(this.apiUrl)}markCommentAsResolved(i){let e=`${this.apiUrl}/${i}/resolve`;return this.http.patch(e,{}).pipe(b({next:m=>{this.commentStatusService.emitCommentStatusChange(m)},error:()=>{}}))}reopenComment(i){let e=`${this.apiUrl}/${i}/reopen`;return this.http.patch(e,{}).pipe(b({next:m=>{this.commentStatusService.emitCommentStatusChange(m)},error:()=>{}}))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=F({token:r,factory:r.\u0275fac,providedIn:"root"})};var P=(r,i)=>i._id;function N(r,i){r&1&&(t(0,"div",10),_(),t(1,"svg",17),u(2,"path",18),n(),f(),t(3,"span"),o(4,"R\xE9gl\xE9"),n()())}function J(r,i){r&1&&(t(0,"div",11),_(),t(1,"svg",17),u(2,"path",19),n(),f(),t(3,"span"),o(4,"En attente"),n()())}function K(r,i){if(r&1){let e=H();t(0,"div",20),_(),t(1,"svg",21),u(2,"path",22),n(),f(),t(3,"span"),o(4," R\xE9solu par "),t(5,"span",23),o(6),n(),t(7,"span",24),o(8),V(9,"date"),n()()(),t(10,"app-button",25),M("click",function(l){v(e);let d=s().$implicit,c=s();return l.preventDefault(),x(c.reopenComment(d._id))})("keydown",function(l){v(e);let d=s().$implicit,c=s();return l.preventDefault(),x(c.reopenComment(d._id))}),n()}if(r&2){let e=s().$implicit;a(6),y(e.resolved_by),a(2),k("le ",T(9,5,e.resolved_at,"dd/MM/yyyy"),""),a(2),E("color","tertiary")("text","Rouvrir le ticket")("rounded",!0)}}function Q(r,i){if(r&1){let e=H();t(0,"div",20),_(),t(1,"svg",21),u(2,"path",26),n(),f(),t(3,"span"),o(4,"En attente de r\xE9solution"),n()(),t(5,"app-button",25),M("click",function(l){v(e);let d=s().$implicit,c=s();return l.preventDefault(),x(c.markAsResolved(d._id))})("keydown",function(l){v(e);let d=s().$implicit,c=s();return l.preventDefault(),x(c.markAsResolved(d._id))}),n()}r&2&&(a(5),E("color","success")("text","Valider la r\xE9solution")("rounded",!0))}function W(r,i){if(r&1&&(t(0,"div",3),u(1,"div",5),t(2,"div",6)(3,"div",7)(4,"div",8),o(5),V(6,"date"),n(),t(7,"div",9),h(8,N,5,0,"div",10)(9,J,5,0,"div",11),n()(),t(10,"div",12)(11,"div",13)(12,"div",14),o(13," Habitat "),n(),t(14,"div",15),o(15),n()(),t(16,"div",13)(17,"div",14),o(18," V\xE9t\xE9rinaire "),n(),t(19,"div",15),o(20),n()(),t(21,"div",13)(22,"div",14),o(23," Commentaire "),n(),t(24,"div",15),o(25),n()()(),t(26,"div",16),h(27,K,11,8)(28,Q,6,3),n()()()),r&2){let e=i.$implicit;a(),$("bg-green-500",e.is_resolved)("bg-red-500",!e.is_resolved),a(4),k(" ",T(6,10,e.createdAt,"dd/MM/yyyy HH:mm")," "),a(3),C(e.is_resolved?8:9),a(7),y(e.habitat_name),a(5),y(e.user_name),a(5),y(e.comment),a(2),C(e.is_resolved?27:28)}}function X(r,i){r&1&&(t(0,"div",4)(1,"div",27),o(2," Aucun historique de commentaire disponible "),n()())}var U=class r{commentHistory=[];historyService=p(g);toastService=p(L);ngOnInit(){this.loadCommentHistory()}loadCommentHistory(){this.historyService.getHabitatCommentHistory().subscribe({next:i=>{this.commentHistory=i,this.toastService.showSuccess("Historique charg\xE9 avec succ\xE8s")},error:i=>{console.error("Erreur lors du chargement de l'historique:",i),this.toastService.showError("Erreur lors du chargement de l'historique")}})}markAsResolved(i){return S(this,null,function*(){if(!i){this.toastService.showError("ID du commentaire manquant");return}try{yield w(this.historyService.markCommentAsResolved(i)),this.loadCommentHistory(),this.toastService.showSuccess("Commentaire marqu\xE9 comme r\xE9solu")}catch(e){console.error("Erreur lors du marquage comme r\xE9solu:",e),this.toastService.showError("Erreur lors de la r\xE9solution du commentaire")}})}reopenComment(i){return S(this,null,function*(){if(!i){this.toastService.showError("ID du commentaire manquant");return}try{yield w(this.historyService.reopenComment(i)),this.loadCommentHistory(),this.toastService.showSuccess("Commentaire rouvert avec succ\xE8s")}catch(e){console.error("Erreur lors de la r\xE9ouverture du commentaire:",e),this.toastService.showError("Erreur lors de la r\xE9ouverture du commentaire")}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=I({type:r,selectors:[["app-history-management"]],standalone:!0,features:[q],decls:7,vars:1,consts:[[1,"p-6","bg-white","rounded-xl","shadow-xl","shadow-tertiary/20","my-4"],[1,"text-3xl","font-serif","font-bold","text-tertiary","text-center","mb-8"],[1,"space-y-4"],[1,"bg-white","rounded-lg","shadow-md","hover:shadow-lg","transition-all","duration-300","overflow-hidden"],[1,"text-center","py-12"],[1,"h-1","w-full"],[1,"p-4"],[1,"flex","justify-between","items-start","mb-4"],[1,"text-sm","text-tertiary/80"],[1,"flex","items-center","gap-2"],[1,"flex","items-center","gap-1.5","bg-green-50","text-green-700","px-3","py-1","rounded-full","text-xs","font-medium"],[1,"flex","items-center","gap-1.5","bg-red-50","text-red-700","px-3","py-1","rounded-full","text-xs","font-medium"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-4"],[1,"space-y-1"],[1,"text-xs","font-medium","text-tertiary/60","uppercase"],[1,"text-sm","text-tertiary"],[1,"flex","flex-col-reverse","sm:flex-row","justify-between","items-center","gap-4","pt-4","border-t","border-gray-100"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-3.5","w-3.5"],["fill-rule","evenodd","d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule","evenodd"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 102 0V6zm-1 8a1 1 0 100-2 1 1 0 000 2z","clip-rule","evenodd"],[1,"text-sm","text-tertiary/70","flex","items-center","gap-2"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-4","w-4","text-tertiary/50"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"font-medium","text-tertiary"],[1,"text-tertiary/50"],[1,"w-full","sm:w-auto","min-w-[160px]",3,"click","keydown","color","text","rounded"],["fill-rule","evenodd","d","M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule","evenodd"],[1,"text-tertiary/50","text-lg","font-medium"]],template:function(e,m){e&1&&(t(0,"section",0)(1,"h2",1),o(2," Consultation des commentaires sur les habitats "),n(),t(3,"div",2),D(4,W,29,13,"div",3,P),n(),h(6,X,3,0,"div",4),n()),e&2&&(a(4),z(m.commentHistory),a(2),C(m.commentHistory.length===0?6:-1))},dependencies:[R,B],encapsulation:2})};export{U as HistoryManagementComponent};
