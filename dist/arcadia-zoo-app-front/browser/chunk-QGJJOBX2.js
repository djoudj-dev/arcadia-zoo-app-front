import{a as ve}from"./chunk-IP22EVR6.js";import"./chunk-Q36X3LJI.js";import{a as he}from"./chunk-QWF77R2U.js";import{a as N}from"./chunk-DAXAPV7R.js";import{b as te}from"./chunk-F5P4C6ZM.js";import{b as q}from"./chunk-ZGZVMIRH.js";import"./chunk-D5UEZZMF.js";import{a as fe}from"./chunk-5VXZOEXZ.js";import{a as A}from"./chunk-3PZTUIRH.js";import{a as ye}from"./chunk-4RXGQP6I.js";import{c as ie,e as ne,f as ae,g as oe,h as re,i as de,j as se,n as le,o as me,p as pe,q as ce,r as ue,t as ge}from"./chunk-Y3J432DS.js";import{d as ee}from"./chunk-63Q2HYMA.js";import{a as O}from"./chunk-D7JCWFOM.js";import{Db as K,Ea as $,Fb as X,J as L,Ja as r,Ka as v,Pa as m,Q as U,R as w,Sb as Y,Ua as f,Ya as p,_a as Q,a as z,ab as y,b as W,ba as x,c as P,db as _,dc as Z,eb as b,fb as i,fc as C,gb as n,hb as c,i as M,ib as k,jb as u,kb as g,la as I,ma as H,qb as d,r as B,rb as F,s as G,sb as h,tb as J,vb as E,wb as T,x as R,xb as D,zb as S}from"./chunk-OS3QXM5S.js";var we=(a,e)=>e.id_feeding;function Fe(a,e){a&1&&(i(0,"div",6),c(1,"div",10),n())}function Ee(a,e){a&1&&(i(0,"div",7),d(1," Aucun historique de repas disponible pour cet animal. "),n())}function Te(a,e){if(a&1&&(i(0,"div",17),d(1),n()),a&2){let t=g().$implicit;r(),h(' "',t.notes,'" ')}}function De(a,e){if(a&1&&(i(0,"div",11)(1,"div",12)(2,"div")(3,"div",13),d(4),n(),i(5,"div",14),d(6),n()(),i(7,"div",15)(8,"div",14),d(9),K(10,"date"),n(),i(11,"div",16),d(12),n()()(),f(13,Te,2,1,"div",17),n()),a&2){let t=e.$implicit;r(4),h(" ",t.food_type," "),r(2),J(" Quantit\xE9: ",t.quantity," ",t.unit," "),r(3),h(" ",X(10,6,t.feeding_date,"dd/MM/yyyy \xE0 HH:mm")," "),r(3),h(" Par: ",t.user_name," "),r(),y(t.notes?13:-1)}}function Me(a,e){if(a&1&&(i(0,"div",8),_(1,De,14,9,"div",11,we),n()),a&2){let t=g();r(),b(t.sortedHistory())}}var j=class a{constructor(e,t){this.animalFeeding=e;this.toastService=t}animalId;animalName;destroy$=new M;feedingHistory=m([]);isModalOpen=m(!1);isLoading=m(!0);sortedHistory=Y(()=>[...this.feedingHistory()].sort((e,t)=>new Date(t.feeding_date).getTime()-new Date(e.feeding_date).getTime()));ngOnInit(){this.loadFeedingHistory()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadFeedingHistory(){this.isLoading.set(!0),this.animalFeeding.getFeedingHistory(this.animalId).pipe(w(this.destroy$)).subscribe({next:e=>{let t=e.map(this.mapHistoryResponse);this.feedingHistory.set(t),this.isLoading.set(!1)},error:e=>{console.error("Erreur lors du chargement de l'historique:",e),this.toastService.showError("Erreur lors du chargement de l'historique"),this.isLoading.set(!1)}})}mapHistoryResponse(e){return{_id:e._id,id_feeding:e.id_feeding,animal_id:e.animal_id,feeding_date:e.feeding_date,food_type:e.food_type,quantity:e.quantity,unit:e.unit,notes:e.notes,user_name:e.user_name,status:e.status,created_at:e.created_at,updated_at:e.updated_at}}closeModal(){this.isModalOpen.set(!1)}static \u0275fac=function(t){return new(t||a)(v(N),v(A))};static \u0275cmp=x({type:a,selectors:[["app-feeding-history"]],inputs:{animalId:"animalId",animalName:"animalName"},standalone:!0,features:[S],decls:12,vars:12,consts:[[3,"click","text","type","color","rounded","customClass"],[3,"close","isOpen"],[1,"bg-white","rounded-2xl","shadow-lg","overflow-hidden"],[1,"bg-tertiary","px-6","py-4"],[1,"text-xl","font-serif","font-semibold","text-white"],[1,"p-6","max-h-[70vh]","overflow-y-auto"],[1,"flex","justify-center","items-center","h-48"],[1,"text-center","py-4","text-gray-500"],[1,"space-y-4"],[1,"bg-gray-50","px-6","py-4","flex","justify-end"],[1,"animate-spin","rounded-full","h-12","w-12","border-4","border-tertiary","border-t-transparent"],[1,"bg-gray-50","rounded-lg","p-4","hover:shadow-md","transition-all","duration-300"],[1,"flex","justify-between","items-start"],[1,"text-sm","font-medium","text-tertiary"],[1,"text-sm","text-gray-500"],[1,"text-right"],[1,"text-xs","text-gray-400"],[1,"mt-2","text-sm","text-gray-600","italic"]],template:function(t,o){t&1&&(i(0,"app-button",0),u("click",function(){return o.isModalOpen.set(!0)}),n(),i(1,"app-modal",1),u("close",function(){return o.closeModal()}),i(2,"div",2)(3,"div",3)(4,"h3",4),d(5," Historique des repas "),n()(),i(6,"div",5),f(7,Fe,2,0,"div",6)(8,Ee,2,0,"div",7)(9,Me,3,0,"div",8),n(),i(10,"div",9)(11,"app-button",0),u("click",function(){return o.closeModal()}),n()()()()),t&2&&(p("text","Historique")("type","button")("color","secondary")("rounded",!0)("customClass","text-sm px-4 py-2"),r(),p("isOpen",o.isModalOpen()),r(6),y(o.isLoading()?7:o.sortedHistory().length===0?8:9),r(4),p("text","Fermer")("type","button")("color","secondary")("rounded",!0)("customClass","px-6"))},dependencies:[C,Z,O,q],encapsulation:2,changeDetection:0})};var Ie=(a,e)=>e.id_habitat,He=(a,e)=>e.id_animal;function ke(a,e){a&1&&(i(0,"div",5),c(1,"div",30),n())}function Ae(a,e){a&1&&(i(0,"div",45),d(1," Animal nourri ! "),n())}function Oe(a,e){if(a&1){let t=k();i(0,"div",38)(1,"div",39)(2,"div",40),c(3,"img",41),i(4,"div")(5,"h4",42),d(6),n(),i(7,"p",43),d(8),n()()(),i(9,"div",44),f(10,Ae,2,0,"div",45),i(11,"app-button",46),u("click",function(){let s=I(t).$implicit,l=g(3);return H(l.openFeedingModal(s.id_animal))}),n(),c(12,"app-feeding-history",47),n()()()}if(a&2){let t=e.$implicit,o=g(3);r(3),p("src",t.images,$)("alt",t.name),r(3),F(t.name),r(2),F(t.species),r(2),y(o.activeToasts().has(t.id_animal)?10:-1),r(),p("text","Nourrir")("type","button")("color","tertiary")("rounded",!0)("customClass","text-sm px-4 py-2")("disabled",o.feedingInProgress().has(t.id_animal)),r(),p("animalId",t.id_animal)}}function qe(a,e){if(a&1&&(i(0,"div",31)(1,"div",32),c(2,"img",33)(3,"div",34),i(4,"h2",35),d(5),n()(),i(6,"div",36)(7,"h3",37),d(8," Animaux \xE0 nourrir "),n(),_(9,Oe,13,12,"div",38,He),n()()),a&2){let t=e.$implicit;r(2),p("src",t.images,$)("alt",t.name),r(3),h(" ",t.name," "),r(4),b(t.animals)}}function Ne(a,e){if(a&1&&(i(0,"div",6),_(1,qe,11,3,"div",31,Ie),n()),a&2){let t=g();r(),b(t.habitats())}}function je(a,e){a&1&&(i(0,"div",12),d(1," Consommation enregistr\xE9e avec succ\xE8s ! "),n())}var V=class a{constructor(e,t,o,s,l){this.habitatService=e;this.animalFeedingService=t;this.router=o;this.authService=s;this.toastService=l}habitats=m([]);animals=m([]);isLoading=m(!1);error=m(null);feedingInProgress=m(new Set);modalToastVisible=m(!1);isModalOpen=m(!1);selectedAnimalId=m(null);activeToasts=m(new Set);feedingData={feedingTime:new Date,foodType:"",quantity:0,animalId:0,employeId:0,employeName:"",notes:""};destroy$=new M;ngOnInit(){this.loadHabitats()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}markAsFed(e){return P(this,null,function*(){if(this.feedingInProgress().has(e)){this.toastService.showError("Op\xE9ration d\xE9j\xE0 en cours");return}let t=this.authService.currentUserSignal();if(!t?.id){this.toastService.showError("ID utilisateur non disponible");return}let o=this.prepareFeedingData(e,t);this.updateFeedingProgress(e,!0);try{yield B(this.animalFeedingService.markAnimalAsFed(e,o).pipe(w(this.destroy$),L(()=>this.updateFeedingProgress(e,!1)))),this.toastService.showSuccess("Animal nourri avec succ\xE8s"),this.habitatService.clearCache(),this.loadHabitats(),this.showToastForAnimal(e)}catch(s){console.error("Erreur compl\xE8te:",s),this.toastService.showError("Erreur lors du marquage de l'animal comme nourri")}})}loadHabitats(){this.isLoading.set(!0),this.error.set(null),this.habitatService.getHabitats().pipe(U(e=>R(e.map(t=>this.habitatService.getAnimalsByHabitatId(t.id_habitat).pipe(G(o=>W(z({},t),{animals:o,images:t.images||void 0})))))),w(this.destroy$),L(()=>this.isLoading.set(!1))).subscribe({next:e=>{this.habitats.set(e)},error:()=>{this.error.set("Erreur lors du chargement des habitats"),this.toastService.showError("Erreur lors du chargement des habitats")}})}openFeedingModal(e){if(!e){this.toastService.showError("ID animal invalide");return}this.selectedAnimalId.set(e),this.feedingData.animalId=e,this.isModalOpen.set(!0)}handleFeedingSave(){return P(this,null,function*(){if(!this.validateFeedingData()){this.toastService.showError("Veuillez remplir tous les champs correctement");return}try{yield this.markAsFed(this.feedingData.animalId),this.modalToastVisible.set(!0),this.resetFeedingData(),setTimeout(()=>{this.modalToastVisible.set(!1),this.isModalOpen.set(!1)},3e3)}catch(e){console.error("Erreur lors de l'enregistrement:",e),this.toastService.showError("Erreur lors de l'enregistrement de la consommation")}})}closeModal(){this.isModalOpen.set(!1),this.modalToastVisible.set(!1)}goBack(){this.router.navigate(["/"])}prepareFeedingData(e,t){return{feedingTime:new Date,animalId:e,employeId:t.id,employeName:t.name||"Employ\xE9 inconnu",user_id:t.id,user_name:t.name||"Employ\xE9 inconnu",foodType:this.feedingData.foodType,quantity:this.feedingData.quantity,notes:this.feedingData.notes||""}}updateFeedingProgress(e,t){let o=new Set(this.feedingInProgress());t?o.add(e):o.delete(e),this.feedingInProgress.set(o)}validateFeedingData(){return!!(this.feedingData.animalId&&this.feedingData.foodType&&this.feedingData.quantity>0)}resetFeedingData(){this.feedingData={feedingTime:new Date,foodType:"",quantity:0,animalId:0,employeId:0,employeName:"",notes:""}}showToastForAnimal(e){this.activeToasts.update(t=>{let o=new Set(t);return o.add(e),o}),setTimeout(()=>{this.activeToasts.update(t=>{let o=new Set(t);return o.delete(e),o})},3e3)}static \u0275fac=function(t){return new(t||a)(v(ye),v(N),v(ee),v(te),v(A))};static \u0275cmp=x({type:a,selectors:[["app-animal-feeding-management"]],standalone:!0,features:[S],decls:51,vars:21,consts:[[1,"w-full","bg-gradient-to-b","from-secondary","to-primary","shadow-lg","py-8"],[1,"container","mx-auto","px-4"],[1,"text-center","space-y-4","mb-12"],[1,"text-3xl","md:text-5xl","lg:text-6xl","font-serif","font-bold","text-quinary"],[1,"text-lg","md:text-xl","text-tertiary","font-serif","italic","max-w-4xl","mx-auto"],[1,"flex","justify-center","items-center","h-48"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[3,"close","isOpen"],[1,"bg-white","rounded-2xl","shadow-lg","overflow-hidden"],[1,"bg-tertiary","px-6","py-4"],[1,"text-xl","font-serif","font-semibold","text-white"],[1,"p-6","space-y-6"],[1,"bg-green-100","text-green-700","px-4","py-2","rounded-lg","text-center"],[1,"space-y-6",3,"submit"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","datetime-local","name","dateTime","required","",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary",3,"ngModelChange","ngModel"],["name","foodType","required","",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary",3,"ngModelChange","ngModel"],["value",""],["value","viande"],["value","poisson"],["value","fruits"],["value","legumes"],["value","graines"],["type","number","name","quantity","min","0","step","0.1","required","",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary",3,"ngModelChange","ngModel"],["name","notes","rows","3","placeholder","Ajoutez des observations ou commentaires...",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-tertiary","resize-none",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-4","pt-4"],[3,"click","text","type","color","rounded","customClass"],[3,"text","type","color","rounded","customClass"],[1,"flex","justify-center","mt-8"],[1,"w-full","sm:w-1/3","lg:w-1/4","font-bold","shadow-md","hover:shadow-lg","transition-all","duration-300",3,"click","text","type","color","rounded"],[1,"animate-spin","rounded-full","h-12","w-12","border-4","border-tertiary","border-t-transparent"],[1,"bg-white/80","backdrop-blur-sm","rounded-2xl","shadow-lg","overflow-hidden"],[1,"relative","h-48"],[1,"w-full","h-full","object-cover",3,"src","alt"],[1,"absolute","inset-0","bg-gradient-to-t","from-black/70","to-transparent"],[1,"absolute","bottom-4","left-4","text-2xl","font-serif","font-bold","text-white"],[1,"p-4","space-y-4"],[1,"text-lg","font-serif","font-semibold","text-tertiary","mb-4"],[1,"bg-gray-50","rounded-xl","p-4","hover:shadow-md","transition-all","duration-300"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","rounded-full","object-cover","shadow-md",3,"src","alt"],[1,"font-medium","text-tertiary"],[1,"text-sm","text-gray-500"],[1,"flex","items-center","gap-2"],[1,"bg-green-100","text-green-700","px-3","py-1","rounded-full","text-sm"],[3,"click","text","type","color","rounded","customClass","disabled"],[3,"animalId"]],template:function(t,o){t&1&&(i(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),d(4," Alimentation des Animaux "),n(),i(5,"p",4),d(6," G\xE9rez les repas et suivez l'historique d'alimentation "),n(),c(7,"app-toast"),n(),f(8,ke,2,0,"div",5)(9,Ne,3,0,"div",6),i(10,"app-modal",7),u("close",function(){return o.closeModal()}),i(11,"div",8)(12,"div",9)(13,"h3",10),d(14," Enregistrer une consommation "),n()(),i(15,"div",11),f(16,je,2,0,"div",12),i(17,"form",13),u("submit",function(){return o.handleFeedingSave()}),i(18,"div")(19,"label",14),d(20," Date et heure "),n(),i(21,"input",15),D("ngModelChange",function(l){return T(o.feedingData.feedingTime,l)||(o.feedingData.feedingTime=l),l}),n()(),i(22,"div")(23,"label",14),d(24," Type d'alimentation "),n(),i(25,"select",16),D("ngModelChange",function(l){return T(o.feedingData.foodType,l)||(o.feedingData.foodType=l),l}),i(26,"option",17),d(27,"S\xE9lectionnez un type"),n(),i(28,"option",18),d(29,"Viande"),n(),i(30,"option",19),d(31,"Poisson"),n(),i(32,"option",20),d(33,"Fruits"),n(),i(34,"option",21),d(35,"L\xE9gumes"),n(),i(36,"option",22),d(37,"Graines"),n()()(),i(38,"div")(39,"label",14),d(40," Quantit\xE9 (en kg) "),n(),i(41,"input",23),D("ngModelChange",function(l){return T(o.feedingData.quantity,l)||(o.feedingData.quantity=l),l}),n()(),i(42,"div")(43,"label",14),d(44," Notes (optionnel) "),n(),i(45,"textarea",24),D("ngModelChange",function(l){return T(o.feedingData.notes,l)||(o.feedingData.notes=l),l}),n()(),i(46,"div",25)(47,"app-button",26),u("click",function(){return o.closeModal()}),n(),c(48,"app-button",27),n()()()()(),i(49,"div",28)(50,"app-button",29),u("click",function(){return o.goBack()}),n()()()()),t&2&&(r(8),y(o.isLoading()?8:9),r(2),p("isOpen",o.isModalOpen()),r(6),y(o.modalToastVisible()?16:-1),r(5),E("ngModel",o.feedingData.feedingTime),r(4),E("ngModel",o.feedingData.foodType),r(16),E("ngModel",o.feedingData.quantity),r(4),E("ngModel",o.feedingData.notes),r(2),p("text","Annuler")("type","button")("color","secondary")("rounded",!0)("customClass","px-6"),r(),p("text","Enregistrer")("type","submit")("color","tertiary")("rounded",!0)("customClass","px-6"),r(2),p("text","Retour")("type","button")("color","tertiary")("rounded",!0))},dependencies:[C,q,ge,de,me,pe,ie,se,le,ne,ae,ue,ce,re,oe,fe,j,O],encapsulation:2})};var Ve=(a,e)=>e.type;function Pe(a,e){if(a&1&&(i(0,"div",11),d(1),n()),a&2){let t=g().$implicit;r(),h(" ",t.description," ")}}function Le(a,e){if(a&1){let t=k();i(0,"button",9),u("click",function(){let s=I(t).$implicit,l=g();return H(l.setActiveTab(s.type))}),i(1,"span",10),d(2),n(),f(3,Pe,2,1,"div",11),n()}if(a&2){let t=e.$implicit,o=g();Q(o.activeTab()===t.type?"bg-tertiary text-white shadow-md":"text-tertiary hover:bg-tertiary/10"),r(2),F(t.text),r(),y(t.description?3:-1)}}function $e(a,e){a&1&&c(0,"app-user-opinion-management")}function ze(a,e){a&1&&c(0,"app-service-management")}function We(a,e){a&1&&c(0,"app-animal-feeding-management")}var xe=class a{activeTab=m("opinions");navigationItems=[{text:"Gestion des avis",type:"opinions",description:"G\xE9rer les avis des visiteurs"},{text:"Gestion des services",type:"services",description:"G\xE9rer les services du zoo"},{text:"Gestion de l'alimentation",type:"feeding",description:"G\xE9rer l'alimentation des animaux"}];setActiveTab(e){this.activeTab.set(e)}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=x({type:a,selectors:[["app-employe-dashboard"]],standalone:!0,features:[S],decls:15,vars:1,consts:[[1,"w-full","bg-gradient-to-b","from-secondary","to-primary","min-h-screen"],[1,"container","mx-auto","px-4","py-8"],[1,"text-center","space-y-4","mb-12"],[1,"text-3xl","md:text-5xl","lg:text-6xl","font-serif","font-bold","text-quinary"],[1,"text-lg","md:text-xl","text-tertiary","font-serif","italic","max-w-4xl","mx-auto"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-4","mb-8"],[1,"flex","flex-wrap","justify-center","gap-4"],[1,"px-6","py-3","rounded-lg","transition-all","duration-300","relative","group",3,"class"],[1,"bg-white/80","backdrop-blur-sm","rounded-xl","shadow-lg","p-6"],[1,"px-6","py-3","rounded-lg","transition-all","duration-300","relative","group",3,"click"],[1,"font-medium"],[1,"absolute","bottom-full","left-1/2","transform","-translate-x-1/2","mb-2","px-3","py-1","bg-black/75","text-white","text-sm","rounded-lg","opacity-0","group-hover:opacity-100","transition-opacity","duration-200","whitespace-nowrap","pointer-events-none"]],template:function(t,o){if(t&1&&(i(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),d(4," Tableau de Bord Employ\xE9 "),n(),i(5,"p",4),d(6," G\xE9rez les diff\xE9rentes fonctionnalit\xE9s du zoo "),n()(),i(7,"nav",5)(8,"div",6),_(9,Le,4,4,"button",7,Ve),n()(),i(11,"div",8),f(12,$e,1,0,"app-user-opinion-management")(13,ze,1,0,"app-service-management")(14,We,1,0,"app-animal-feeding-management"),n()()()),t&2){let s;r(9),b(o.navigationItems),r(3),y((s=o.activeTab())==="opinions"?12:s==="services"?13:s==="feeding"?14:-1)}},dependencies:[C,he,ve,V],encapsulation:2})};export{xe as EmployeDashboardComponent};
