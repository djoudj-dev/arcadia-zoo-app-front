"use strict";(self.webpackChunkarcadia_zoo_app_front=self.webpackChunkarcadia_zoo_app_front||[]).push([[896],{5896:(w,c,i)=>{i.r(c),i.d(c,{HistoryManagementComponent:()=>H});var d=i(467),u=i(177),t=i(4438),v=i(9702),p=i(1626),h=i(5895),y=i(5312),a=i(8141);let f=(()=>{class r{apiUrl=`${y.c.apiUrl}/api/habitat-comment`;http=(0,t.WQX)(p.Qq);commentStatusService=(0,t.WQX)(h.$);constructor(){}getHabitatCommentHistory(){return this.http.get(this.apiUrl).pipe((0,a.M)(e=>{console.log("Tous les commentaires r\xe9cup\xe9r\xe9s:",e)}))}markCommentAsResolved(e){const o=`${this.apiUrl}/${e}/resolve`;return console.log("Tentative de r\xe9solution du commentaire:",e),this.http.patch(o,{}).pipe((0,a.M)({next:n=>{console.log("Commentaire marqu\xe9 comme r\xe9solu:",n),this.commentStatusService.emitCommentStatusChange(n)},error:n=>console.error("Erreur lors de la r\xe9solution:",n)}))}reopenComment(e){const o=`${this.apiUrl}/${e}/reopen`;return console.log("Tentative de r\xe9ouverture du commentaire:",e),this.http.patch(o,{}).pipe((0,a.M)({next:n=>{console.log("Commentaire rouvert:",n),this.commentStatusService.emitCommentStatusChange(n)},error:n=>console.error("Erreur lors de la r\xe9ouverture:",n)}))}static \u0275fac=function(o){return new(o||r)};static \u0275prov=t.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var g=i(8219);const x=(r,s)=>s._id;function C(r,s){1&r&&(t.j41(0,"div",10),t.qSk(),t.j41(1,"svg",17),t.nrm(2,"path",18),t.k0s(),t.joV(),t.j41(3,"span"),t.EFF(4,"R\xe9gl\xe9"),t.k0s()())}function j(r,s){1&r&&(t.j41(0,"div",11),t.qSk(),t.j41(1,"svg",17),t.nrm(2,"path",19),t.k0s(),t.joV(),t.j41(3,"span"),t.EFF(4,"En attente"),t.k0s()())}function E(r,s){if(1&r){const e=t.RV6();t.j41(0,"div",20),t.qSk(),t.j41(1,"svg",21),t.nrm(2,"path",22),t.k0s(),t.joV(),t.j41(3,"span"),t.EFF(4," R\xe9solu par "),t.j41(5,"span",23),t.EFF(6),t.k0s(),t.j41(7,"span",24),t.EFF(8),t.nI1(9,"date"),t.k0s()()(),t.j41(10,"app-button",25),t.bIt("click",function(n){t.eBV(e);const m=t.XpG().$implicit,l=t.XpG();return n.preventDefault(),t.Njj(l.reopenComment(m._id))}),t.k0s()}if(2&r){const e=t.XpG().$implicit;t.R7$(6),t.JRh(e.resolved_by),t.R7$(2),t.SpI("le ",t.i5U(9,5,e.resolved_at,"dd/MM/yyyy"),""),t.R7$(2),t.Y8G("color","tertiary")("text","Rouvrir le ticket")("rounded",!0)}}function F(r,s){if(1&r){const e=t.RV6();t.j41(0,"div",20),t.qSk(),t.j41(1,"svg",21),t.nrm(2,"path",26),t.k0s(),t.joV(),t.j41(3,"span"),t.EFF(4,"En attente de r\xe9solution"),t.k0s()(),t.j41(5,"app-button",25),t.bIt("click",function(n){t.eBV(e);const m=t.XpG().$implicit,l=t.XpG();return n.preventDefault(),t.Njj(l.markAsResolved(m._id))}),t.k0s()}2&r&&(t.R7$(5),t.Y8G("color","success")("text","Valider la r\xe9solution")("rounded",!0))}function k(r,s){if(1&r&&(t.j41(0,"div",3),t.nrm(1,"div",5),t.j41(2,"div",6)(3,"div",7)(4,"div",8),t.EFF(5),t.nI1(6,"date"),t.k0s(),t.j41(7,"div",9),t.DNE(8,C,5,0,"div",10)(9,j,5,0,"div",11),t.k0s()(),t.j41(10,"div",12)(11,"div",13)(12,"div",14),t.EFF(13," Habitat "),t.k0s(),t.j41(14,"div",15),t.EFF(15),t.k0s()(),t.j41(16,"div",13)(17,"div",14),t.EFF(18," V\xe9t\xe9rinaire "),t.k0s(),t.j41(19,"div",15),t.EFF(20),t.k0s()(),t.j41(21,"div",13)(22,"div",14),t.EFF(23," Commentaire "),t.k0s(),t.j41(24,"div",15),t.EFF(25),t.k0s()()(),t.j41(26,"div",16),t.DNE(27,E,11,8)(28,F,6,3),t.k0s()()()),2&r){const e=s.$implicit;t.R7$(),t.AVh("bg-green-500",e.is_resolved)("bg-red-500",!e.is_resolved),t.R7$(4),t.SpI(" ",t.i5U(6,10,e.createdAt,"dd/MM/yyyy HH:mm")," "),t.R7$(3),t.vxM(e.is_resolved?8:9),t.R7$(7),t.JRh(e.habitat_name),t.R7$(5),t.JRh(e.user_name),t.R7$(5),t.JRh(e.comment),t.R7$(2),t.vxM(e.is_resolved?27:28)}}function S(r,s){1&r&&(t.j41(0,"div",4)(1,"div",27),t.EFF(2," Aucun historique de commentaire disponible "),t.k0s()())}let H=(()=>{class r{commentHistory=[];historyService=(0,t.WQX)(f);toastService=(0,t.WQX)(v.f);ngOnInit(){this.loadCommentHistory()}loadCommentHistory(){this.historyService.getHabitatCommentHistory().subscribe({next:e=>{this.commentHistory=e,this.toastService.showSuccess("Historique charg\xe9 avec succ\xe8s")},error:e=>{console.error("Erreur lors du chargement de l'historique:",e),this.toastService.showError("Erreur lors du chargement de l'historique")}})}markAsResolved(e){var o=this;return(0,d.A)(function*(){if(e)try{yield o.historyService.markCommentAsResolved(e).toPromise(),o.loadCommentHistory(),o.toastService.showSuccess("Commentaire marqu\xe9 comme r\xe9solu")}catch(n){console.error("Erreur lors du marquage comme r\xe9solu:",n),o.toastService.showError("Erreur lors de la r\xe9solution du commentaire")}else o.toastService.showError("ID du commentaire manquant")})()}reopenComment(e){var o=this;return(0,d.A)(function*(){if(e)try{yield o.historyService.reopenComment(e).toPromise(),o.loadCommentHistory(),o.toastService.showSuccess("Commentaire rouvert avec succ\xe8s")}catch(n){console.error("Erreur lors de la r\xe9ouverture du commentaire:",n),o.toastService.showError("Erreur lors de la r\xe9ouverture du commentaire")}else o.toastService.showError("ID du commentaire manquant")})()}static \u0275fac=function(o){return new(o||r)};static \u0275cmp=t.VBU({type:r,selectors:[["app-history-management"]],standalone:!0,features:[t.aNF],decls:7,vars:1,consts:[[1,"p-6","bg-white","rounded-xl","shadow-xl","shadow-tertiary/20","my-4"],[1,"text-3xl","font-serif","font-bold","text-tertiary","text-center","mb-8"],[1,"space-y-4"],[1,"bg-white","rounded-lg","shadow-md","hover:shadow-lg","transition-all","duration-300","overflow-hidden"],[1,"text-center","py-12"],[1,"h-1","w-full"],[1,"p-4"],[1,"flex","justify-between","items-start","mb-4"],[1,"text-sm","text-tertiary/80"],[1,"flex","items-center","gap-2"],[1,"flex","items-center","gap-1.5","bg-green-50","text-green-700","px-3","py-1","rounded-full","text-xs","font-medium"],[1,"flex","items-center","gap-1.5","bg-red-50","text-red-700","px-3","py-1","rounded-full","text-xs","font-medium"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-4"],[1,"space-y-1"],[1,"text-xs","font-medium","text-tertiary/60","uppercase"],[1,"text-sm","text-tertiary"],[1,"flex","flex-col-reverse","sm:flex-row","justify-between","items-center","gap-4","pt-4","border-t","border-gray-100"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-3.5","w-3.5"],["fill-rule","evenodd","d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule","evenodd"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 102 0V6zm-1 8a1 1 0 100-2 1 1 0 000 2z","clip-rule","evenodd"],[1,"text-sm","text-tertiary/70","flex","items-center","gap-2"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-4","w-4","text-tertiary/50"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"font-medium","text-tertiary"],[1,"text-tertiary/50"],[1,"w-full","sm:w-auto","min-w-[160px]",3,"click","color","text","rounded"],["fill-rule","evenodd","d","M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule","evenodd"],[1,"text-tertiary/50","text-lg","font-medium"]],template:function(o,n){1&o&&(t.j41(0,"section",0)(1,"h2",1),t.EFF(2," Consultation des commentaires sur les habitats "),t.k0s(),t.j41(3,"div",2),t.Z7z(4,k,29,13,"div",3,x),t.k0s(),t.DNE(6,S,3,0,"div",4),t.k0s()),2&o&&(t.R7$(4),t.Dyx(n.commentHistory),t.R7$(2),t.vxM(0===n.commentHistory.length?6:-1))},dependencies:[u.vh,g.Q],encapsulation:2})}return r})()}}]);