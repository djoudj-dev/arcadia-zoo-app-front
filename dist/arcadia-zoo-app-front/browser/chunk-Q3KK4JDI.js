import{a as c}from"./chunk-PVFCMAIY.js";import{E as m,T as i,W as u,a as s,aa as d,b as o,j as p,nc as g,o as l,qc as b,s as h}from"./chunk-TKCV3HAR.js";var F=class r{http=d(g);authService=d(c);BASE_URL=`${b.apiUrl}/api/employe/animal-feeding-management`;CACHE_DURATION=5*60*1e3;habitatsCache$=new p([]);lastCacheUpdate=0;markAnimalAsFed(e,t){if(!t||!e)return console.error("Les donn\xE9es d'alimentation ou l'ID de l'animal sont manquants."),l(()=>new Error("Les donn\xE9es d'alimentation ou l'ID de l'animal sont invalides."));let a=o(s({},t),{feedingTime:new Date().toISOString(),animalId:e});return this.http.post(`${this.BASE_URL}/feed/${e}`,a).pipe(i(n=>console.log("R\xE9ponse du serveur:",n)),m(n=>(console.error("Erreur lors du marquage de l'animal comme nourri:",n),l(()=>new Error("Impossible de marquer l'animal comme nourri. Veuillez r\xE9essayer.")))))}getFeedingHistory(e){return this.http.get(`${this.BASE_URL}/history/${e}`).pipe(i(t=>console.log("Donn\xE9es brutes de l'historique:",t)),h(t=>t.map(a=>o(s({},a),{user_name:a.user_name||`Employ\xE9 #${a.employe_id||a.user_id}`,employe_id:a.employe_id||a.user_id||0}))),i(t=>console.log("Donn\xE9es apr\xE8s transformation:",t)))}getHabitatsWithAnimals(){return this.isCacheValid()?this.habitatsCache$.asObservable():this.http.get(`${this.BASE_URL}/habitats-with-animals`).pipe(i(e=>this.updateCache(e)))}isCacheValid(){return Date.now()-this.lastCacheUpdate<this.CACHE_DURATION}updateCache(e){this.habitatsCache$.next(e),this.lastCacheUpdate=Date.now()}getAllAnimalFeeding(){return this.http.get(this.BASE_URL)}getAnimalFeedingById(e){return this.http.get(`${this.BASE_URL}/${e}`)}getAnimalFeedingByEmployeId(e){return this.http.get(`${this.BASE_URL}/employe/${e}`)}createAnimalFeeding(e){return this.http.post(this.BASE_URL,e)}updateAnimalFeeding(e){return this.http.put(`${this.BASE_URL}/${e.id}`,e)}deleteAnimalFeeding(e){return this.http.post(`${this.BASE_URL}/delete/${e}`,{})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})};export{F as a};
