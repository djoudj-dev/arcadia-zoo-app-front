import{a as x}from"./chunk-7LW6J6UB.js";import{a as U}from"./chunk-MWR6PVUV.js";import"./chunk-QMO5IVA6.js";import{a as j}from"./chunk-RHSJBZGP.js";import{a as E}from"./chunk-VV7GXU3B.js";import{e as F}from"./chunk-OTF63C3I.js";import{a as V}from"./chunk-M6XTAS6A.js";import{c as M,d as u,e as _,f as I,k as A,m as N,n as T,t as z,v as O}from"./chunk-IVPOVWWL.js";import{Ba as b,Ec as P,Hb as a,Qb as y,Sa as n,Sb as v,Ta as d,_a as h,db as p,hb as m,ia as g,mb as f,rb as i,sb as o,tb as l,xc as C,yb as S}from"./chunk-RMHEMJYH.js";var w=s=>({"border-red-300 ring-red-300":s});function q(s,t){s&1&&(i(0,"p",8),a(1," Le mot de passe actuel est requis "),o())}function D(s,t){s&1&&(i(0,"p",8),a(1," Le mot de passe doit respecter les crit\xE8res de s\xE9curit\xE9 "),o())}function B(s,t){s&1&&(i(0,"p",8),a(1," Les mots de passe ne correspondent pas "),o())}var G=class s{constructor(t,r,e,c,L){this.fb=t;this.accountService=r;this.authService=e;this.router=c;this.toastService=L}closeModal=new b;passwordForm;isSubmitting=h(!1);ngOnInit(){this.initForm()}initForm(){let t={validators:this.passwordMatchValidator,updateOn:"blur"};this.passwordForm=this.fb.group({currentPassword:["",[u.required]],newPassword:["",[u.required,u.minLength(8),u.pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/)]],confirmPassword:["",[u.required]]},t)}passwordMatchValidator(t){let r=t.get("newPassword"),e=t.get("confirmPassword");return r&&e&&r.value!==e.value?{mismatch:!0}:null}onSubmit(){if(this.passwordForm.valid&&!this.isSubmitting()){this.isSubmitting.set(!0);let{currentPassword:t,newPassword:r}=this.passwordForm.value;this.accountService.updatePassword(t,r).subscribe({next:()=>{this.toastService.showSuccess("Mot de passe modifi\xE9 avec succ\xE8s. Vous allez \xEAtre d\xE9connect\xE9."),this.passwordForm.disable(),setTimeout(()=>{this.closeModal.emit()},1e3),setTimeout(()=>{this.authService.logout(),this.router.navigate(["/login"],{queryParams:{message:"Mot de passe modifi\xE9 avec succ\xE8s. Veuillez vous reconnecter."}})},3e3)},error:e=>{this.isSubmitting.set(!1),this.toastService.showError(e.error.message||"Une erreur est survenue lors de la modification du mot de passe"),this.passwordForm.enable()},complete:()=>{this.isSubmitting.set(!1)}})}else this.toastService.showError("Veuillez corriger les erreurs du formulaire")}isFieldInvalid(t){let r=this.passwordForm.get(t);return r?r.invalid&&r.touched:!1}static \u0275fac=function(r){return new(r||s)(d(z),d(j),d(x),d(F),d(E))};static \u0275cmp=g({type:s,selectors:[["app-update-password"]],outputs:{closeModal:"closeModal"},standalone:!0,features:[y],decls:28,vars:19,consts:[[1,"min-h-screen","flex","items-center","justify-center","bg-gradient-to-b","from-secondary","to-primary","py-12","px-4","sm:px-6","lg:px-8"],[1,"bg-white","p-8","rounded-2xl","shadow-xl","w-full","max-w-md","space-y-8"],[1,"text-center","space-y-4"],[1,"text-3xl","font-serif","font-bold","text-tertiary"],[1,"text-lg","text-gray-600","font-serif","italic"],[1,"space-y-6",3,"ngSubmit","formGroup"],["for","currentPassword",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["id","currentPassword","type","password","formControlName","currentPassword","placeholder","Entrez votre mot de passe actuel",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent","transition-all","duration-300",3,"ngClass"],[1,"mt-2","text-sm","text-red-600"],["for","newPassword",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["id","newPassword","type","password","formControlName","newPassword","placeholder","Entrez votre nouveau mot de passe",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent","transition-all","duration-300",3,"ngClass"],[1,"mt-1","text-sm","text-gray-500"],["for","confirmPassword",1,"block","text-lg","font-medium","text-tertiary","mb-2"],["id","confirmPassword","type","password","formControlName","confirmPassword","placeholder","Confirmez votre nouveau mot de passe",1,"w-full","p-3","border","border-secondary/30","rounded-lg","focus:ring-2","focus:ring-tertiary","focus:border-transparent","transition-all","duration-300",3,"ngClass"],[1,"pt-6"],[3,"text","type","color","rounded","disabled","customClass"]],template:function(r,e){if(r&1&&(i(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),a(4," Modifier mon mot de passe "),o(),i(5,"p",4),a(6," Assurez-vous d'utiliser un mot de passe s\xE9curis\xE9 "),o()(),l(7,"app-toast"),i(8,"form",5),S("ngSubmit",function(){return e.onSubmit()}),i(9,"div")(10,"label",6),a(11," Mot de passe actuel "),o(),l(12,"input",7),p(13,q,2,0,"p",8),o(),i(14,"div")(15,"label",9),a(16," Nouveau mot de passe "),o(),l(17,"input",10),i(18,"p",11),a(19," 8 caract\xE8res minimum avec majuscule, minuscule, chiffre et caract\xE8re sp\xE9cial "),o(),p(20,D,2,0,"p",8),o(),i(21,"div")(22,"label",12),a(23," Confirmer le nouveau mot de passe "),o(),l(24,"input",13),p(25,B,2,0,"p",8),o(),i(26,"div",14),l(27,"app-button",15),o()()()()),r&2){let c;n(8),m("formGroup",e.passwordForm),n(4),m("ngClass",v(13,w,e.isFieldInvalid("currentPassword"))),n(),f(e.isFieldInvalid("currentPassword")?13:-1),n(4),m("ngClass",v(15,w,e.isFieldInvalid("newPassword"))),n(3),f(e.isFieldInvalid("newPassword")?20:-1),n(4),m("ngClass",v(17,w,e.isFieldInvalid("confirmPassword")||e.passwordForm.hasError("mismatch"))),n(),f(e.passwordForm.hasError("mismatch")&&((c=e.passwordForm.get("confirmPassword"))!=null&&c.touched)?25:-1),n(2),m("text",e.isSubmitting()?"Modification en cours...":"Modifier le mot de passe")("type","submit")("color","tertiary")("rounded",!0)("disabled",e.passwordForm.invalid||e.isSubmitting())("customClass","w-full font-bold shadow-md hover:shadow-lg transition-all duration-300 py-3")}},dependencies:[O,A,M,_,I,N,T,P,C,V,U],encapsulation:2})};export{G as UpdatePasswordComponent};
