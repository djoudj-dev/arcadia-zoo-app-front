import{a as J,c as z,d as K,e as Q,f as X,g as Y,m as Z,o as ee,p as te}from"./chunk-2QYQOEU4.js";import{d as W}from"./chunk-ZZFP4HC6.js";import{k as L,p as G,s as E,t as ie}from"./chunk-H7WWMUX6.js";import{$ as A,$a as d,C as g,Da as l,Ea as k,Ia as x,Na as w,Pa as p,Q as f,Ra as F,T as R,Ta as I,Ua as $,Va as r,Wa as o,Xa as C,Y as H,Ya as V,a as _,ab as u,b,cb as c,db as y,eb as U,gb as j,hb as N,ia as S,ib as O,ja as h,kb as B,o as D,ob as q,rb as P,za as T}from"./chunk-FRW6CNJS.js";var M=class n{constructor(t){this.http=t}apiUrl=`${E.apiUrl}/admin/service-management`;getAllServices(){return this.http.get(this.apiUrl).pipe(g(this.handleError("r\xE9cup\xE9ration des services")))}getAllFeatures(){return this.http.get(`${this.apiUrl}/features`).pipe(g(t=>(console.error("Erreur lors de la r\xE9cup\xE9ration des caract\xE9ristiques:",t),D(()=>new Error("Erreur lors de la r\xE9cup\xE9ration des caract\xE9ristiques")))))}createService(t){return this.http.post(this.apiUrl,t).pipe(f(()=>this.clearCache()),g(this.handleError("cr\xE9ation du service")))}createFeature(t){return this.http.post(`${this.apiUrl}/features`,t).pipe(f(e=>console.log("Caract\xE9ristique cr\xE9\xE9e avec succ\xE8s :",e)),g(this.handleError("cr\xE9ation de la caract\xE9ristique")))}updateService(t,e){return this.http.put(`${this.apiUrl}/${t}`,e).pipe(f(i=>console.log("Service mis \xE0 jour avec succ\xE8s :",i)),g(this.handleError("mise \xE0 jour du service")))}deleteService(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(f(()=>this.clearCache()),g(this.handleError("suppression du service")))}clearCache(){console.log("Cache des services effac\xE9")}handleError(t){return e=>(console.error(`Erreur lors de la ${t} :`,e),D(()=>new Error(`Erreur lors de la ${t}`)))}static \u0275fac=function(e){return new(e||n)(H(G))};static \u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"})};var oe=(n,t)=>t.id_feature,se=(n,t)=>t.id_service;function le(n,t){if(n&1){let e=V();r(0,"div",10)(1,"input",21),d("change",function(s){let a=S(e).$implicit,v=u();return h(v.onFeatureChange(a,s))}),o(),r(2,"label"),c(3),o()()}if(n&2){let e=t.$implicit,i=u();l(),p("value",e.id_feature)("checked",i.isFeatureSelected(e)),l(2),y(e.name)}}function ce(n,t){if(n&1&&(r(0,"div")(1,"label",6),c(2,"Image actuelle:"),o(),C(3,"img",22),o()),n&2){let e=u();l(3),p("src",e.newServiceData.images,T)("alt","Image du service "+e.newServiceData.name)}}function me(n,t){if(n&1&&(r(0,"span"),c(1),q(2,"slice"),o()),n&2){let e=u().$implicit;l(),U("",P(2,1,e.description,0,30),"...")}}function pe(n,t){if(n&1&&(r(0,"span"),c(1),o()),n&2){let e=u().$implicit;l(),y(e.description)}}function de(n,t){n&1&&c(0," Lire la suite ")}function ue(n,t){n&1&&c(0," Voir moins ")}function ve(n,t){if(n&1){let e=V();r(0,"div",17),C(1,"img",22),r(2,"div",23)(3,"h4",24),c(4),o(),r(5,"p",25)(6,"span",26),c(7,"D\xE9scription: "),o(),w(8,me,3,5,"span")(9,pe,2,1,"span"),r(10,"button",27),d("click",function(){let s=S(e).$implicit,a=u();return h(a.toggleDescription(s.id_service))}),w(11,de,1,0)(12,ue,1,0),o()()(),r(13,"div",28)(14,"app-button",29),d("click",function(){let s=S(e).$implicit,a=u();return h(a.editService(s.id_service))}),o(),r(15,"app-button",29),d("click",function(){let s=S(e).$implicit,a=u();return h(a.deleteService(s.id_service))}),o()()()}if(n&2){let e=t.$implicit;l(),p("src",e.images||"/public/images/img_services/restaurant.webp",T)("alt","Image du service "+e.name),l(3),y(e.name),l(4),F(e.showFullDescription?9:8),l(3),F(e.showFullDescription?12:11),l(3),p("text","Modifier")("type","button")("color","secondary")("rounded",!0)("customClass","text-xs px-2 py-1 font-bold"),l(),p("text","Supprimer")("type","button")("color","red")("rounded",!0)("customClass","text-xs px-2 py-1 font-bold")}}var re=class n{constructor(t,e){this.router=t;this.serviceManagement=e}services=x([]);allFeatures=x([]);selectedFile=x(null);newServiceData={};imageBaseUrl=`${E.apiUrl}`;ngOnInit(){this.loadServices(),this.loadFeatures()}loadServices(){this.serviceManagement.getAllServices().subscribe({next:t=>{this.services.set(t.map(e=>b(_({},e),{showFullDescription:!1,images:`${this.imageBaseUrl}/${e.images}`})))},error:t=>console.error("Erreur lors de la r\xE9cup\xE9ration des services:",t)})}loadFeatures(){this.serviceManagement.getAllFeatures().subscribe({next:t=>this.allFeatures.set(t),error:t=>console.error("Erreur lors de la r\xE9cup\xE9ration des caract\xE9ristiques:",t)})}onFileSelected(t){let e=t.target;e.files?.length&&(this.selectedFile.set(e.files[0]),console.log("Fichier s\xE9lectionn\xE9 :",e.files[0]))}onFileChange(t){let e=t.target.files?.[0];if(e){this.selectedFile.set(e);let i=new FileReader;i.onload=()=>this.newServiceData.images=i.result,i.readAsDataURL(e),console.log("Fichier s\xE9lectionn\xE9 pour la mise \xE0 jour :",e)}}createService(){let{name:t,description:e,features:i}=this.newServiceData;if(!t||!e||!i){console.error("Veuillez remplir tous les champs");return}let s=new FormData;s.append("name",t),s.append("description",e),s.append("features",JSON.stringify(i));let a=this.selectedFile();a?s.append("image",a,a.name):console.warn("Aucun fichier s\xE9lectionn\xE9 pour l\u2019image"),s.forEach((v,m)=>{console.log(m,v)}),this.serviceManagement.createService(s).subscribe({next:()=>{this.loadServices(),this.resetForm()},error:v=>console.error("Erreur lors de la cr\xE9ation du service:",v)})}updateService(){console.log("Contenu de newServiceData avant la mise \xE0 jour :",this.newServiceData);let{id_service:t,name:e,description:i,features:s}=this.newServiceData;if(!t||!e||!i||!Array.isArray(s)){console.error("Champs manquants ou incorrects");return}let a=new FormData;a.append("name",e),a.append("description",i);let v=JSON.stringify(s.map(m=>({name:m.name||"",type:m.type||"",value:m.value||""})));a.append("features",v),this.selectedFile()&&a.append("image",this.selectedFile(),this.selectedFile().name),this.serviceManagement.updateService(t,a).subscribe({next:m=>{console.log("Service mis \xE0 jour avec succ\xE8s:",m),this.loadServices(),this.resetForm()},error:m=>{console.error("Erreur lors de la mise \xE0 jour du service:",m)}})}editService(t){let e=this.services().find(i=>i.id_service===t);e?(this.newServiceData=b(_({},e),{features:e.features||[],images:e.images}),this.selectedFile.set(null)):console.warn(`Service avec l'ID ${t} introuvable`)}deleteService(t){if(!t){console.error("ID invalide pour la suppression :",t);return}this.serviceManagement.deleteService(t).subscribe({next:()=>{this.services.update(e=>e.filter(i=>i.id_service!==t))},error:e=>console.error("Erreur lors de la suppression du service:",e)})}resetForm(){this.newServiceData={},this.selectedFile.set(null)}toggleDescription(t){this.services.update(e=>e.map(i=>i.id_service===t?b(_({},i),{showFullDescription:!i.showFullDescription}):i))}isFeatureSelected(t){return!!this.newServiceData.features?.some(e=>e.id_feature===t.id_feature)}onFeatureChange(t,e){let i=e.target.checked;this.newServiceData.features=i?[...this.newServiceData.features||[],t]:this.newServiceData.features?.filter(s=>s.id_feature!==t.id_feature)}goBack(){this.router.navigate(["/admin"])}cancel(){this.resetForm()}static \u0275fac=function(e){return new(e||n)(k(W),k(M))};static \u0275cmp=A({type:n,selectors:[["app-service-management"]],standalone:!0,features:[B],decls:38,vars:16,consts:[["role","main","aria-labelledby","serviceManagementTitle",1,"service-management","mb-8","sm:mb-12","px-4","sm:px-6","py-6","bg-secondary","rounded-lg","shadow-xl","shadow-tertiary"],["id","serviceManagementTitle",1,"text-xl","sm:text-2xl","font-semibold","mb-6","sm:mb-8","text-center"],[1,"container","mx-auto","flex","flex-col","gap-6","sm:gap-8","lg:flex-row"],[1,"w-full","lg:w-1/2","bg-gray-100","p-4","sm:p-6","rounded-lg","shadow-sm"],[1,"text-lg","sm:text-xl","font-semibold","mb-3","sm:mb-4"],["enctype","multipart/form-data",1,"space-y-3","sm:space-y-4",3,"ngSubmit"],[1,"block","text-base","sm:text-lg","font-medium","mb-1","sm:mb-2"],["type","text","name","name","required","","placeholder","Nom du service",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"ngModelChange","ngModel"],["name","description","required","","placeholder","Description du service",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-2","sm:grid-cols-3","gap-2"],[1,"flex","items-center"],["type","file","accept","image/*","aria-describedby","imageHelp",1,"w-full","p-2","border","border-gray-300","rounded-md",3,"change"],["id","imageHelp",1,"text-gray-500"],[1,"flex","space-x-2"],[1,"w-full","sm:w-1/2","lg:w-1/4","font-bold","px-4",3,"text","type","color","rounded"],[1,"w-full","sm:w-1/2","lg:w-1/4","font-bold","px-4",3,"click","text","type","color","rounded"],[1,"space-y-4","sm:space-y-6"],[1,"p-4","bg-white","rounded-lg","shadow-md","flex","flex-col","sm:flex-row","items-center"],[1,"flex","justify-center","pt-4"],[1,"w-full","sm:w-1/4","lg:w-1/5"],["aria-label","Retourner \xE0 la page pr\xE9c\xE9dente",1,"w-full","font-bold","py-1","sm:px-4","sm:py-2","text-sm","sm:text-base",3,"click","text","type","color","rounded"],["type","checkbox",1,"mr-2",3,"change","value","checked"],[1,"w-full","sm:w-24","lg:w-32","h-32","object-cover","rounded-md","mb-4","sm:mb-0","sm:mr-4",3,"src","alt"],[1,"flex-1"],[1,"text-lg","font-semibold"],[1,"text-sm","sm:text-base"],[1,"font-semibold"],[1,"text-blue-500","hover:underline","mt-2",3,"click"],[1,"flex","space-x-2","mt-4","sm:mt-0","sm:ml-4"],[3,"click","text","type","color","rounded","customClass"]],template:function(e,i){e&1&&(r(0,"section",0)(1,"h2",1),c(2," Gestion des services "),o(),r(3,"div",2)(4,"div",3)(5,"h3",4),c(6),o(),r(7,"form",5),d("ngSubmit",function(){return i.newServiceData.id_service?i.updateService():i.createService()}),r(8,"div")(9,"label",6),c(10,"Nom du service:"),o(),r(11,"input",7),O("ngModelChange",function(a){return N(i.newServiceData.name,a)||(i.newServiceData.name=a),a}),o()(),r(12,"div")(13,"label",6),c(14,"Description:"),o(),r(15,"textarea",8),O("ngModelChange",function(a){return N(i.newServiceData.description,a)||(i.newServiceData.description=a),a}),o()(),r(16,"div",9),I(17,le,4,3,"div",10,oe),o(),w(19,ce,4,2,"div"),r(20,"div")(21,"label",6),c(22,"Image du service:"),o(),r(23,"input",11),d("change",function(a){return i.onFileChange(a)}),o(),r(24,"small",12),c(25,"Formats accept\xE9s : JPG, JPEG, PNG, GIF, SVG, WEBP. Taille max : 5MB"),o()(),r(26,"div",13),C(27,"app-button",14),r(28,"app-button",15),d("click",function(){return i.cancel()}),o()()()(),r(29,"div",3)(30,"h3",4),c(31," Liste des services "),o(),r(32,"div",16),I(33,ve,16,15,"div",17,se),o()()(),r(35,"div",18)(36,"div",19)(37,"app-button",20),d("click",function(){return i.goBack()}),o()()()()),e&2&&(l(6),U(" ",i.newServiceData.id_service?"Modifier le service":"Cr\xE9er un service"," "),l(5),j("ngModel",i.newServiceData.name),l(4),j("ngModel",i.newServiceData.description),l(2),$(i.allFeatures()),l(2),F(i.newServiceData.images?19:-1),l(8),p("text",i.newServiceData.id_service?"Modifier":"Cr\xE9er")("type","submit")("color","tertiary")("rounded",!0),l(),p("text","Annuler")("type","button")("color","secondary")("rounded",!0),l(5),$(i.services()),l(4),p("text","Retour")("type","button")("color","tertiary")("rounded",!0))},dependencies:[ie,te,Y,J,z,K,Z,ee,X,Q,L],encapsulation:2})};export{re as ServiceManagementComponent};
